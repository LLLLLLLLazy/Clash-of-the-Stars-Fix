
[core]
name: 战斗飞盘
displayText: 帝国战斗飞盘
displayDescription: -代替步兵承受部分攻击 \n -护盾保护其中的单位 \n -可装载外骨骼装甲 \n -跨越山崖 \n -能在水面上移动

class: CustomUnitMetadata
price: 500
maxHp: 300
mass: 500
tags: units, 战斗飞盘, 步兵装备
showActionsWithMixedSelectionIfOtherUnitsHaveTag: 步兵装备, 步兵

techLevel: 1

buildSpeed: 0.002
availableInDemo: true

radius: 8
displayRadius: 13
shieldRenderRadius: 11

maxShield: 160
shieldRegen: 0.15

maxTransportingUnits: 1
transportUnitsRequireTag: 步兵, 外骨骼装甲
transportUnitsBlockOtherTransports: false
transportUnitsKillOnDeath: false

fogOfWarSightRange: 18

autoTriggerCooldownTime: 0.1s

@memory 指定坐标:unit

[action_范围运输]
@copyFromSection: template_范围运输

[hiddenAction_运输路径]
@copyFromSection: template_运输路径

[decal_运输范围]
@copyFromSection: template_运输范围

[action_自动装载开]
isVisible: if not self.hasFlag(id=1)
isActive: if self.transportingCount(empty=true) or self.numberOfAttachedUnits(withTag="外骨骼装甲", greaterThan=0)
id: 自动装载开
text: 自动装载
description: -靠近时自动载入战斗飞盘
buildSpeed: 0s
isGuiBlinking: true
iconImage: SHARED:icon_on.png
addResources: setFlag=1

[action_自动装载关]
@copyFromSection: action_自动装载开
isVisible: if self.hasFlag(id=1)
addResources: unsetFlag=1
id: 自动装载关
isGuiBlinking: false
iconImage: SHARED:icon_off.png
alwaysSinglePress: true

[hiddenAction_自动装载]
autoTrigger: if not self.hasFlag(id=1) and self.transportingCount(empty=true) and (numberOfUnitsInTeam(withTag="可载步兵", greaterThan=0, withinRange=25) or numberOfUnitsInTeam(withTag="可载装备", greaterThan=0, withinRange=25))
addWaypoint_type: loadUp
addWaypoint_prepend: true
addWaypoint_maxTime: 2s
addWaypoint_target_nearestUnit_tagged: 可载步兵, 可载装备
addWaypoint_target_randomUnit_team: own
addWaypoint_target_randomUnit_maxRange: 25


[hiddenAction_攻击范围]
autoTrigger: if attachment.readUnitMemory("属性", type='float', index=4) != memory.属性[4]
setUnitMemory: 属性[20]=attachment.readUnitMemory("属性", type='float', index=4)
alsoTriggerAction: 属性变化

[hiddenAction_移动速度]
autoTrigger: if self.numberOfAttachedUnits(greaterThan=0) and attachment.maxMoveSpeed != self.maxMoveSpeed  and (self.numberOfAttachedUnits(withTag="外骨骼装甲", lessThan=1) or attachment.numberOfAttachedUnits(greaterThan=0))
setUnitMemory: 属性[24]=attachment.readUnitMemory("属性", type='float', index=7) - ${movement.moveSpeed}
alsoTriggerAction: 属性变化

[hiddenAction_移动速度重置]
autoTrigger: if ( self.numberOfAttachedUnits(lessThan=1) or self.numberOfAttachedUnits(withTag="外骨骼装甲", greaterThan=0) and attachment.numberOfAttachedUnits(lessThan=1) ) and self.maxMoveSpeed != ${movement.moveSpeed}
setUnitMemory: 属性[24]=0
alsoTriggerAction: 属性变化


[hiddenAction_布雷飞盘]
autoTrigger: if self.numberOfAttachedUnits(withTag="帝国布雷兵", greaterThan=0)
convertTo: 战斗飞盘[布雷]
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${ConvertUpdate2}


[action_missileSwitch1]
isVisible: if self.numberOfAttachedUnits(withTag="帝国导弹兵", greaterThan=0)
isActive: if not self.attachment(withTag='帝国导弹兵').self.hasFlag(id=2)
displayType: action
id: ${section.text}
text: 单发打击
description: -装填满时只发射一枚导弹
buildSpeed: 0.1s
takeResources: setFlag=2
takeResources_includeUnitsInTransport: true
takeResources_discardCollected: true
isGuiBlinking: if self.attachment(withTag='帝国导弹兵').self.hasFlag(id=2)
allowMultipleInQueue: false
alwaysSinglePress: true

[action_missileSwitch2]
isVisible: if self.numberOfAttachedUnits(withTag="帝国导弹兵", greaterThan=0)
isActive: if self.attachment(withTag='帝国导弹兵').self.hasFlag(id=2)
displayType: action
id: ${section.text}
text: 连发轰炸
description: -发射所有导弹轰炸目标
buildSpeed: 0.1s
takeResources: unsetFlag=2
takeResources_includeUnitsInTransport: true
takeResources_discardCollected: true
isGuiBlinking: if not self.attachment(withTag='帝国导弹兵').self.hasFlag(id=2)
allowMultipleInQueue: false
alwaysSinglePress: true


[hiddenAction_护盾保护]
autoTrigger: if not self.shield(lessThan=80) and self.numberOfAttachedUnits(greaterThan=0)
convertTo: 战斗飞盘[护盾保护]
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${ConvertUpdate2}
setUnitMemory: 属性[4]=${attack.maxAttackRange}, 属性[20]=0

[attachment_1]
x: 0
y: 0
isUnselectable: true
isUnselectableAsTarget: false
rotateWithParent: false
addTransportedUnits: true
keepAliveWhenParentDies: true
resetRotationWhenNotAttacking: true
prioritizeParentsMainTarget: true
canBeAttackedAndDamaged: true

[action_扩散移动点开]
@copyFromSection: template_扩散移动点开

[action_扩散移动点关]
@copyFromSection: template_扩散移动点关

[hiddenAction_设置扩散移动点]
@copyFromSection: template_设置扩散移动点

[hiddenAction_清除当前非巡逻路径]
@copyFromSection: template_清除当前非巡逻路径

[hiddenAction_锁定扩散移动点]
@copyFromSection: template_锁定扩散移动点

[hiddenAction_执行扩散移动点]
@copyFromSection: template_执行扩散移动点

[graphics]

total_frames: 1
image:        光辉飞盘.png
image_wreak:  NONE
image_turret: NONE
drawLayer: bottom
#scaleImagesTo: 20
#scaleTurretImagesTo: 9

#lock_body_rotation_with_main_turret: true

#AUTO
image_shadow: AUTO
shadowOffsetX:1
shadowOffsetY:1

splastEffect: true
#dustEffect: true


[attack]
turretRotateWithBody: false

canAttack: false
canAttackFlyingUnits: true
canAttackLandUnits:   true
canAttackUnderwaterUnits: false

turretSize: 0
turretTurnSpeed: 0

maxAttackRange: 0
shootDelay: 0

[turret_1]
x: 0
y: 0
energyUsage: 99

[projectile_1]
tags= T-projectile
directDamage: 0
life: 0

[turret_skill]
x: 0
y: 0
invisible: true
canShoot: false
limitingRange: 9999

[movement]
movementType: OVER_CLIFF_WATER
moveSpeed: 0.9
moveAccelerationSpeed: 0.03
moveDecelerationSpeed: 0.06

targetHeight: 3
targetHeightDrift: 1

maxTurnSpeed: 2.4
turnAcceleration: 0.2

moveSlidingMode :true
moveIgnoringBody:true
moveSlidingDir:  181

[ai]
lowPriorityTargetForOtherUnits: true