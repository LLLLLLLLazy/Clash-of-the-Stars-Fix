
[core]
name: 外骨骼装甲
displayText: 外骨骼装甲
displayDescription: -代替步兵承受攻击 \n -少量提升移动速度

class: CustomUnitMetadata
price: 600
maxHp: 600
mass: 5000

shieldRegen: 0.13

tags: units, 外骨骼装甲, 步兵装备, 转向攻击

techLevel: 2

buildSpeed: 0.0018
availableInDemo: true

radius: 8
displayRadius: 12
shieldRenderRadius: 11

maxTransportingUnits: 1
transportUnitsRequireTag: 步兵
transportUnitsCanUnloadUnits: false
transportUnitsAddUnloadOption: false

fogOfWarSightRange: 18

isUnselectableAsTarget: false

autoTriggerCooldownTime: 0.01s
autoTriggerCooldownTime_allowDangerousHighCPU:true

@memory 指定坐标:unit

[action_范围运输]
@copyFromSection: template_范围运输
isVisible: if self.numberOfAttachedUnits<1

[hiddenAction_运输路径]
@copyFromSection: template_运输路径

[decal_运输范围]
@copyFromSection: template_运输范围


[action_自动装载-开]
isVisible: if not self.hasFlag(id=1)
isActive: if self.transportingCount(empty=true)
id: 自动装载开
text: 自动装载
description: -靠近步兵时自动载入外骨骼装甲
buildSpeed: 0s
isGuiBlinking: true
iconImage: SHARED:icon_on.png
addResources: setFlag=1

[action_自动装载-关]
@copyFromSection: action_自动装载-开
autoTrigger: if self.hasFlag(id=1) and self.hasParent(withTag="战斗飞盘")
isVisible: if self.hasFlag(id=1) and self.numberOfAttachedUnits<1
addResources: unsetFlag=1
id: 自动装载关
isGuiBlinking: false
iconImage: SHARED:icon_off.png
alwaysSinglePress: true

[hiddenAction_自动装载]
autoTrigger: if ( not self.hasFlag(id=1) and not self.hasParent(withTag="战斗飞盘") or self.hasParent(withTag="战斗飞盘") and not parent.hasFlag(id=1) ) and self.transportingCount(empty=true) and numberOfUnitsInTeam(withTag="可载步兵", greaterThan=0, withinRange=25)
addWaypoint_type: loadUp
addWaypoint_prepend: true
addWaypoint_maxTime: 2s
addWaypoint_target_nearestUnit_tagged: 可载步兵
addWaypoint_target_randomUnit_team: own
addWaypoint_target_randomUnit_maxRange: 25


[action_步兵显示]
isVisible: if self.numberOfAttachedUnits(greaterThan=0)
isActive: false
buildSpeed: 0s
text: [
textAddUnitName: unitRef self.attachment(slot="1")
textPostFix: ]

descriptionAddFromUnit: unitRef self.attachment(slot="1")
descriptionAddUnitStats: unitRef self.attachment(slot="1")

displayType: infoOnlyStockpile
unitShownInUI: unitRef self.attachment(slot="1")

pos: 1

[hiddenAction_装备属性]
autoTrigger: if self.numberOfAttachedUnits(greaterThan=0) and not self.hasFlag(id=0)
setUnitMemory: 属性[14]=select(attachment.tags(includes='帝国剑士'), attachment.maxHp+200, attachment.maxHp), 属性[15]=attachment.maxShield, 属性[20]=attachment.readUnitMemory("属性", type='float', index=4), 属性[24]=select(attachment.tags(includes='帝国剑士'), attachment.readUnitMemory("属性", type='float', index=7)+0.6, select(attachment.tags(includes='烽火空骑兵'), attachment.readUnitMemory("属性", type='float', index=7)+0.4, attachment.readUnitMemory("属性", type='float', index=7)+0.1)) - ${movement.moveSpeed}
addResources: setFlag=0-1
alsoTriggerAction: 属性变化, 属性变加

[hiddenAction_属性变加]
setUnitStats: shield=attachment.shield

[hiddenAction_攻击范围]
autoTrigger: if attachment.readUnitMemory("属性", type='float', index=4) != memory.属性[4]
setUnitMemory: 属性[20]=attachment.readUnitMemory("属性", type='float', index=4)
alsoTriggerAction: 属性变化


[hiddenAction_可载装备]
autoTrigger: if not self.hasParent and not self.tags(includes='可载装备')
temporarilyAddTags: 可载装备

[hiddenAction_已载装备]
autoTrigger: if self.hasParent and self.tags(includes='可载装备')
temporarilyRemoveTags: 可载装备

[hiddenAction_卸载步兵]
autoTrigger: if self.hasFlag(id=3)
addResources: unsetFlag=3
startUnloadingTransport: true


[hiddenAction_骨骼剑士]
autoTrigger: if self.numberOfAttachedUnits(withTag="帝国剑士", greaterThan=0)
convertTo: 外骨骼装甲[剑士]
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${ConvertUpdate2}

[hiddenAction_布雷装甲]
autoTrigger: if self.numberOfAttachedUnits(withTag="帝国布雷兵", greaterThan=0)
convertTo: 外骨骼装甲[布雷]
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${ConvertUpdate2}


[action_missileSwitch1]
isVisible: if self.numberOfAttachedUnits(withTag="帝国导弹兵", greaterThan=0)
isActive: if not self.attachment(withTag='帝国导弹兵').self.hasFlag(id=2)
displayType: action
id: ${section.text}
text: 单发打击
description: -装填满时只发射一枚导弹
buildSpeed: 0.1s
takeResources: setFlag=2
takeResources_includeUnitsInTransport: true
takeResources_discardCollected: true
isGuiBlinking: if self.attachment(withTag='帝国导弹兵').self.hasFlag(id=2)
allowMultipleInQueue: false
alwaysSinglePress: true

[action_missileSwitch2]
isVisible: if self.numberOfAttachedUnits(withTag="帝国导弹兵", greaterThan=0)
isActive: if self.attachment(withTag='帝国导弹兵').self.hasFlag(id=2)
displayType: action
id: ${section.text}
text: 连发轰炸
description: -发射所有导弹轰炸目标
buildSpeed: 0.1s
takeResources: unsetFlag=2
takeResources_includeUnitsInTransport: true
takeResources_discardCollected: true
isGuiBlinking: if not self.attachment(withTag='帝国导弹兵').self.hasFlag(id=2)
allowMultipleInQueue: false
alwaysSinglePress: true


[attachment_1]
x: 0
y: 0
isUnselectable: true
rotateWithParent: false
addTransportedUnits: true
setDrawLayerOnTop: false
resetRotationWhenNotAttacking: true
prioritizeParentsMainTarget: true
canBeAttackedAndDamaged: false

[action_扩散移动点开]
@copyFromSection: template_扩散移动点开

[action_扩散移动点关]
@copyFromSection: template_扩散移动点关

[hiddenAction_设置扩散移动点]
@copyFromSection: template_设置扩散移动点

[hiddenAction_清除当前非巡逻路径]
@copyFromSection: template_清除当前非巡逻路径

[hiddenAction_锁定扩散移动点]
@copyFromSection: template_锁定扩散移动点

[hiddenAction_执行扩散移动点]
@copyFromSection: template_执行扩散移动点

[graphics]

total_frames: 1
image:        外骨骼装甲.png
image_wreak:  NONE
image_turret: NONE
#scaleImagesTo: 20
#scaleTurretImagesTo: 9

lock_body_rotation_with_main_turret: true

#AUTO
image_shadow: AUTO
shadowOffsetX:1
shadowOffsetY:1

splastEffect: true
#dustEffect: true


[attack]
turretRotateWithBody: false

canAttack: true
canAttackFlyingUnits: true
canAttackLandUnits:   true
canAttackUnderwaterUnits: false

turretSize: 0
turretTurnSpeed: 4.1

maxAttackRange: 0
shootDelay: 50

[turret_1]
x: 0
y: 0
energyUsage: 99

[projectile_1]
tags= T-projectile
directDamage: 0
life: 0

[turret_skill]
x: 0
y: 0
invisible: true
canShoot: false
limitingRange: 9999

[movement]
movementType: OVER_CLIFF
moveSpeed: 0.6
moveAccelerationSpeed: 0.07
moveDecelerationSpeed: 0.07

maxTurnSpeed: 4.1
turnAcceleration: 0.5

moveSlidingMode :true
#moveIgnoringBody:true

reverseSpeedPercentage:0
