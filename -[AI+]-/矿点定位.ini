
[core]
name: 矿点定位
tags: 资源池, 矿点定位, 矿点1, 攻路点
maxHp: 1
price: 0
mass: 0

onNewMapSpawn: emptyOrOccupiedResourcePools_asNeutral
createOnAggressiveTeam:	false
createNeutral: true
stayNeutral: true

disableDeathOnZeroHp: true

#隐藏单位本身
showInEditor: false
radius: 0
fogOfWarSightRange: 0
showOnMinimap: false
ignoreInUnitCapCalculation: true
disableAllUnitCollisions: true
isUnselectable: true
canNotBeDirectlyAttacked: true

#禁止死亡痕迹
numBitsOnDeath:	0
explodeOnDeath:	false
hideScorchMark: true

# 资源池定位单位会在大地图按矿点数量大量生成，降低轮询频率避免指数级放大开销
autoTriggerCooldownTime: 0.25s


@memory 能源站归属: float

[hiddenAction_生成能源站]
autoTriggerOnEvent: newMessage(withTag='生成能源站')
alsoTriggerAction: 贝露能源站递归, 贝露能源站

[hiddenAction_贝露能源站]
requireConditional: if self.tags(includes='可生成能源站') and not self.tags(includes='已生成能源站') or ${ResourcePoolBuilding}<1 and eventData('机械降神', type='boolean')==true
spawnUnits: 贝露能源站T1[自我建造](offsetY=-2)
temporarilyAddTags: 已生成能源站
temporarilyRemoveTags: 可生成能源站
setUnitMemory: 能源站归属=eventData('能源站归属', type='number')

[hiddenAction_贝露能源站递归]
requireConditional: if self.tags(includes='已生成能源站') and eventData('机械降神', type='boolean')!=true
sendMessageTo: nearestUnit(withinRange=1000, withTag='可生成能源站', relation='any')
sendMessageWithTags: 生成能源站
sendMessageWithData: 能源站归属=eventData('能源站归属', type='number')

[hiddenAction_可生成能源站]
autoTrigger: if ${ResourcePoolBuilding}<1 and numberOfUnitsInAllTeams(withTag='苍蓝出场', withinRange=360)>0 and not self.tags(includes='可生成能源站')
temporarilyAddTags: 可生成能源站



[hiddenAction_狂猎微噬虫]
autoTrigger: if self.hasFlag(id=5)
spawnUnits: bugMeleeSmall*2(offsetRandomXY=10, offsetRandomDir=360, setToTeamOfLastAttacker=true)
addResources: unsetFlag=5
spawnEffects: 散雾*3, 噬雾

#AI————————————
@global ResourcePoolBuilding: numberOfUnitsInAllTeams(withTag="资源提取器", withinRange=10, incompleteBuildings=true) + numberOfUnitsInAllTeams(withTag="资源池建筑", withinRange=10, incompleteBuildings=true)

[hiddenAction_LAND-cantpass]
autoTrigger: if self.hasFlag(id=0) and self.tags(includes='矿点1')
temporarilyRemoveTags: 矿点1

[hiddenAction_addtag]
autoTrigger: if ${ResourcePoolBuilding}<1 and self.customTimer(laterThanSeconds=12) and not self.tags(includes='矿点定位')
temporarilyAddTags: 矿点定位, 矿点1

[hiddenAction_addTagEmpty]
autoTrigger: if ${ResourcePoolBuilding}<1 and not self.tags(includes='空资源池')
temporarilyAddTags: 空资源池

[hiddenAction_removetag]
autoTrigger: if ${ResourcePoolBuilding}>0 and self.tags(includes='空资源池')
temporarilyRemoveTags: 矿点定位, 矿点1, 可生成能源站, 空资源池
resetCustomTimer: true
takeResources: setFlag=0
takeResources_discardCollected: true
takeResources_includeUnitsWithinRange: 500
takeResources_includeUnitsWithinRange_team: any
takeResources_excludeUnitsWithoutTags: 造矿虫
takeResources_maxUnits: 1

[hiddenAction_消逝]
deleteSelf:true

[hiddenAction_攻路点否]
autoTrigger: if self.hasFlag(id=1) and (self.tags(includes='攻路点') or self.tags(includes='攻路预选'))
temporarilyRemoveTags: 攻路点, 攻路预选, 攻路确定
addResources: unsetFlag=2

[hiddenAction_攻路预选]
autoTrigger: if self.hasFlag(id=2) and not self.tags(includes='攻路预选') and not self.hasFlag(id=1)
temporarilyAddTags: 攻路预选

[hiddenAction_攻路确定]
autoTrigger: if self.hasFlag(id=3) and not self.tags(includes='攻路确定')
temporarilyAddTags: 攻路确定
temporarilyRemoveTags: 攻路预选

#—————————————

[effect_散雾]
stripIndex: effects
frameIndex: 0
priority: low

life: 200
lifeRandom: 50
fadeOut: true
attachedToUnit: false
color: #BE5CFF
fadeInTime: 30
scaleFrom: 0.8
scaleTo: 1.2
alpha: 0.5

xSpeedRelativeRandom: 0.4
ySpeedRelativeRandom: 0.4
atmospheric: true

[effect_噬雾]
stripIndex: effects
frameIndex: 0
priority: low

life: 200
fadeOut: true
attachedToUnit: false
color: #BE5CFF
fadeInTime: 2
scaleFrom: 2
scaleTo: 4
alpha: 0.6

[graphics]
isVisible: false
image: SHARED:blank.png
disableLowHpSmoke: true
disableLowHpFire: true
icon_zoomed_out_neverShow: true
showHealthBar: false
showQueueBar: false

[attack]
canAttack: false

[movement]
movementType: AIR
targetHeight: 0
targetHeightDrift: 0
