[core]
showInEditor: false
name: 溃质
displayDescription: -腐烂至极
maxHp: 1
mass: 1
price: 0
radius: 0
disableAllUnitCollisions: true
canNotBeDirectlyAttacked: true
canNotBeDamaged: true
#isUnselectableAsTarget: true
showOnMinimap: false
energyMax: 1
energyRegen: -0.00166
dieOnZeroEnergy: true
isUnselectable: true
canNotBeGivenOrdersByPlayer: true
numBitsOnDeath: 0
explodeOnDeath: false
hideScorchMark: false
autoTriggerCooldownTime: 0.1s
buildSpeed: 16.6s
isBuilding: true
footprint: 1,1,-1,-1
constructionFootprint: 1,1,-1,-1
tags: 溃质

@memory 锁定目标:unit

[hiddenAction_锁定目标]
setUnitMemory: 锁定目标=attacking
teleportTo: memory.锁定目标
alsoTriggerAction: 单一传承, 标记完成

[hiddenAction_传送目标]
autoTrigger: if distanceBetween(memory.锁定目标, self)>1
teleportTo: memory.锁定目标

[hiddenAction_单一传承]
requireConditional: if nearestUnit(withTag='溃质').readUnitMemory("锁定目标", type='unit') == memory.锁定目标
takeResources: energy=-1
takeResources_includeReference: nearestUnit(withTag='溃质')
deleteSelf: true

[hiddenAction_标记完成]
requireConditional: if nearestUnit(withTag='溃质').readUnitMemory("锁定目标", type='unit') != memory.锁定目标
addResources: setFlag=1
addWaypoint_type: attack
addWaypoint_prepend: true
addWaypoint_target_fromReference: memory.锁定目标

[hiddenAction_溃烂]
autoTrigger: if (memory.锁定目标.hp<=0 and activeWaypointTarget!=memory.锁定目标 or memory.锁定目标==null) and memory.锁定目标.maxHp>80 and self.hasFlag(id=1) and not self.hasFlag(id=2)
spawnUnits: 溃烂(addResources=setFlag:0)
addResources: setFlag=2
alsoTriggerAction: 溃烂+, 溃烂+2, 溃烂+3, 溃烂+4, 溃烂+5
alsoQueueAction: 消失

[hiddenAction_溃烂+]
@define x: 1
requireConditional: if memory.锁定目标.priceCredits + (memory.锁定目标.readUnitMemory('腐蚀价格', type='float')*3) >= 5700 * ${x}
spawnUnits: 溃烂(addResources=setFlag:0)

[hiddenAction_溃烂+2]
@copyFromSection: hiddenAction_溃烂+
@define x: 2

[hiddenAction_溃烂+3]
@copyFromSection: hiddenAction_溃烂+
@define x: 3

[hiddenAction_溃烂+4]
@copyFromSection: hiddenAction_溃烂+
@define x: 4

[hiddenAction_溃烂+5]
@copyFromSection: hiddenAction_溃烂+
@define x: 5

[hiddenAction_消失]
autoTriggerOnEvent: newMessage(withTag='消失')
autoTrigger: if self.timeAlive>1 and not self.hasFlag(id=1) or self.hasFlag(id=1) and (memory.锁定目标.maxHp<=80 and (memory.锁定目标.hp<=0 and activeWaypointTarget!=memory.锁定目标 or memory.锁定目标==null) or self.timeAlive>10)
buildSpeed: 0.1s
deleteSelf: true

#[action_kill]
#无目标时且造成过伤害生成溃烂
#autoTrigger: if self.isEnergyEmpty() and self.resource(type="fl1", greaterThan=0)
#deleteSelf: true
#spawnUnits: 溃烂(addResources=setFlag: 0)
#isVisible: false
#[action_kill2]
#存在3s后消失
#autoTrigger: if self.timeAlive(laterThanSeconds=3)
#deleteSelf: true
#isVisible: false
#[action_kill3]
#自身非溃质且周围有溃质时消失
#autoTrigger: if not self.tags(includes='溃质') and numberOfUnitsInTeam(withTag='溃质', greaterThan=0, withinRange=10)
#deleteSelf: true
#isVisible: false

#[action_4]
#周围无溃质时自身获得溃质
#autoTrigger: if not numberOfUnitsInTeam(withTag='溃质', greaterThan=0, withinRange=10)
#temporarilyAddTags: 溃质
#isVisible: false

#[hiddenAction_created]
#autoTriggerOnEvent: created
#alsoTriggerAction: s2, single

#[hiddenAction_single]
#创建时使周围溃素消失并获得溃素，继承伤害标志fl1
#autoTriggerOnEvent: created
#takeResources: hp=1, fl1=1
#takeResources_includeUnitsWithinRange: 10
#takeResources_excludeUnitsWithoutTags: 溃素
#takeResources_maxUnits: 100
#temporarilyAddTags: 溃素
#temporarilyRemoveTags: 溃质

#[hiddenAction_s2]
#requireConditional: if numberOfUnitsInTeam(withTag='溃质', greaterThan=1, withinRange=10)
#deleteSelf: true

[graphics]
image: null.png
showEnergyBar: false
showQueueBar: false
disableLowHpFire: true
disableLowHpSmoke: true
[attack]
canAttack: true
canAttackFlyingUnits: true
canAttackLandUnits: true
canAttackUnderwaterUnits: true
canOnlyAttackUnitsWithTags: units
maxAttackRange: 10
shootDelay: 0.1s
isMelee: true
aimOffsetSpread: 0

[turret_1]
x: 0
y: 0
projectile: 1
turnSpeed: 1000
canAttackCondition: if not self.hasFlag(id=1)
onShoot_triggerActions: 锁定目标

[projectile_1]
mutatorX_ifUnitWithoutTags: ʚ♡⃛ɞ(ू•ᴗ•ू❁)
mutatorX_directDamageMultiplier: 0.0000001
directDamage: -1
invisible: true
life: 50
instant: true
teleportSource: true
explodeEffect: NONE
explodeEffectOnShield: NONE

[turret_2]
x: 0
y: 0
invisible: true
turnSpeed: 1000
projectile: 2
delay: 0.1s

[projectile_2]
mutatorX_ifUnitWithoutTags: ʚ♡⃛ɞ(ू•ᴗ•ू❁)
mutatorX_directDamageMultiplier: 0.0000001
directDamage: -1
invisible: true
life: 50
instant: true
teleportSource: true
explodeEffect: CUSTOM:毒雾
explodeEffectOnShield: CUSTOM:毒雾

[effect_毒雾]
priority: veryhigh
attachedToUnit: true
life: 50
alpha: 0.3
scaleFrom: 0.9
scaleTo: 1.8
image: 毒雾.png
color: #ff0000
drawUnderUnits: false
atmospheric: true
xSpeedRelativeRandom: 0.3
ySpeedRelativeRandom: 0.3
[movement]
movementType: OVER_CLIFF_WATER
moveSpeed: 0.2
maxTurnSpeed: 10
targetHeight: 0
