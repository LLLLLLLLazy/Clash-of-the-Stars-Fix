
[core]
name:滞留毒雾
displayDescription: -持续范围侵毒
class: CustomUnitMetadata
price: 0
maxHp: 1
mass: 999999

tags=magic

techLevel: 1
buildSpeed: 3.33s

displayRadius: 6

#隐藏单位本身
showInEditor: false
radius: 0
fogOfWarSightRange: 0
showOnMinimap: false
ignoreInUnitCapCalculation: true
disableAllUnitCollisions: true
isUnselectable: true
canNotBeDirectlyAttacked: true

#禁止死亡痕迹
numBitsOnDeath:	0
explodeOnDeath:	false
hideScorchMark: true

autoTriggerCooldownTime: 0.3s

[hiddenAction_创建时]
autoTriggerOnEvent: created
setUnitStats: shootDamageMultiplier=1 + customTarget1.readUnitMemory("属性", type='float', index=3)


[action_killed]
isVisible: if self.hasFlag(id=3)
isActive: false
autoTriggerOnEvent: killedAnyUnit
requireConditional: if self.hasFlag(id=3) and not eventSource.self.tags(includes="召唤物")
text: 帝皇之征
description: -杀死敌军获得其50%资源
pos: 0.1
displayType: infoOnly
buildSpeed: 0s
addResourcesWithLogic: credits=eventSource.priceCredits*0.5

[hiddenAction_combustion]
autoTrigger: if not self.hasFlag(id=2) and not self.hasFlag(id=3)
fireTurretXAtGround: 1
fireTurretXAtGround_withOffset:0,0
fireTurretXAtGround_withProjectile: 1

[hiddenAction_combustion2]
@copyFromSection: hiddenAction_combustion
autoTrigger: if self.hasFlag(id=2)
fireTurretXAtGround_withProjectile: 2

[hiddenAction_combustion3]
@copyFromSection: hiddenAction_combustion
autoTrigger: if self.hasFlag(id=3)
fireTurretXAtGround_withProjectile: 3

[hiddenAction_kill]
autoTrigger: if self.timeAlive(laterThanSeconds=20) and not self.hasFlag(id=3)
deleteSelf: true

[hiddenAction_kill2]
autoTrigger: if self.timeAlive(laterThanSeconds=3) and self.hasFlag(id=2)
deleteSelf: true

[hiddenAction_kill3]
autoTrigger: if self.timeAlive-self.resource.毒雾时间>0 and self.hasFlag(id=3)
deleteSelf: true

[hiddenAction_眼睛蛇毒雾]
autoTriggerOnEvent: created
requireConditional: if self.hasFlag(id=3)
alsoTriggerAction: 毒雾时间叠加, 扩散毒雾叠加, 毒雾Tag
addResources: 毒雾时间=9

[hiddenAction_毒雾时间叠加]
requireConditional: if (numberOfUnitsInTeam(withTag='眼睛蛇毒雾', withinRange=60)>0 and not self.tags(includes='眼睛蛇毒雾') or numberOfUnitsInTeam(withTag='眼睛蛇毒雾', withinRange=60)>1 and self.tags(includes='眼睛蛇毒雾')) and self.resource.扩散毒雾==0
autoTrigger: ${section.requireConditional}
takeResources: 0
takeResources_discardCollected: true
takeResources_includeUnitsWithinRange: 60
takeResources_excludeUnitsWithoutTags: 眼睛蛇毒雾
takeResources_triggerActionForEach: 毒雾时间融合
takeResources_maxUnits: 4
deleteSelf: true

[hiddenAction_扩散毒雾叠加]
@copyFromSection: hiddenAction_毒雾时间叠加
requireConditional: if (numberOfUnitsInTeam(withTag='眼睛蛇毒雾', withinRange=60)>0 and not self.tags(includes='眼睛蛇毒雾') or numberOfUnitsInTeam(withTag='眼睛蛇毒雾', withinRange=60)>1 and self.tags(includes='眼睛蛇毒雾')) and self.resource.扩散毒雾>0
takeResources_maxUnits: 1

[hiddenAction_毒雾Tag]
requireConditional: if numberOfUnitsInTeam(withTag='眼睛蛇毒雾', withinRange=60)<=0
temporarilyAddTags: 眼睛蛇毒雾

[hiddenAction_毒雾时间融合]
requireConditional: if self.resource.毒雾时间>0
sendMessageTo: thisActionTarget
sendMessageWithTags: 毒雾融合
sendMessageWithData: 毒雾时间=self.resource.毒雾时间

[hiddenAction_毒雾时间]
autoTriggerOnEvent: newMessage(withTag='毒雾融合')
addResourcesWithLogic: 毒雾时间=eventData('毒雾时间', type='float')

[hiddenAction_眼镜蛇毒雾扩散]
autoTrigger: if self.resource.毒雾时间>90
fireTurretXAtGround: 1
fireTurretXAtGround_withProjectile: 3+
fireTurretXAtGround_withTarget: getOffsetRelative(y=100, dirOffset=rnd(-90, 90))
addResources: 毒雾时间=-14

[resource_毒雾时间]
displayName: 毒雾时间

[resource_扩散毒雾]
displayName: 扩散毒雾

[graphics]
total_frames: 1
#imageScale: 0.8
image: SHARED:blank.png
image_wreak:  NONE
image_turret: NONE

image_shadow: AUTO
shadowOffsetX:0
shadowOffsetY:0

disableLowHpSmoke: true

[attack]
canAttack: true
canAttackFlyingUnits: false
canAttackLandUnits:   false
canAttackUnderwaterUnits: false

turretTurnSpeed: 1000

maxAttackRange: 50
shootDelay: 0

[turret_1]
x:0
y:0

[projectile_1]
life: 50
speed: 1000

image: SHARED:blank.png
deflectionPower: -1

targetGround:true
targetGroundSpread: 50

areaDamage: 25
areaRadius: 55
areaHitAirAndLandAtSameTime:true

shieldDefectionMultiplier: 0
shieldDamageMultiplier: 0

mutatorX_ifUnitWithoutTags: 毒免疫, 效果免疫, 不会受伤
mutatorX_addResourcesAreaHit: 毒素=25
mutator1_ifUnitWithTags: 效果免疫
mutator1_areaDamageMultiplier: 0

spawnUnit: 有毒的雾

explodeEffect: CUSTOM:毒雾

[projectile_2]
@copyFromSection: projectile_1

targetGroundSpread: 15

areaDamage: 1
areaRadius: 20

mutatorX_ifUnitWithoutTags: 毒免疫, 效果免疫, 不会受伤
mutatorX_addResourcesAreaHit: 弱效毒素=10

spawnUnit: 弱效毒雾

explodeEffect: CUSTOM:毒雾2

[projectile_3]
@copyFromSection: projectile_1

targetGroundSpread: 25

areaDamage: 1
areaRadius: 45
areaHitAirAndLandAtSameTime: false

mutatorX_ifUnitWithoutTags: 毒免疫, 效果免疫, 不会受伤
mutatorX_addResourcesAreaHit: 毒素=35

spawnUnit: 有毒的雾

explodeEffect: CUSTOM:毒雾3

[projectile_3+]
life: 150
speed: 3
targetSpeed: 2

invisible: true

deflectionPower: -1

areaDamage: 1
areaRadius: 20
areaRadiusFromEdge: true

explodeOnEndOfLife: true

explodeEffect: CUSTOM:毒雾

trailEffect: CUSTOM:毒雾2
trailEffectRate: 10

spawnUnit: 滞留毒雾(addResources=setFlag:3|毒雾时间=4|扩散毒雾=1)

[resource_毒素]
displayName: 毒素

[resource_弱效毒素]
displayName: 弱效毒素

[effect_毒雾]
#烟雾
life: 200
fadeOut: true
attachedToUnit: false
image: 毒雾.png
#color: #AEFF00
fadeInTime: 20
scaleFrom: 2
scaleTo: 4.5
alpha: 0.6
drawUnderUnits:false
#ySpeedRelative:-1
atmospheric:true

dirOffsetRandom:180

xSpeedAbsoluteRandom: 0.2
ySpeedAbsoluteRandom: 0.2

[effect_毒雾2]
@copyFromSection: effect_毒雾
scaleFrom: 1
scaleTo: 1.8
alpha: 0.8

[effect_毒雾3]
@copyFromSection: effect_毒雾
scaleFrom: 2
scaleTo: 3.5

xSpeedAbsoluteRandom: 0.25
ySpeedAbsoluteRandom: 0.25

[movement]
movementType: LAND
moveSpeed: 0
moveAccelerationSpeed: 0.0
moveDecelerationSpeed: 0.0
targetHeight:-1
reverseSpeedPercentage:0.8

maxTurnSpeed: 0.0
turnAcceleration: 0.25

moveSlidingMode :false
moveIgnoringBody:false



[ai]
disableUse:true