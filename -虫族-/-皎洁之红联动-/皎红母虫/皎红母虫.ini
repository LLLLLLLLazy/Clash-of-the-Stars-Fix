
[core]
name: 皎红母虫
displayText: 皎红母虫
displayDescription: -星核的壁障被那位天穹之上的存在所撼动 \n -使得本不该出现在这个时代的族群降临了 \n -但好在……它们失去了它们引以为傲的技术
class: CustomUnitMetadata

price: 4000
maxHp: 3500
mass: 90000

tags: units, 皎红虫族, 皎红母虫, 虚红感染区

generation_resources: 2

techLevel: 2
buildSpeed: 55.5s
#availableInDemo: true

radius: 30
#displayRadius: 11

isBio: true

softCollisionOnAll: 0

selfRegenRate: 0.12

transportSlotsNeeded: 4

explodeOnDeath:false
unitsSpawnedOnDeath: 皎红母虫[亡语]

[hiddenAction_皎红分支]
autoTriggerOnEvent: created
requireConditional: if not self.globalTeamTags(includes="皎红")
addGlobalTeamTags: 皎红


[action_衍黎机制介绍]
isVisible: if self.globalTeamTags(includes="衍黎")
id: ${section.text}
text: =感染区=
description: -虫族资源提取器T4&母巢&母巢T2&枝繁叶茂&皎红母虫将带有600范围的感染区 \n -当己方单位在感染区内停留10s后获得虚红感染 \n虚红感染: 血量&伤害+25%，离开感染区后伤害-90%
displayType:infoOnly
buildSpeed:0s
pos:-2

[action_狂猎机制介绍]
isVisible: if self.globalTeamTags(includes="狂猎")
id: ${section.text}
text: =亡灵虫=
description: -腐蚀单位死亡后生成对应的亡灵 \n -亡灵的战斗力稍弱且不可控制 \n -亡灵存在时会持续消耗腐蚀
displayType:infoOnly
buildSpeed:0s
pos:-1


[canBuild_1]
name: 皎红建造虫, 皎红噬咬虫
pos: 1



@global JiaohongYanli: self.globalTeamTags(includes='衍黎')

[hiddenAction_虚红感染雾]
autoTrigger: if numberOfUnitsInTeam(withTag='虚红感染区', withinRange=600)<10 and ${JiaohongYanli}
spawnEffects: 感染*3

[effect_感染]
priority: verylow
life: 300
fadeInTime: 30
image: fog.png
color:#ff0000
scaleFrom:2
scaleTo:2.5
attachedToUnit:false
drawUnderUnits: true
alpha:0.15
atmospheric: true
xSpeedAbsolute:-0.2
xSpeedRelativeRandom:0.1
delayedStartTimerRandom:60
hSpeed:0.3
hSpeedRandom:0.1
dirSpeedRandom: 0.1
dirOffsetRandom: 180
xOffsetRelativeRandom:420
yOffsetRelativeRandom:420


[template_提取目标]
takeResources_includeUnitsWithinRange: 600
takeResources_includeUnitsWithinRange_team: own
takeResources_excludeUnitsWithoutTags: units
takeResources_discardCollected: true
takeResources_maxUnits: 9999

[template_提取目标2]
@copyFromSection: template_提取目标
autoTrigger: if numberOfUnitsInTeam(withTag="units", greaterThan=0, withinRange=${section.takeResources_includeUnitsWithinRange}) and ${JiaohongYanli}


[hiddenAction_虚红感染附中检测]
@copyFromSection: template_提取目标2
autoTriggerOnEvent: newMessage(withTag='虚红感染更新')
autoTrigger: if numberOfUnitsInTeam(withTag="units", greaterThan=0, withinRange=${section.takeResources_includeUnitsWithinRange}) and ${JiaohongYanli} and numberOfUnitsInTeam(withTag='虚红感染附停系统激活')<1
requireConditional: if numberOfUnitsInTeam(withTag="units", greaterThan=0, withinRange=${section.takeResources_includeUnitsWithinRange}) and ${JiaohongYanli} and numberOfUnitsInTeam(withTag='虚红感染附停系统激活')<1
takeResources: hp=0
takeResources_excludeUnitsWithTheseResources: 虚红感染附中=10
takeResources_triggerActionForEach: 虚红感染附中

[hiddenAction_虚红感染附中]
requireConditional: if thisActionTarget.resource.虚红感染附停<1
takeResources: 虚红感染附中=-2, 虚红感染附停=-1
takeResources_includeReference: thisActionTarget
takeResources_discardCollected: true
sendMessageTo: globalSearchForFirstUnit(withTag='单位系统', relation='own')
sendMessageWithTags: 虚红感染附停激活

fireTurretXAtGround: magic
fireTurretXAtGround_withProjectile: 虚红感染特效
fireTurretXAtGround_withTarget: thisActionTarget.getOffsetAbsolute(y=-thisActionTarget.height)


[hiddenAction_虚红感染附加检测]
@copyFromSection: template_提取目标2
takeResources: hp=0
takeResources_excludeUnitsWithTheseResources: 虚红感染=2
takeResources_triggerActionForEach: 虚红感染时间

[hiddenAction_虚红感染时间]
requireConditional: if thisActionTarget.resource.虚红感染附中>=10
takeResources: 虚红感染=-1
takeResources_includeReference: thisActionTarget
takeResources_discardCollected: true


[hiddenAction_虚红感染负面检测]
@copyFromSection: template_提取目标2
takeResources: hp=0
takeResources_triggerActionForEach: 虚红感染负面恢复

[hiddenAction_虚红感染负面恢复]
requireConditional: if thisActionTarget.resource.虚红感染负面状态>=1
takeResources: 虚红感染负面状态=1, 负虚红感染=1
takeResources_includeReference: thisActionTarget
takeResources_discardCollected: true

fireTurretXAtGround: magic
fireTurretXAtGround_withProjectile: 虚红感染特效2
fireTurretXAtGround_withTarget: thisActionTarget.getOffsetAbsolute(y=-thisActionTarget.height)


[resource_虚红感染附中]
displayName: 虚红感染附中
hidden: true

[resource_虚红感染附停]
displayName: 虚红感染附停
hidden: true

[resource_虚红感染]
displayName: 虚红感染
hidden: true

[resource_虚红感染负面状态]
displayName: 虚红感染负面状态
hidden: true

[resource_负虚红感染]
displayName: 负虚红感染
hidden: true


[projectile_虚红感染特效]
directDamage: 0
invisible: true
life: 10
instant: true
targetGround_includeTargetHeight: true
explodeEffect: 虚红感染标, 虚红感染光, 虚红感染散

[projectile_虚红感染特效2]
@copyFromSection: projectile_虚红感染特效
explodeEffect: 虚红感染标, 弱虚红感染光, 弱虚红感染散


[effect_虚红感染标]
priority: low
life: 25
fadeInTime: 2
scaleFrom: 0.2
scaleTo: 0.25
alpha: 0.6
image: 皎红icon.png
attachedToUnit: true
alwayStartDirAtZero: true

[effect_虚红感染光]
priority: low
life: 30
scaleFrom: 1.3
scaleTo: 2.6
alpha: 1
image: SHARED:light_50.png
color: #FF0000
attachedToUnit: true
dirSpeedRandom: 3
dirOffsetRandom: 180

[effect_虚红感染散]
priority: low
life: 160
fadeOut: true
fadeInTime: 5
scaleFrom: 0.08
scaleTo: 0.2
alpha: 0.4
image: 红曜散裂.png
color: #FF0000
attachedToUnit: true

[effect_弱虚红感染光]
@copyFromSection: effect_虚红感染光
alpha: 0.8

[effect_弱虚红感染散]
@copyFromSection: effect_虚红感染散
life: 80
scaleTo: 0.16


[arm_1]
x: 0
y: 0
image_end: SHARED:blank.png
spinRate: 0.1

[arm_2]
@copyFromSection: arm_1
spinRate: 0.3

[arm_3]
@copyFromSection: arm_1
spinRate: -0.01

[decal_虚红感染区]
isVisible: if numberOfUnitsInTeam(withTag='虚红感染区', withinRange=600)<20 and ${JiaohongYanli}
alwaysStartHeightAtZero: true
layer: shadow
image: 红光圈2.png
basePositionFromLegEnd: arm1
imageScale: 2.7
alpha: 0.05

[decal_感染显示圈]
isVisible: if numberOfUnitsInTeam(withTag='虚红感染区', withinRange=60)<3 and ${JiaohongYanli}
alwaysStartHeightAtZero: true
alwaysStartDirAtZero: true
layer: beforeUI
image: 红范围圈1200.png
imageScale: ${600/600}
alpha: 0.4
onlyWhenSelectedByAnyPlayer: true

[decal_感染红区]
isVisible: if numberOfUnitsInTeam(withTag='虚红感染区', withinRange=600)<15 and ${JiaohongYanli}
alwaysStartHeightAtZero: true
alwaysStartDirAtZero: true
layer: beforeUI
image: 红范围底.png
imageScale: ${600/600}
alpha: 0.075 / max( (numberOfUnitsInTeam(withTag='虚红感染区', withinRange=600) /2), 1 )

[decal_感染环圈]
@copyFromSection: decal_虚红感染区
isVisible: if numberOfUnitsInTeam(withTag='虚红感染区', withinRange=600)<3 and ${JiaohongYanli} and not self.globalTeamTags(includes='关闭感染区高级效果')
basePositionFromLegEnd: arm2
image: 红外光圈2.png
imageScale: ${2.7 * 0.73}

[decal_黑感染环圈]
@copyFromSection: decal_感染环圈
image: 黑红外光圈2.png
dirOffset: 60

[decal_感染裂面]
isVisible: if numberOfUnitsInTeam(withTag='虚红感染区', withinRange=600)<4 and ${JiaohongYanli} and not self.globalTeamTags(includes='关闭感染区高级效果')
alwaysStartHeightAtZero: true
layer: shadow
image: 红散裂.png
imageScale: ${2.7 * 0.15} * (0.95 + cos( ${timer_10s} * 360 - ${b}) * 0.05)
basePosition: getOffsetRelative(x=0, y=0, dirOffset=self.timeAlive-self.dir)
onlyWithZoomLevelOrMore: 0.5

@define timer_10s: ((self.timeAlive() % 10) / 10)
alpha: 0.05+cos( ${timer_10s} * 360 - ${b}) * 0.04
@define b: 0

[decal_感染裂面2]
@copyFromSection: decal_感染裂面
imageScale: ${2.7 * 0.2} * (0.95 + cos( ${timer_10s} * 360 - ${b}) * 0.05)
@define b: 72

[decal_感染裂面3]
@copyFromSection: decal_感染裂面
imageScale: ${2.7 * 0.3} * (0.95 + cos( ${timer_10s} * 360 - ${b}) * 0.05)
@define b: 144

[decal_感染裂面4]
@copyFromSection: decal_感染裂面
imageScale: ${2.7 * 0.45} * (0.95 + cos( ${timer_10s} * 360 - ${b}) * 0.05)
alpha: 0.04+cos( ${timer_10s} * 360 - ${b}) * 0.03
@define b: 216

[decal_感染裂面5]
@copyFromSection: decal_感染裂面
imageScale: ${2.7 * 0.65} * (0.95 + cos( ${timer_10s} * 360 - ${b}) * 0.05)
alpha: 0.04+cos( ${timer_10s} * 360 - ${b}) * 0.03
@define b: 288


[decal_感染缠乱线]
isVisible: if numberOfUnitsInTeam(withTag='虚红感染区', withinRange=600)<3 and ${JiaohongYanli} and not self.globalTeamTags(includes='关闭感染区高级效果')
alwaysStartHeightAtZero: true
layer: shadow
image: 红缠乱线.png
imageScale: ${2.7 * 0.5} * (0.8 + cos( ${timer_20s} * 360 - ${b}) * 0.2)
basePosition: getOffsetRelative(x=0, y=0, dirOffset=-self.timeAlive*2 -self.dir)
onlyWithZoomLevelOrMore: 0.7

@define timer_20s: ((self.timeAlive() % 20) / 20)
alpha: 0.35+cos( ${timer_20s} * 360 - ${b}) * 0.25
@define b: 0

[decal_感染缠乱线2]
@copyFromSection: decal_感染缠乱线
dirOffset: 90
@define b: 90

[decal_感染缠乱线3]
@copyFromSection: decal_感染缠乱线
dirOffset: 180
@define b: 180

[decal_感染缠乱线4]
@copyFromSection: decal_感染缠乱线
dirOffset: 270
@define b: 270

[decal_内感染缠乱线]
@copyFromSection: decal_感染缠乱线
isVisible: if numberOfUnitsInTeam(withTag='虚红感染区', withinRange=600)<2 and ${JiaohongYanli} and not self.globalTeamTags(includes='关闭感染区高级效果')
imageScale: ${2.7 * 0.5} * (0.4 + cos( ${timer_20s} * 360 - ${b}) * 0.2)
alpha: 0.45+sin( ${timer_20s} * 360 - ${b}) * 0.25
dirOffset: 45
@define b: 45

[decal_内感染缠乱线2]
@copyFromSection: decal_内感染缠乱线
dirOffset: 135
@define b: 135

[decal_内感染缠乱线3]
@copyFromSection: decal_内感染缠乱线
dirOffset: 225
@define b: 225

[decal_内感染缠乱线4]
@copyFromSection: decal_内感染缠乱线
dirOffset: 315
@define b: 315

[action_感染区高级效果]
isVisible: if ${JiaohongYanli} and not self.globalTeamTags(includes='关闭感染区高级效果')
id: 感染区高级效果开
text: {感染区高级效果:开}
description: -关闭后可立即隐藏自身感染区的特殊贴花特效 \n -可用于缓解卡顿
buildSpeed: 0s
pos: 20
iconExtraImage: icon_on.png
iconExtraColor: #64FFFFFF
displayType: infoOnly
highPriorityQueue: true
allowMultipleInQueue: false
addGlobalTeamTags: 关闭感染区高级效果

[action_感染区高级效果2]
@copyFromSection: action_感染区高级效果
isVisible: if ${JiaohongYanli} and self.globalTeamTags(includes='关闭感染区高级效果')
id: 感染区高级效果关
text: {感染区高级效果:关}
iconExtraImage: icon_off.png
addGlobalTeamTags: IGNORE
removeGlobalTeamTags: 关闭感染区高级效果


[graphics]
total_frames: 1

image:       身体.png
image_wreak: NONE
image_turret: NONE

imageScale: 1.1

image_shadow: AUTO
shadowOffsetX:4
shadowOffsetY:4

animation_attack_scale_start: 1
animation_attack_scale_end: 0.97
animation_attack_pingPong: true

animation_idle_scale_start: 1
animation_idle_scale_end: 1.03
animation_idle_pingPong: true

dustEffect: true

[attack]
canAttack: true
canAttackFlyingUnits: true
canAttackLandUnits:   true
canAttackUnderwaterUnits: false

turretSize: 0
turretTurnSpeed: 4

maxAttackRange: 160
shootDelay: 60

[turret_1]
x: 18
y: 28
idleDir: 45

turnSpeed: 999

shoot_sound:plasma_fire2
shoot_sound_vol:0.3
shoot_flame:激光闪3

projectile: 1

[turret_2]
x: -18
y: 28
idleDir:-45
copyFrom: 1

[turret_3]
x: 18
y: 45
idleDir:0
copyFrom: 1
linkDelayWithTurret: 1
warmup: 30

[turret_4]
x: -18
y: 45
idleDir:0
copyFrom: 1
linkDelayWithTurret: 1
warmup: 30

[turret_magic]
x: 0
y: 0
invisible: true
canShoot: false

[projectile_1]
tags= T-projectile
life: 180
speed: 8
targetSpeed: 4

directDamage: 25

color:#FF0000
drawSize: 0.8
lightColor:#FF0000
lightSize: 0.5

frame:11

moveWithParent: true

explodeEffect: 激光闪, 激光闪2

[effect_激光闪]
priority:low
life:20
image:SHARED:light_50.png
color:#FF0000
attachedToUnit:false
alpha:0.6
scaleFrom:0.6
scaleTo:0.1

[effect_激光闪2]
priority:low
life:60
image:SHARED:light_50.png
color:#FF0000
attachedToUnit:false
alpha:0.6
scaleFrom:0.4
scaleTo:0.1

[effect_激光闪3]
life:20
image:SHARED:light_50.png
color:#FF0000
attachedToUnit:false
alpha:1
scaleFrom:1
scaleTo:1

[leg_1]
x: -20
y: 0
attach_x: -10
attach_y: 0
moveSpeed: 4.1
resetAngle:20

heightSpeed: 1

image_leg:  腿.png
image_foot: none

drawLegWhenZoomedOut: true

dust_effect: false

holdDisMin: 0
holdDisMax: 0
explodeOnDeath:false

[leg_2]
x: 20
y: 0
attach_x: 10
attach_y: 0
copyFrom: 1

[leg_3]
x: -15
y: 40
attach_x: -10
attach_y: 20
copyFrom: 1

[leg_4]
x: 20
y: 40
attach_x: 10
attach_y: 20
copyFrom: 1

[leg_5]
x: -20
y: -40
attach_x: -10
attach_y: -20
copyFrom: 1

[leg_6]
x: 20
y: -40
attach_x: 10
attach_y: -20
copyFrom: 1

[leg_7]
x: -20
y: -20
attach_x: -10
attach_y: -10
copyFrom: 1

[leg_8]
x: 20
y: -20
attach_x: 10
attach_y: -10
copyFrom: 1

[leg_9]
x: -20
y: 20
attach_x: -10
attach_y: 10
copyFrom: 1

[leg_10]
x: 20
y: 20
attach_x: 10
attach_y: 10
copyFrom: 1

[movement]
movementType: OVER_CLIFF
moveSpeed: 0.5
moveAccelerationSpeed: 0.03
moveDecelerationSpeed: 0.03

maxTurnSpeed: 1.2
turnAcceleration: 0.1

targetHeight: 3

moveSlidingMode :false
moveIgnoringBody:false

[ai]
useAsBuilder: true
