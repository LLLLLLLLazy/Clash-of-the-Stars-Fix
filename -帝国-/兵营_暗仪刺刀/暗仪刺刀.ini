
[core]
name: 暗仪刺刀
displayText: 暗仪刺刀
displayDescription: -最残酷的杀手 \n -全副武装 \n -连续斩击 \n -优良视野 \n -移动速度很快 \n -击杀敌方单位后可强化自身护盾 \n -护盾存在时攻击会消耗护盾并强化攻击 \n -护盾存在时可无视地形且不会被小地图探测 \n -护盾破碎后需要一定时间修复 \n \n -2024.9.16 冠军限定-
class: CustomUnitMetadata
price: 10000, 基因种子=45
maxHp: 2100
mass: 20000

maxShield: 1000
shieldRegen: 0.35

tags: units, 星际步兵, 坚韧意志, 转向攻击

fogOfWarSightRange: 22

techLevel: 2
buildSpeed: 0.00022

radius: 24
displayRadius: 26

shieldRenderRadius: 29

isBio: true

selfRegenRate: 0.2

transportSlotsNeeded: 3

showOnMinimapToEnemies: false

autoTriggerCooldownTime: 6

[action_冠军签名]
iconImage: 巫妖王-签名.png
isVisible: if self.timeAlive < 10
isActive: false
id: 冠军签名
description: -冠军签名- \n (10s后隐藏)
pos: 99
displayType: infoOnlyStockpile
buildSpeed: 0s

[hiddenAction_收集祭品]
autoTriggerOnEvent: killedAnyUnit
requireConditional: if not eventSource.self.tags(includes="召唤物")
addResourcesWithLogic: 祭品=25+int(eventSource.priceCredits*0.01 + eventSource.readUnitMemory('腐蚀价格', type='float')*${0.01*4})

[resource_祭品]
displayName: 祭品

[action_燔祭]
isLocked: if self.resource.祭品<1
isLockedMessage: ……燔祭的羔羊在哪里？

displayType: action
price: 0
text: 燔祭
description: -击杀敌方单位后可进行燔祭 \n -回复所有护盾 \n -护盾上限提升25+[击杀价值1%]
iconImage: 暗滴icon.png
iconExtraImage: 黑法阵.png
iconExtraColor: #64FFFFFF
iconExtraIsVisible: if self.hasFlag(id=2)
isGuiBlinking: if self.resource.祭品>=1

addResources: shield=999999, unsetFlag=2
setResourcesWithLogic: 祭品=0
whenBuilding_cannotMove: true
whenBuilding_temporarilyConvertTo: 暗仪刺刀[燔祭]
whenBuilding_triggerAction: 延时属性更新
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${DelayedConvertUpdate}

playSoundToPlayerOnQueue: Fire6.ogg:0.1

setUnitMemory: 属性[15]=memory.属性[15]+self.resource.祭品
alsoTriggerAction: 属性变化

buildSpeed: 5s
pos: 1

allowMultipleInQueue: false
canPlayerCancel: false

[hiddenAction_延时属性更新]
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${DelayedConvertUpdate}

[hiddenAction_护盾破碎]
autoTrigger: if self.shield(lessThan=50)
convertTo: 暗仪刺刀[破碎]
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${ConvertUpdate2}
playSoundAtUnit: Break.ogg:0.1
spawnEffects: 扭曲, 护盾散

[animation_斩击]
arm1_0.05s:{x:2, y:0, dir:20}
arm1_0.12s:{x:6, y:3, dir:130}
arm1_0.3s:{x:8, y:-1, dir:140}
arm1_0.5s:{x:6, y:0, dir:155}
arm1_0.6s:{x:2, y:14, dir:30}
arm1_0.9s:{x:0, y:0, dir:0}

arm2_0.05s:{x:-2, y:0, dir:-20}
arm2_0.12s:{x:-6, y:3, dir:-130}
arm2_0.3s:{x:-8, y:-5, dir:-140}
arm2_0.4s:{x:-2, y:13, dir:-30}
arm2_0.6s:{x:0, y:0, dir:0}

arm3_0.05s:{x:0, y:0, dir:0}
arm3_0.1s:{x:0, y:-3, dir:0}
arm3_0.3s:{x:0, y:-5, dir:-15}
arm3_0.4s:{x:0, y:2, dir:15}
arm3_0.5s:{x:0, y:2, dir:20}
arm3_0.6s:{x:0, y:4, dir:-20}
arm3_0.9s:{x:0, y:0, dir:0}

[hiddenAction_护盾消耗]
addResources: shield=-600
spawnEffects: 法阵, 护盾散

[graphics]
total_frames: 1
image:       null.png
image_wreak: NONE
image_turret: NONE
image_shield: black_shield.png

teamColorsOnTurret: true

image_shadow: AUTO
shadowOffsetX:1
shadowOffsetY:1

lock_body_rotation_with_main_turret: true
lock_leg_rotation_with_main_turret: true

movementEffect: 黑尘
movementEffectRate: 5

[effect_黑尘]
stripIndex: effects
frameIndex: 0

life: 100
fadeOut: true
fadeInTime: 5
attachedToUnit: false
color: #000000
scaleFrom: 2.2
scaleTo: 4.5
alpha: 0.1
drawUnderUnits:false

dirOffsetRandom:180

xOffsetRelativeRandom:30
yOffsetRelative:-5
yOffsetRelativeRandom:3

xSpeedAbsoluteRandom: 0.2
ySpeedAbsoluteRandom: 0.2

[attack]
canAttack: true
canAttackFlyingUnits: false
canAttackLandUnits:   true
canAttackUnderwaterUnits: false

turretSize: 0
turretTurnSpeed: 6

maxAttackRange: 30
shootDelay: 54

isMelee: true
meleeEngangementDistance: 150

aimOffsetSpread: 0

[turret_1]
#主体
invisible: true
canShoot: false
x: 0
y: 0
idleDir: 0
turnSpeed: 4.0
turnSpeedAcceleration: 0.5
canAttackCondition: if attacking == activeWaypointTarget or not self.hasActiveWaypoint(type='attack') or distanceBetween(attacking, activeWaypointTarget)>600

[turret_2]
#第一次斩击
invisible: true
attachedTo: 1
x: 0
y: 0
idleDir: 0

turnSpeed: 5.0
turnSpeedAcceleration: 1.0

canAttackCondition: if attacking == activeWaypointTarget or not self.hasActiveWaypoint(type='attack') or distanceBetween(attacking, activeWaypointTarget)>600

onShoot_playAnimation: 斩击
onShoot_triggerActions: 护盾消耗

projectile: 1

[turret_3]
#显示额外伤害数据
invisible: true
attachedTo: 1
slave: true
x: 0
y: 0
canAttackCondition:	false
projectile: 1

[turret_4]
#显示额外伤害数据
invisible: true
attachedTo: 1
slave: true
x: 0
y: 0
canAttackCondition:	false
projectile: 1

[projectile_1]
tags= T-projectile
delayedStartTimer: 3

directDamage: 700

life: 50
instant: true

explodeEffect: 半月斩, 半月斩紫粒子*15, 光
explodeEffectOnShield: 半月斩, 半月斩紫粒子*15, 光

spawnProjectilesOnCreate: 2, 3

[projectile_2]
tags= T-projectile
delayedStartTimer: 20
directDamage: 700
life: 50
instant: true
explodeEffect: 左刺击, 左刺击紫粒子*10, 光
explodeEffectOnShield: 左刺击, 左刺击紫粒子*10, 光

[projectile_3]
@copyFromSection: projectile_2
delayedStartTimer: 32
explodeEffect: 右刺击, 右刺击紫粒子*10, 光
explodeEffectOnShield: 右刺击, 右刺击紫粒子*10, 光

[effect_半月斩] 
priority:veryhigh
image: 刀光.png
life: 35
fadeOut: true
fadeInTime: 2
attachedToUnit: false
color: #C88DD9
scaleFrom: 0.8
scaleTo: 0.8
alpha: 1.0
yOffsetRelative: -15
drawUnderUnits: false
alsoPlaySound:Sword7.ogg:0.2

[effect_左刺击]
priority:veryhigh
image: 斩击.png
life: 30
fadeOut: true
attachedToUnit: false
color: #C88DD9
scaleFrom: 1.2
scaleTo: 1.2
alpha: 1.0
yOffsetRelative: -5
dirOffset: -5
drawUnderUnits:false
alsoPlaySound:Sword6.ogg:0.2

total_frames: 5
animateFrameStart: 0
animateFrameEnd: 4
animateFrameSpeed: 0.25

[effect_右刺击]
@copyFromSection: effect_左刺击
dirOffset: 15

[effect_法阵]
priority: veryhigh
life: 60
fadeOut: true
fadeInTime: 10
attachedToUnit: true
image: 法阵.png
color: #C88DD9
scaleFrom: 0.7
scaleTo: 0.7
alpha: 0.6
drawUnderUnits: true

[effect_护盾散]
priority: veryhigh
life: 30
fadeOut: true
fadeInTime: 3
attachedToUnit: false
image: black_shield.png
scaleFrom: 0.8
scaleTo: 1.2
alpha: 0.8
drawUnderUnits: false

[effect_扭曲]
drawType: displacement

image: SHARED:ripple_normal_128.png
life: 50
fadeOut: true
fadeInTime: 5

attachedToUnit: false
color: #FFFFFF
scaleFrom: 0.3
scaleTo: 1.5
alpha: 0.05
drawUnderUnits:false

dirSpeed: 1

[effect_半月斩紫粒子]
priority: verylow
life: 25
fadeOut: true
fadeInTime: 3
attachedToUnit: false
image: SHARED:spark.png
color: #C88DD9
scaleFrom: 1.5
scaleTo: 1.5
alpha: 0.8
xOffsetRelativeRandom:50
yOffsetRelativeRandom:15
xSpeedRelativeRandom: 0.8
ySpeedRelative: 2.2
ySpeedRelativeRandom: 0.8
drawUnderUnits: false

[effect_左刺击紫粒子]
priority: verylow
life: 25
fadeOut: true
fadeInTime: 3
attachedToUnit: false
image: SHARED:spark.png
color: #C88DD9
scaleFrom: 1.5
scaleTo: 1.5
alpha: 0.8
pivotOffset: 85
xOffsetRelativeRandom:3
yOffsetRelativeRandom:18
xSpeedRelativeRandom: 0.4
ySpeedRelative: 2.5
ySpeedRelativeRandom: 0.8
drawUnderUnits: false

[effect_右刺击紫粒子]
@copyFromSection: effect_左刺击紫粒子
pivotOffset: -75

[effect_光]
image: SHARED:light_50.png
life: 50
fadeOut: true
attachedToUnit: true
color: #C88DD9
scaleFrom: 1.3
scaleTo: 1.5
alpha: 0.3

[movement]
movementType: AIR
moveSpeed: 2.0
moveAccelerationSpeed: 0.04
moveDecelerationSpeed: 0.07

reverseSpeedPercentage: 0

targetHeight: 1
targetHeightDrift: 0.2

maxTurnSpeed: 4.0
turnAcceleration: 0.3

moveSlidingMode :true
moveIgnoringBody:true

[arm_1]
x: 15
y: -3
image_end: 右手.png
image_end_shadow: SHADOW:右手.png
image_end_teamColors: true
drawOverBody: false
drawDirOffset: -60
moveSpeed: 100

[arm_2]
x: -15
y: -3
image_end: 左手.png
image_end_shadow: SHADOW:左手.png
image_end_teamColors: true
drawOverBody: false
drawDirOffset: 60
moveSpeed: 100

[arm_3]
x: 0
y: 0
image_end: 暗仪刺刀.png
image_end_shadow: SHADOW:暗仪刺刀.png
image_end_teamColors: true
drawOverBody: true
moveSpeed: 100