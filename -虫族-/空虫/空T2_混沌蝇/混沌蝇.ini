
[core]
name: 混沌蝇
displayText: 混沌蝇
displayDescription: -腐蚀之信使\n-攻击地面与空中\n-概率触发追加攻击\n-需要指定攻击目标\n-达到一定数量后将不会停止移动\n-攻击可引爆目标30毒素造成额外60伤害\n“覆巢之下安有完卵”
class: CustomUnitMetadata
price: 328, 腐蚀=${corrode}
maxHp: 35
mass: 100

techLevel: 2

radius: 10
softCollisionOnAll: 3

isBug: true
isBio: true
tags: units, 虫族, 小型虫, 混沌蝇

selfRegenRate: 0.2

buildSpeed: 3.3s

energyMax: 1

effectOnDeath: CUSTOM:毒雾*1

[hiddenAction_亡灵生成]
autoTriggerOnEvent: destroyed
requireConditional: if self.globalTeamTags(includes='狂猎') and self.globalTeamTags(includes='皎红')
spawnUnits: 混沌蝇[亡灵]

[hiddenAction_腐蚀价格]
@global corrode: 50
autoTrigger: if memory.腐蚀价格!=${corrode}
setUnitMemory: 腐蚀价格=${corrode}

[action_锋势]
isActive: false
id: ${section.text}
text: 锋势
description: -混沌蝇总数量达到50后触发 \n -更容易连击 \n -拥有护盾 \n -但其飞行将不再会停止且难以控制
pos: 0
displayType: infoOnly
buildSpeed: 0s
iconImage: 锋势icon.png
addResources: hp=1

[hiddenAction_clusters]
autoTrigger: if numberOfUnitsInTeam(greaterThan=49,withTag='混沌蝇')
convertTo: 混沌蝇[锋势]
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${ConvertUpdate2}
convertTo_keepCurrentFields: maxHp, maxShield

[hiddenAction_follow]
clearActiveWaypoint: true
addWaypoint_type: attackMove
addWaypoint_maxTime: 1s
addWaypoint_target_nearestUnit_tagged: 魔王之心
addWaypoint_target_nearestUnit_team: own
#addWaypoint_target_nearestUnit_maxRange: 2000
addWaypoint_target_mapMustBeReachable: false
autoTrigger: if numberOfUnitsInTeam(withTag="魔王之心", greaterThan=0)

[hiddenAction_swallow]
autoTrigger: if self.hasFlag(id=1)
convertTo: 混沌吸收
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${ConvertUpdate2}
convertTo_keepCurrentFields: maxHp, maxShield

[effect_毒雾]
priority: veryhigh
#attachedToUnit: true
life: 100
alpha: 0.8
scaleFrom: 1.0
scaleTo: 1.5
image: 毒雾.png
drawUnderUnits: false
atmospheric: true
xSpeedRelativeRandom: 0.2
ySpeedRelativeRandom: 0.2


[action_扩散移动点开]
@copyFromSection: template_扩散移动点开

[action_扩散移动点关]
@copyFromSection: template_扩散移动点关

[hiddenAction_设置扩散移动点]
@copyFromSection: template_设置扩散移动点

[hiddenAction_清除当前非巡逻路径]
@copyFromSection: template_清除当前非巡逻路径

[hiddenAction_锁定扩散移动点]
@copyFromSection: template_锁定扩散移动点

[hiddenAction_执行扩散移动点]
@copyFromSection: template_执行扩散移动点

[graphics]
#scaleImagesTo: 20
image: 腐蚀之信使.png
image_turret: NONE

image_shadow: AUTO
shadowOffsetX: 1
shadowOffsetY: 1

total_frames: 5

animation_idle_start: 0
animation_idle_end: 4
animation_idle_speed: 2

animation_moving_start: 0
animation_moving_end: 4
animation_moving_speed: 2

splastEffect: true

[attack]
canAttack: true
canAttackFlyingUnits: true
canAttackLandUnits: true
canAttackUnderwaterUnits: false

turretTurnSpeed: 20

maxAttackRange: 110
shootDelay: 60

attackMovement: bomber

[turret_1]
x: 0
y: 0
invisible: true

shoot_light: #FF3BFF00

projectile: 1

[turret_1附]
x: 0
y: 0
invisible: true

projectile: 1附

canAttackCondition: if numberOfUnitsInTeam(greaterThan=0,withTag='别西卜瘟疫',withinRange=300) or self.numberOfUnitsInAllyNotOwnTeam(greaterThan=0,withTag='别西卜瘟疫',withinRange=300) or numberOfUnitsInTeam(greaterThan=0,withTag='魔王之心')

[projectile_1]
tags= T-projectile
directDamage: 30
life: 50
speed: 5
image: 暴食.png
spawnProjectilesOnExplode: 1(spawnChance=0.3,maxSpawnLimit=50,offsetRandomXY=55)
spawnUnit: 额外伤害(addResources=energy:4)

[projectile_1附]
tags= T-projectile
directDamage: 0
life: 50
speed: 5
image: null.png
spawnUnit: 额外伤害(addResources=energy:4), 别西卜瘟疫(spawnChance=0.1)
spawnProjectilesOnExplode: 1(spawnChance=0.5,maxSpawnLimit=50,offsetRandomXY=55)


[movement]
movementType: AIR
moveSpeed: 4
moveAccelerationSpeed: 0.03
moveDecelerationSpeed: 0.02

joinsGroupFormations: false

maxTurnSpeed: 1.5
turnAcceleration: 0.12

moveSlidingMode: false
moveIgnoringBody: false
moveSlidingDir: -1

slowDeathFall: true