
[core]
name:枝繁叶茂
displayDescription: -蔓延虫塔
class: CustomUnitMetadata
price: 0
maxHp: 1
mass: 999999

tags=magic

disableAllUnitCollisions: true
isUnselectable:true
ignoreInUnitCapCalculation: true

showInEditor:false

canNotBeDirectlyAttacked:true

showOnMinimapToEnemies: false

techLevel: 1
buildSpeed: 3.33s
#availableInDemo: true

radius: 10
displayRadius: 10

isBio: false
isBuilding: true
footprint: 1,1,-1,-1
constructionFootprint: 1,1,-1,-1
softCollisionOnAll: 0

numBitsOnDeath: 0
explodeOnDeath: false
hideScorchMark: false

[hiddenAction_created]
autoTriggerOnEvent: completeAndActive
spawnEffects: CUSTOM:大毒雾*8

[hiddenAction_boom]
autoTrigger: if not self.timeAlive(laterThanSeconds=7)
fireTurretXAtGround: 1
fireTurretXAtGround_withOffset:0,0
fireTurretXAtGround_withProjectile: 1

[hiddenAction_boom2]
@copyFromSection: hiddenAction_boom
fireTurretXAtGround_withProjectile: 2

[action_kill]
autoTrigger: if self.timeAlive(laterThanSeconds=7) and not ${JiaohongYanli} or ${JiaohongYanli} and self.timeAlive(laterThanSeconds=60)
deleteSelf: true
isVisible: false

[effect_大毒雾]
stripIndex: effects
frameIndex: 0
priority:low

life: 150
fadeOut: true
attachedToUnit: false
color: #AEFF00
fadeInTime:5
hSpeed: 1
scaleFrom: 3.5
scaleTo: 5.0
alpha: 0.5
drawUnderUnits:false
#yOffsetRelative:-7
dirOffsetRandom: 180
xOffsetRelativeRandom:15
yOffsetRelativeRandom:15
xSpeedRelativeRandom:1.6
ySpeedRelativeRandom:1.6

shadow: true
atmospheric: true

[graphics]
total_frames: 1
#imageScale: 0.8
image:        null.png
image_wreak:  NONE
image_turret: NONE

image_shadow: AUTO
shadowOffsetX:1
shadowOffsetY:1

disableLowHpSmoke: true

[attack]
canAttack: true
canAttackFlyingUnits: false
canAttackLandUnits:   false
canAttackUnderwaterUnits: false

turretTurnSpeed: 1000

maxAttackRange: 220
shootDelay: 0

[turret_1]
x: 0
y: 0

[projectile_1]
areaDamage:0
life: 50
invisible:true
instant:true
spawnUnit:虫塔(gridAlign=true, addResources=野性:1)
targetGround: true
targetGroundSpread: 220
explodeEffect: CUSTOM:毒雾3*3

[projectile_2]
areaDamage:0
life: 50
invisible:true
instant:true
spawnUnit:虫墙(gridAlign=true, addResources=野性:1)
targetGround: true
targetGroundSpread: 250
explodeEffect: CUSTOM:毒雾3*2

[resource_野性]
displayName: 野性

[effect_毒雾3]
#死亡喷射
stripIndex: effects
frameIndex: 0
priority:low

life: 180
fadeOut: true
attachedToUnit: false
color: #AEFF00
fadeInTime:4
hSpeed: 0.6
scaleFrom: 0.8
scaleTo: 2.2
alpha: 0.4
drawUnderUnits:false
#yOffsetRelative:-7
xSpeedRelativeRandom:0.2
ySpeedRelativeRandom:0.2

shadow: true
atmospheric: true

[movement]
movementType: LAND
moveSpeed: 0
moveAccelerationSpeed: 0.0
moveDecelerationSpeed: 0.0
targetHeight:0

maxTurnSpeed: 0.0
turnAcceleration: 0.0

moveSlidingMode :false
moveIgnoringBody:false

[ai]
disableUse:true


#————联动-未来科技:皎红————

@global JiaohongYanli: (self.globalTeamTags(includes='衍黎') and self.globalTeamTags(includes='皎红'))

[hiddenAction_虚红感染区]
autoTrigger: if ${JiaohongYanli} and not self.tags(includes='虚红感染区')
temporarilyAddTags: 虚红感染区

[hiddenAction_虚红感染雾]
autoTrigger: if numberOfUnitsInTeam(withTag='虚红感染区', withinRange=600)<4 and ${JiaohongYanli}
spawnEffects: 感染*3

[effect_感染]
priority: verylow
life: 300
fadeInTime: 30
image: fog.png
color:#ff0000
scaleFrom:1.5
scaleTo:2
attachedToUnit:false
drawUnderUnits: true
alpha:0.15
atmospheric: true
ySpeedAbsolute:-0.2
xSpeedRelativeRandom:0.1
delayedStartTimerRandom:60
hSpeed:0.3
hSpeedRandom:0.1
dirSpeedRandom: 0.1
dirOffsetRandom: 180
xOffsetRelativeRandom:420
yOffsetRelativeRandom:420


[template_提取目标]
takeResources_includeUnitsWithinRange: 600
takeResources_includeUnitsWithinRange_team: own
takeResources_excludeUnitsWithoutTags: units
takeResources_discardCollected: true
takeResources_maxUnits: 9999

[template_提取目标2]
@copyFromSection: template_提取目标
autoTrigger: if numberOfUnitsInTeam(withTag="units", greaterThan=0, withinRange=${section.takeResources_includeUnitsWithinRange}) and ${JiaohongYanli}

[hiddenAction_虚红感染附中检测]
@copyFromSection: template_提取目标2
autoTriggerOnEvent: newMessage(withTag='虚红感染更新')
autoTrigger: if numberOfUnitsInTeam(withTag="units", greaterThan=0, withinRange=${section.takeResources_includeUnitsWithinRange}) and ${JiaohongYanli} and numberOfUnitsInTeam(withTag='虚红感染附停系统激活')<1
requireConditional: if numberOfUnitsInTeam(withTag="units", greaterThan=0, withinRange=${section.takeResources_includeUnitsWithinRange}) and ${JiaohongYanli} and numberOfUnitsInTeam(withTag='虚红感染附停系统激活')<1
takeResources: hp=0
takeResources_excludeUnitsWithTheseResources: 虚红感染附中=10
takeResources_triggerActionForEach: 虚红感染附中

[hiddenAction_虚红感染附中]
requireConditional: if thisActionTarget.resource.虚红感染附停<1
takeResources: 虚红感染附中=-2, 虚红感染附停=-1
takeResources_includeReference: thisActionTarget
takeResources_discardCollected: true
sendMessageTo: globalSearchForFirstUnit(withTag='单位系统', relation='own')
sendMessageWithTags: 虚红感染附停激活

fireTurretXAtGround: magic
fireTurretXAtGround_withProjectile: 虚红感染特效
fireTurretXAtGround_withTarget: thisActionTarget.getOffsetAbsolute(y=-thisActionTarget.height)


[hiddenAction_虚红感染附加检测]
@copyFromSection: template_提取目标2
takeResources: hp=0
takeResources_excludeUnitsWithTheseResources: 虚红感染=2
takeResources_triggerActionForEach: 虚红感染时间

[hiddenAction_虚红感染时间]
requireConditional: if thisActionTarget.resource.虚红感染附中>=10
takeResources: 虚红感染=-1
takeResources_includeReference: thisActionTarget
takeResources_discardCollected: true


[hiddenAction_虚红感染负面检测]
@copyFromSection: template_提取目标2
takeResources: hp=0
takeResources_triggerActionForEach: 虚红感染负面恢复

[hiddenAction_虚红感染负面恢复]
requireConditional: if thisActionTarget.resource.虚红感染负面状态>=1
takeResources: 虚红感染负面状态=1, 负虚红感染=1
takeResources_includeReference: thisActionTarget
takeResources_discardCollected: true

fireTurretXAtGround: magic
fireTurretXAtGround_withProjectile: 虚红感染特效2
fireTurretXAtGround_withTarget: thisActionTarget.getOffsetAbsolute(y=-thisActionTarget.height)


[resource_虚红感染附中]
displayName: 虚红感染附中
hidden: true

[resource_虚红感染附停]
displayName: 虚红感染附停
hidden: true

[resource_虚红感染]
displayName: 虚红感染
hidden: true

[resource_虚红感染负面状态]
displayName: 虚红感染负面状态
hidden: true

[resource_负虚红感染]
displayName: 负虚红感染
hidden: true

[resource_虚红感染计时]
displayName: 虚红感染计时
hidden: true


[turret_magic]
x: 0
y: 0
invisible: true
canShoot: false

[projectile_虚红感染特效]
directDamage: 0
invisible: true
life: 10
instant: true
targetGround_includeTargetHeight: true
explodeEffect: 虚红感染标, 虚红感染光, 虚红感染散

[projectile_虚红感染特效2]
@copyFromSection: projectile_虚红感染特效
explodeEffect: 虚红感染标, 弱虚红感染光, 弱虚红感染散


[effect_虚红感染标]
priority: low
life: 25
fadeInTime: 2
scaleFrom: 0.2
scaleTo: 0.25
alpha: 0.6
image: 皎红icon.png
attachedToUnit: true
alwayStartDirAtZero: true

[effect_虚红感染光]
priority: low
life: 30
scaleFrom: 1.3
scaleTo: 2.6
alpha: 1
image: SHARED:light_50.png
color: #FF0000
attachedToUnit: true
dirSpeedRandom: 3
dirOffsetRandom: 180

[effect_虚红感染散]
priority: low
life: 160
fadeOut: true
fadeInTime: 5
scaleFrom: 0.08
scaleTo: 0.2
alpha: 0.4
image: 红曜散裂.png
color: #FF0000
attachedToUnit: true

[effect_弱虚红感染光]
@copyFromSection: effect_虚红感染光
alpha: 0.8

[effect_弱虚红感染散]
@copyFromSection: effect_虚红感染散
life: 80
scaleTo: 0.16


[arm_1]
x: 0
y: 0
image_end: SHARED:blank.png
spinRate: 0.1

[arm_2]
@copyFromSection: arm_1
spinRate: 0.3

[arm_3]
@copyFromSection: arm_1
spinRate: -0.01

[decal_虚红感染区]
isVisible: if numberOfUnitsInTeam(withTag='虚红感染区', withinRange=600)<20 and ${JiaohongYanli}
alwaysStartHeightAtZero: true
layer: shadow
image: 红光圈2.png
basePositionFromLegEnd: arm1
imageScale: 2.7
alpha: 0.05 * min(60-self.timeAlive, 1) * min(self.timeAlive, 1)

[decal_感染显示圈]
isVisible: if numberOfUnitsInTeam(withTag='虚红感染区', withinRange=80)<3 and ${JiaohongYanli}
alwaysStartHeightAtZero: true
alwaysStartDirAtZero: true
layer: beforeUI
image: 红范围圈1200.png
imageScale: ${600/600}
alpha: 0.2 * min(60-self.timeAlive, 1) * min(self.timeAlive, 1)

[decal_感染红区]
isVisible: if numberOfUnitsInTeam(withTag='虚红感染区', withinRange=600)<15 and ${JiaohongYanli}
alwaysStartHeightAtZero: true
layer: beforeUI
image: 红范围底.png
imageScale: ${600/600}
alpha: ( 0.05 / max( (numberOfUnitsInTeam(withTag='虚红感染区', withinRange=600) /2), 1 ) ) * min(60-self.timeAlive, 1) * min(self.timeAlive, 1)

[decal_感染环圈]
@copyFromSection: decal_虚红感染区
isVisible: if numberOfUnitsInTeam(withTag='虚红感染区', withinRange=600)<3 and ${JiaohongYanli} and not self.globalTeamTags(includes='关闭感染区高级效果')
basePositionFromLegEnd: arm2
image: 红外光圈2.png
imageScale: ${2.7 * 0.73}

[decal_黑感染环圈]
@copyFromSection: decal_感染环圈
image: 黑红外光圈2.png
dirOffset: 60

[decal_感染裂面]
isVisible: if numberOfUnitsInTeam(withTag='虚红感染区', withinRange=600)<4 and ${JiaohongYanli} and not self.globalTeamTags(includes='关闭感染区高级效果')
alwaysStartHeightAtZero: true
layer: shadow
image: 红散裂.png
imageScale: ${2.7 * 0.15} * (0.95 + cos( ${timer_10s} * 360 - ${b}) * 0.05)
basePosition: getOffsetRelative(x=0, y=0, dirOffset=self.timeAlive-self.dir)
onlyWithZoomLevelOrMore: 0.7

@define timer_10s: ((self.timeAlive() % 10) / 10)
alpha: ( 0.05+cos( ${timer_10s} * 360 - ${b}) * 0.04 * min(60-self.timeAlive, 1) ) * min(self.timeAlive, 1)
@define b: 0

[decal_感染裂面2]
@copyFromSection: decal_感染裂面
imageScale: ${2.7 * 0.2} * (0.95 + cos( ${timer_10s} * 360 - ${b}) * 0.05)
@define b: 72

[decal_感染裂面3]
@copyFromSection: decal_感染裂面
imageScale: ${2.7 * 0.3} * (0.95 + cos( ${timer_10s} * 360 - ${b}) * 0.05)
@define b: 144

[decal_感染裂面4]
@copyFromSection: decal_感染裂面
imageScale: ${2.7 * 0.45} * (0.95 + cos( ${timer_10s} * 360 - ${b}) * 0.05)
alpha: ( 0.04+cos( ${timer_10s} * 360 - ${b}) * 0.03 * min(60-self.timeAlive, 1) ) * min(self.timeAlive, 1)
@define b: 216

[decal_感染裂面5]
@copyFromSection: decal_感染裂面
imageScale: ${2.7 * 0.65} * (0.95 + cos( ${timer_10s} * 360 - ${b}) * 0.05)
alpha: ( 0.04+cos( ${timer_10s} * 360 - ${b}) * 0.03 * min(60-self.timeAlive, 1) ) * min(self.timeAlive, 1)
@define b: 288


[decal_感染缠乱线]
isVisible: if numberOfUnitsInTeam(withTag='虚红感染区', withinRange=600)<3 and ${JiaohongYanli} and not self.globalTeamTags(includes='关闭感染区高级效果')
alwaysStartHeightAtZero: true
layer: shadow
image: 红缠乱线.png
imageScale: ${2.7 * 0.5} * (0.8 + cos( ${timer_20s} * 360 - ${b}) * 0.2)
basePosition: getOffsetRelative(x=0, y=0, dirOffset=-self.timeAlive*2 -self.dir)
onlyWithZoomLevelOrMore: 0.5

@define timer_20s: ((self.timeAlive() % 20) / 20)
alpha: ( 0.35+cos( ${timer_20s} * 360 - ${b}) * 0.25 * min(60-self.timeAlive, 1) ) * min(self.timeAlive, 1)
@define b: 0

[decal_感染缠乱线2]
@copyFromSection: decal_感染缠乱线
dirOffset: 90
@define b: 90

[decal_感染缠乱线3]
@copyFromSection: decal_感染缠乱线
dirOffset: 180
@define b: 180

[decal_感染缠乱线4]
@copyFromSection: decal_感染缠乱线
dirOffset: 270
@define b: 270

[decal_内感染缠乱线]
@copyFromSection: decal_感染缠乱线
isVisible: if numberOfUnitsInTeam(withTag='虚红感染区', withinRange=600)<2 and ${JiaohongYanli} and not self.globalTeamTags(includes='关闭感染区高级效果')
imageScale: ${2.7 * 0.5} * (0.4 + cos( ${timer_20s} * 360 - ${b}) * 0.2)
alpha: ( 0.45+sin( ${timer_20s} * 360 - ${b}) * 0.25 * min(60-self.timeAlive, 1) ) * min(self.timeAlive, 1)
dirOffset: 45
@define b: 45

[decal_内感染缠乱线2]
@copyFromSection: decal_内感染缠乱线
dirOffset: 135
@define b: 135

[decal_内感染缠乱线3]
@copyFromSection: decal_内感染缠乱线
dirOffset: 225
@define b: 225

[decal_内感染缠乱线4]
@copyFromSection: decal_内感染缠乱线
dirOffset: 315
@define b: 315
