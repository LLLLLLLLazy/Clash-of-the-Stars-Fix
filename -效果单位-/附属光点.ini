
[core]
name: 附属光点
tags: 附属光点, 效果单位
maxHp: 1
price: 0
mass: 0

#隐藏单位本身
showInEditor: false
radius: 0
fogOfWarSightRange: 0
showOnMinimap: false
ignoreInUnitCapCalculation: true
disableAllUnitCollisions: true
isUnselectable:	true
canNotBeDirectlyAttacked: true

#禁止死亡痕迹
numBitsOnDeath:	0
explodeOnDeath:	false
hideScorchMark: true

@memory 透明度:float

@memory 中心x:float
@memory 中心y:float
@memory 光弦角度:float
@memory 弦数:float
@memory 时间补正:float
updateUnitMemory: 光弦角度=memory.光弦角度-0.08, 弦数=memory.弦数+0.0012
updateUnitMemoryRate: 0.01

autoTriggerCooldownTime: 0.01s
autoTriggerCooldownTime_allowDangerousHighCPU:true

[hiddenAction_利维坦]
autoTrigger: if self.hasFlag(id=1)
spawnEffects: CUSTOM:预热光
addResources: unsetFlag=1



[hiddenAction_苍蓝出场]
autoTriggerOnEvent: created
requireConditional: if self.hasFlag(id=2)
setUnitMemory: 透明度=1, 时间补正=min(customTarget1.timeAlive, customTarget1.lastConverted), 光弦角度=customTarget1.readUnitMemory("光弦角度", type='float'), 中心x=customTarget1.x, 中心y=customTarget1.y

[hiddenAction_苍蓝光弦1]
autoTrigger: if self.hasFlag(id=2) and self.ammo!=1
teleportTo: createMarker(x=memory.中心x, y=memory.中心y).getOffsetRelative(x=cos( (memory.弦数+memory.时间补正+0.62 % 1) * 360) * 75, y=sin( (memory.弦数+memory.时间补正+0.62 % 1) * 360) * 200, dirOffset=memory.光弦角度)

[hiddenAction_苍蓝光弦2]
autoTrigger: if self.hasFlag(id=2) and self.ammo==1
teleportTo: createMarker(x=memory.中心x, y=memory.中心y).getOffsetRelative(x=sin( (memory.弦数+memory.时间补正 % 1) * 360) * 135, y=cos( (memory.弦数+memory.时间补正 % 1) * 360) * 135, dirOffset=memory.光弦角度)

[hiddenAction_苍蓝光点消散tag]
autoTrigger: if self.hasFlag(id=2) and (numberOfUnitsInTeam(withTag="贝露之眼", withinRange=360, greaterThan=0) or numberOfUnitsInAllTeams(withTag="苍蓝出场", greaterThan=2) and self.ammo!=1) and not self.tags(includes="光点消散")
temporarilyAddTags: 光点消散

[hiddenAction_苍蓝光点消散]
autoTrigger: if self.hasFlag(id=2) and self.tags(includes="光点消散") and self.ammo!=1
setUnitMemory: 透明度=memory.透明度-0.0065

[hiddenAction_苍蓝光点消散2]
autoTrigger: if self.hasFlag(id=2) and self.tags(includes="光点消散") and self.ammo==1
setUnitMemory: 透明度=memory.透明度-0.0055

[hiddenAction_苍蓝光点消失]
autoTrigger: if self.hasFlag(id=2) and (self.readUnitMemory('透明度',type='float') <= 0 or numberOfUnitsInAllTeams(withTag="附属光点", greaterThan=800))
deleteSelf: true

[decal_苍蓝光点]
onlyWhileAlive: true
layer: shadow
image: 蓝光球.png
imageScale: 0.5
alpha: self.readUnitMemory('透明度',type='float')



[graphics]
image: 大空.png
disableLowHpSmoke: true
disableLowHpFire: true
icon_zoomed_out_neverShow: true

[attack]
canAttack: false

[effect_预热光]
image: SHARED:light_50.png
life: 400
fadeOut: true
attachedToUnit: true
liveAfterAttachedDies: false
color: #ff3bff00
fadeInTime: 95
scaleFrom: 0.5
scaleTo: 0.5
alpha: 0.8

[movement]
movementType: AIR
moveSpeed: 0
targetHeight: 0
targetHeightDrift: 0
ignoreMoveOrders: true