[core]
showInEditor: false
name: 有毒的雾
displayDescription: -持续毒素效果
maxHp: 100
mass: 100
price: 0
radius: 0
tags=magic, ${tag}
@global tag: 毒素
disableAllUnitCollisions: true
canNotBeDirectlyAttacked: true
canNotBeDamaged: true
isUnselectableAsTarget: true
showOnMinimap: false
fogOfWarSightRange: 0
dieOnZeroEnergy: true
isUnselectable: true
isUnrepairableUnit: true
#canNotBeGivenOrdersByPlayer: true
numBitsOnDeath: 0
explodeOnDeath: false
hideScorchMark: false
buildSpeed: 3.33s

@memory 锁定目标:unit

autoTriggerCooldownTime: 0.1s

[hiddenAction_攻击]
autoTriggerOnEvent: completeAndActive
autoTrigger: if not self.hasFlag(id=1)
addWaypoint_type: attack
addWaypoint_target_nearestUnit_maxRange: 200
addWaypoint_target_nearestUnit_team: enemy
addWaypoint_target_nearestUnit_tagged: units, 可承伤单位, 漂浮灵

[hiddenAction_锁定攻击]
autoTrigger: if self.hasFlag(id=1) and activeWaypointTarget!=memory.锁定目标
addWaypoint_type: attack
addWaypoint_target_nearestUnit_maxRange: 500
addWaypoint_target_nearestUnit_team: enemy
addWaypoint_target_fromReference: memory.锁定目标

[hiddenAction_锁定目标]
setUnitMemory: 锁定目标=attacking
teleportTo: memory.锁定目标
alsoTriggerAction: 仅有一个, 锁定完成

[hiddenAction_传送目标]
autoTrigger: if distanceBetween(memory.锁定目标, self)>1
teleportTo: memory.锁定目标

[hiddenAction_仅有一个]
requireConditional: if nearestUnit(withTag='${tag}')!=self and nearestUnit(withTag='${tag}').readUnitMemory("锁定目标", type='unit') == memory.锁定目标 or numberOfUnitsInTeam(withTag='${tag}', withinRange=2)>1
deleteSelf: true

[hiddenAction_锁定完成]
requireConditional: if nearestUnit(withTag='${tag}')==self or nearestUnit(withTag='${tag}').readUnitMemory("锁定目标", type='unit') != memory.锁定目标
addResources: setFlag=1

[hiddenAction_消失]
autoTrigger: if (memory.锁定目标.hp+memory.锁定目标.shield<=0 or memory.锁定目标.resource.毒素<=1 and memory.锁定目标.resource.弱效毒素<=1 or memory.锁定目标==null) and self.hasFlag(id=1) or (self.timeAlive>0.1 or numberOfUnitsInTeam(withTag='${tag}', withinRange=10)>2) and not self.hasFlag(id=1)
deleteSelf: true

[graphics]
image: SHARED:blank.png
isVisible: false
showEnergyBar: false
disableLowHpFire: true
disableLowHpSmoke: true

[attack]
canAttack: true
canAttackFlyingUnits: true
canAttackLandUnits: true
canAttackUnderwaterUnits: true
turretTurnSpeed: 999
maxAttackRange: 20
shootDelay: 1s
isMelee: true

[turret_锁定]
x: 0
y: 0
projectile: 空
canAttackCondition: if memory.锁定目标==nullUnit
onShoot_triggerActions: 锁定目标

[turret_1]
x: 0
y: 0
invisible: true
canAttackCondition: if memory.锁定目标!=nullUnit

[projectile_1]
#areaDamage: 3
#areaRadius: 35
#areaRadiusFromEdge: true
#areaHitAirAndLandAtSameTime: true
directDamage: -1
mutatorX_ifUnitWithoutTags: ʚ♡⃛ɞ(ू•ᴗ•ू❁)
mutatorX_directDamageMultiplier: 0.0000001
life: 50
instant: true
explodeEffect: CUSTOM:毒雾*2
explodeEffectOnShield: CUSTOM:毒雾*2

#shieldDefectionMultiplier: 0
#shieldDamageMultiplier: 0

#mutatorX_ifUnitWithTags: 防毒
#mutatorX_areaDamageMultiplier: 0.5

#mutator1_ifUnitWithTags: 效果免疫
#mutator1_areaDamageMultiplier: 0

[projectile_空]
directDamage: 0
life: 0
speed: 0
invisible: true
explodeEffect: NONE
explodeEffectOnShield: NONE

[effect_毒雾]
priority: verylow
attachedToUnit: false
life: 100
alpha: 0.8
scaleFrom: 1.0
scaleTo: 1.5
image: 毒雾.png
drawUnderUnits: false
atmospheric: true
xSpeedRelativeRandom: 0.2
ySpeedRelativeRandom: 0.2

[resource_毒素]
displayName: 毒素

[resource_弱效毒素]
displayName: 弱效毒素

[movement]
movementType: OVER_CLIFF_WATER
moveSpeed: 0.2
maxTurnSpeed: 10
targetHeight: 0