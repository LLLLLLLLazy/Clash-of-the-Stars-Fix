
[core]
name: 实验型维修飞艇
displayDescription: -远距离维修单位 \n -维修效率高 \n -副维修塔可边移动边修复 \n -可释放维修机 \n -装甲较脆弱 \n -自我维修 \n \n -2025.1.30 冠军限定-
class: CustomUnitMetadata
price: 60000
maxHp: 4000
mass: 90000
tags: units, 实验型维修飞艇


techLevel: 1
experimental: true

buildSpeed: 0.0002
#availableInDemo: true

radius: 35
#displayRadius: 25

isBio: false
softCollisionOnAll: 6

transportSlotsNeeded: 5

isBuilder: true
canRepairBuildings: true
canRepairUnits : true


canReclaimResources: true

autoRepair: true

nanoRange: 440

nanoRepairSpeed: 2
nanoBuildSpeed: 6

selfRegenRate: 0.2

builtFrom_1_name: experimentalLandFactory
builtFrom_1_pos:  5.5

@memory 命令坐标: unit

@memory engineOutput: float
@memory previousDir: float
@memory currentTurnRateRaw: float
@memory currentTurnRateNormalized: float
@memory flickerProgress: float

@define isMovingCondition: self.isMoving()
updateUnitMemory: engineOutput=max(0, min(${engineWarmupTime}, memory.engineOutput+select(${isMovingCondition},1,-1))), currentTurnRateRaw = self.Dir() - memory.previousDir, currentTurnRateNormalized = select(memory.currentTurnRateRaw > 180, memory.currentTurnRateRaw - 360, select(memory.currentTurnRateRaw < -180, 360 + memory.currentTurnRateRaw, memory.currentTurnRateRaw))/${movement.maxTurnSpeed+0.001}, previousDir = self.Dir(), flickerProgress = (self.timeAlive * ${60*flickerSpeed}) % 2
updateUnitMemoryRate: 0.015s

autoTriggerCooldownTime: 3
autoTriggerCooldownTime_allowDangerousHighCPU:true

@memory 指定坐标:unit

[action_范围回收]
@copyFromSection: template_无距范围回收
@define turret: skill

[hiddenAction_回收路径]
@copyFromSection: template_回收路径

[decal_回收范围]
@copyFromSection: template_回收范围


[canBuild_1]
name: reclaim
pos: -1

[action_冠军签名]
iconImage: 文一-签名.png
isVisible: if self.timeAlive < 10
isActive: false
id: 冠军签名
description: -冠军签名- \n (10s后隐藏)
pos: 99
displayType: infoOnlyStockpile
buildSpeed: 0s


[action_1]
pos: 1
id: ${section.text}
text: 浮游维修
description: -释放四个浮游维修机向指定位置 \n -到达指定位置后自动维修最近的单位 \n -不会被敌方单位攻击 \n -维修时持续时间: 20s \n -冷却时间: 60s
price: 2000
buildSpeed: 0.5s
displayType: action
unitShownInUI: 浮游维修机
allowMultipleInQueue: false
fireTurretXAtGround: skill
fireTurretXAtGround_showGuideDecals: 技能范围圈, 指定线
setUnitMemory: 命令坐标=thisActionTarget
addActionCooldownTime: 60s

[decal_技能范围圈]
basePosition: self
layer: inactive
image: 范围圈1000.png
imageScale: ${800/500}
alpha: 0.5
alwaysStartHeightAtZero: true

[decal_指定线]
layer: inactive
alpha: 0.5
color: #63e6e8
drawLineTo: getOffsetRelative(height=-self.height)
alwaysStartHeightAtZero: true


[attachment_1]
x: -17
y: -20
isUnselectable: false
onCreateSpawnUnitOf: 实验型维修飞艇-维修塔
showAllActionsFrom: true
setDrawLayerOnTop: true
lockRotation: true

[attachment_2]
@copyFromSection: attachment_1
x: 17


[hiddenAction_气波]
autoTrigger: true
spawnEffects: 气波

[graphics]
image:        维修飞艇上层.png
image_wreak: 修复舰死亡2.png

image_shadow: AUTO
shadowOffsetX:1
shadowOffsetY:1

[decal_1]
onlyWhileAlive: true
order: 0
layer: beforeBody
image: 维修飞艇下层喷气口.png
image_shadow: SHADOW:${section.image}
shadowOffsetX:1
shadowOffsetY:1

[effect_气波]
priority: verylow
createWhenZoomedOut: false
image: rotorwash.png
life: 30
lifeRandom: 5
fadeOut: true
attachedToUnit: true
fadeInTime: 2
scaleFrom: 0.5
scaleTo: 1.5
alpha: 0.2
color: #FAFAFA
drawUnderUnits: true
dirOffsetRandom: 180
dirSpeedRandom: 0.6
ySpeedRelative: -0.2

#- - - - -尾焰- - - - - 来源:更多实验单位
@global engineWarmupTime: 45
@global flickerSpeed: 0.3
@global flickerExtent: 0.1

[template_decalFlame]
onlyWithZoomLevelOrMore: 0.26
@define scaleX:1
@define scaleY:1
order: 1
layer: beforeBody
total_frames: 1
image: fireNozzleRed.png
frame: 0
teamColors: false
onlyOnNonPreview: true
imageScaleX: ${scaleX * 0.5}
imageScaleY: ${scaleY * 0.5} * memory.engineOutput/${engineWarmupTime} * min(1.5, max(0.5, (1 - 2 * memory.currentTurnRateNormalized*${section.xOffsetRelative / core.radius}) )) * (${0.7 - flickerExtent} + ${2 * flickerExtent} * select(memory.flickerProgress > 1, 2 - memory.flickerProgress, memory.flickerProgress) )
#It looks weird when imageScaleY is very low...
alpha: memory.engineOutput/${engineWarmupTime} * min(1.5, max(0.5, (1 - memory.currentTurnRateNormalized*${section.xOffsetRelative / core.radius}) ))

[decal_flame1]
@copyFromSection: template_decalFlame
xOffsetRelative: -15
yOffsetRelative: -41
imageScale: 0.75
@define scaleY: 1

[decal_flame2]
@copyFromSection: decal_flame1
xOffsetRelative: 15
#- - - - - - - - - -

[attack]
canAttack: false
canAttackFlyingUnits: false
canAttackLandUnits:   false
canAttackUnderwaterUnits: false

turretSize: 1
turretTurnSpeed: 4
maxAttackRange: 440
shootDelay: 25

isFixedFiring: true

turretRotateWithBody: false
showRangeUIGuide: true

[turret_1]
#nano turret (nano must be slot 1)
x: 0
y: 45
invisible: true
warmup: 30

canShoot: false
canAttackFlyingUnits: false
canAttackLandUnits:   false
canAttackUnderwaterUnits: false
isMainNanoTurret: true

turnSpeedAcceleration: 0.08

[turret_skill]
x: 0
y: 0
canShoot: false
limitingRange: 9999
projectile: 2

[projectile_null]
directDamage: 0
life: 0
speed: 0
invisible: true

[projectile_2]
directDamage: 0
life: 0
speed: 0
turnSpeed: 0
invisible: true
spawnProjectilesOnCreate: 3(xOffsetRelative=3, yOffsetRelative=-10, offsetDir=135), 3(xOffsetRelative=-3, yOffsetRelative=-10, offsetDir=-135), 3(yOffsetRelative=12, offsetDir=45), 3(yOffsetRelative=12, offsetDir=-45)

[projectile_3]
directDamage: 0
life: 1
speed: 0
turnSpeed: 0
invisible: true
explodeOnEndOfLife: true
explodeEffect: NONE
spawnUnit: 浮游维修机(offsetHeight=32)

[movement]
movementType: AIR
moveSpeed: 1
moveAccelerationSpeed: 0.02
moveDecelerationSpeed: 0.01

maxTurnSpeed: 2
turnAcceleration: 0.06

reverseSpeedPercentage: 0

moveSlidingMode :true
moveIgnoringBody:true
moveSlidingDir:  45

slowDeathFall: true


