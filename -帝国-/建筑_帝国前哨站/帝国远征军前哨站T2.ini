[core]


copyFrom: ROOT:/-帝国-/建筑_帝国前哨站/技能/黑障_建筑/黑障之护.template
tags: units, 帝国前哨站, 帝国前哨站T2, 基地, 步兵塔, 资源池建筑
name: T2 - 帝国远征军前哨站
maxHp: 5000
mass: 100
price: 22000
radius: 50
generation_credits: 52
borrowResourcesWhileAlive: 支配值=-20
isBuilding: true
isBio: false
footprint: -2,-1,2,1
constructionFootprint: -2,-1,2,1
buildingToFootprintOffsetY: 17
maxShield: 1000
shieldRegen: 0.3
fogOfWarSightRange: 34
maxTransportingUnits: 5
transportUnitsRequireTag: 步兵
nanoFactorySpeed: 2
canBuild_1_name: 帝国建造者T2
canBuild_2_name: 帝国侦察坦克T2
#canBuild_3_name: 巡警
isPickableStartingUnit: true
effectOnDeath: CUSTOM:shockwaveLarge, largeExplosion, CUSTOM:explosionFlashLarge, CUSTOM:黑碎光*10
soundOnDeath: buiding_explode: 1
displayDescription: -帝国在星球上的基地\n-辽阔视野\n-生产资金\n-不自带攻击能力\n-可驻守五名步兵\n-提升驻守步兵的30攻击范围\n-起始基地被毁会损失资源\n-帝国技能冷却时间: 600s
numBitsOnDeath: 20
energyMax: 600
energyRegen: 0.01666

autoTriggerCooldownTime: 0.1s

[hiddenAction_破碎之星]
autoTriggerOnEvent: destroyed
requireConditional: if self.hasResources(起始基地=1)
spawnUnits: 碎星核, 基地亡语

[resource_起始基地]
displayName: 起始基地


[action_前哨训练营]
isVisible: if not self.globalTeamTags(includes='前哨训练营')
addGlobalTeamTags: 前哨训练营
id: ${section.text}
pos: 10
price: 1000
text: 前哨训练营
description: -解锁后帝国前哨站可生产T1步兵
displayType: upgrade
buildSpeed: 16.7s
allowMultipleInQueue: false

[canBuild_3]
isVisible: if self.globalTeamTags(includes='前哨训练营')
name: 帝国斥候, 再生战士, 帝国士兵, 帝国掷弹兵, 帝国机枪兵, 帝国狙击手, 帝国防空兵

[canBuild_4]
isVisible: if self.resource(type="支配度", greaterThan=99) and self.globalTeamTags(includes='前哨训练营')
name: 战斗飞盘, 外骨骼装甲, 帝国毒气兵, 帝国战卫军, 光粒步兵, 帝国蜂火兵, 青蛙步兵, 武装防空兵, 帝国剑士[旋刃], 帝国导弹兵, 爆破师, 装甲猎手[伏击], 帝国布雷兵


[hiddenAction_支配度1]
autoTriggerOnEvent: destroyed
autoTrigger: if self.resource(type='支配值', greaterThan=0) or self.resource(type='支配值', lessThan=10) and self.resource(type='支配度', greaterThan=0)
requireConditional: if self.resource(type='支配值', lessThan=101) and  self.numberOfUnitsInAllyNotOwnTeam(withTag="支配满", lessThan=1) and numberOfUnitsInEnemyTeam(withTag="支配满", lessThan=1) and numberOfUnitsInNeutralTeam(withTag="支配满", lessThan=1)
setResourcesWithLogic: 支配度=max(self.resource.支配值, 0)

[hiddenAction_支配度上限100]
autoTrigger: if self.resource(type='支配值', greaterThan=100) and (self.resource(type='支配度', greaterThan=100) or self.resource(type='支配度', lessThan=91)) and self.numberOfUnitsInAllyNotOwnTeam(withTag="支配满", lessThan=1) and numberOfUnitsInEnemyTeam(withTag="支配满", lessThan=1) and numberOfUnitsInNeutralTeam(withTag="支配满", lessThan=1)
resourceAmount: 支配度
resourceAmount_setValue: 100

[hiddenAction_支配度2]
requireConditional: if self.resource(type='支配值', lessThan=91) and  (self.numberOfUnitsInAllyNotOwnTeam(withTag="支配满", greaterThan=0) or numberOfUnitsInEnemyTeam(withTag="支配满", greaterThan=0) or numberOfUnitsInNeutralTeam(withTag="支配满", greaterThan=0))
@copyFromSection: hiddenAction_支配度1

[hiddenAction_支配度上限90]
autoTrigger: if self.resource(type='支配值', greaterThan=90) and self.resource(type='支配度', greaterThan=90) and  (self.numberOfUnitsInAllyNotOwnTeam(withTag="支配满", greaterThan=0) or numberOfUnitsInEnemyTeam(withTag="支配满", greaterThan=0) or numberOfUnitsInNeutralTeam(withTag="支配满", greaterThan=0))
resourceAmount: 支配度
resourceAmount_setValue: 90

[canBuild_Rally]
name: setRally

[action_生存防御巩固]
@copyFromSection: template_生存防御巩固
@define buildMultiplier: 2
pos: 0.1

[effect_生存防御巩固形]
@copyFromSection: template_生存防御巩固形

[graphics]
image: 帝前T2.png
image_back: 帝前T2_back.png
image_shield: null.png
imageScale: 1.2

[attack]
canAttack: true
canAttackFlyingUnits: true
canAttackLandUnits:   true
canAttackUnderwaterUnits: false

turretSize: 0
turretTurnSpeed: 0

maxAttackRange: 350
shootDelay: 60

showRangeUIGuide: false

[turret_fogOfWarSight]
x: 0
y: 0
#canShoot: false
invisible: true
#limitingRange: ${core.fogOfWarSightRange * 20 - 40}
projectile: 1

[projectile_1]
directDamage: 0
life: 0
invisible: true
targetGround: true

explodeEffect: NONE

[movement]
movementType: BUILDING

[attachment_1]
x: 0
y: 0
height: 15
isVisible: false
addTransportedUnits: true
prioritizeParentsMainTarget: true
#keepAliveWhenParentDies: true
#alwaysAllowedToAttackParentsMainTarget: true
canBeAttackedAndDamaged: false
isUnselectable: true
showAllActionsFrom: if self.transportingUnitWithTags(includes='帝建T1')
[attachment_2]
x: 7
y: 0
height: 14
@copyFromSection: attachment_1
[attachment_3]
x: -7
y: 0
height: 14
@copyFromSection: attachment_1
[attachment_4]
x: 9
y: 0
height: 16
@copyFromSection: attachment_1
[attachment_5]
x: -9
y: 0
height: 16
@copyFromSection: attachment_1


[action_帝皇之征]
displayType: action
id: ${section.text}
text: 帝皇之征
description: 兵马未到 炮火先行\n-火炮部队将以超远射程轰炸此处\n-期间摧毁敌人将获得赏金\n-有效范围: 2000\n(可被影响的单位: 帝国导弹兵,追逐者突击火炮,基因炮手,重炮机械,眼镜蛇火炮)\n(追逐者突击火炮在此状态下有能量限制)
fireTurretXAtGround: magic
fireTurretXAtGround_withProjectile: locating
fireTurretXAtGround_onlyOverPassableTileOf: AIR
fireTurretXAtGround_showGuideDecals: targetFire, targetFireRange
allowMultipleInQueue: false
#unitShownInUI: 
buildSpeed: 0s
pos: 1
highPriorityQueue: true
onlyOneUnitAtATime: true
isAlsoViewableByAllies: true
addActionCooldownTime: 600s
addActionCooldownApplyToActions: 帝皇之征, 星际迁返, 黑障
addGlobalTeamTags: 帝国CD
isLocked: if globalSearchForFirstUnit(withTag='单位系统', relation='own').resource.帝国CD>0
addResources: setFlag=0, energy=-600
alsoQueueAction: 重置

takeResources: 帝国CD=-600
takeResources_includeReference: globalSearchForFirstUnit(withTag='单位系统', relation='own')
takeResources_discardCollected: true

[action_星际迁返]
displayType: action
id: ${section.text}
text: 星际迁回
description: 帝皇邀您归乡\n-召回目标地点的部队\n-瞬间推开目标地点的敌人
fireTurretXAtGround: magic
fireTurretXAtGround_withProjectile: move
fireTurretXAtGround_onlyOverPassableTileOf: AIR
allowMultipleInQueue: false
#unitShownInUI: 
buildSpeed: 0s
pos: 1
highPriorityQueue: true
onlyOneUnitAtATime: true
isAlsoViewableByAllies: true
addActionCooldownTime: 600s
addActionCooldownApplyToActions: 帝皇之征, 星际迁返, 黑障
addGlobalTeamTags: 帝国CD
isLocked: if globalSearchForFirstUnit(withTag='单位系统', relation='own').resource.帝国CD>0
addResources: setFlag=0, energy=-600
alsoQueueAction: 重置

takeResources: 帝国CD=-600
takeResources_includeReference: globalSearchForFirstUnit(withTag='单位系统', relation='own')
takeResources_discardCollected: true

[action_黑障]
displayType: action
fireTurretXAtGround: magic
fireTurretXAtGround_withOffset: 0,0
fireTurretXAtGround_withProjectile: 黑洞
id: ${section.text}
text: 黑障
description: 宛如虚无之境\n-隔绝一切的暗域\n-开启时吞噬领域内的敌人\n-范围: 320
allowMultipleInQueue: false
buildSpeed: 0s
pos: 2
price: 帝国技能=1
highPriorityQueue: true
onlyOneUnitAtATime: true
isAlsoViewableByAllies: true
spawnEffects: custom: curewave
addActionCooldownTime: 600s
addActionCooldownApplyToActions: 帝皇之征, 星际迁返, 黑障
addGlobalTeamTags: 帝国CD
addAllActionCooldownsTime: 30s
isLocked: if globalSearchForFirstUnit(withTag='单位系统', relation='own').resource.帝国CD>0
addResources: setFlag=0, energy=-600
setResourcesWithLogic: 帝国技能=1
alsoTriggerAction: 黑障之境
alsoQueueAction: 重置

takeResources: 帝国CD=-600
takeResources_includeReference: globalSearchForFirstUnit(withTag='单位系统', relation='own')
takeResources_discardCollected: true

[hiddenAction_帝国技能]
autoTrigger: if not self.globalTeamTags(includes='已设定帝国技能')
setResourcesWithLogic: 帝国技能=1
addGlobalTeamTags: 已设定帝国技能

[hiddenAction_能量冷却条]
autoTrigger: if globalSearchForFirstUnit(withTag='单位系统', relation='own').resource.帝国CD>0 and self.isEnergyFull
setResourcesWithLogic: energy=600 - globalSearchForFirstUnit(withTag='单位系统', relation='own').resource.帝国CD

[hiddenAction_帝国CD]
autoTrigger: if self.globalTeamTags(includes='帝国CD') and not self.hasFlag(id=0)
addActionCooldownTime: 600s
addActionCooldownApplyToActions: 帝皇之征, 星际迁返, 黑障
addResources: energy=-600

[hiddenAction_重置]
id: CD重置
buildSpeed: 1s
highPriorityQueue: true
addResources: unsetFlag=0


#--------------------
[action_沙盒-重置冷却]
isVisible: if substring(str(createMarker(x=-1000,y=-1000).nearestUnit),0,15) == "editorOrBuilder"
displayType: action
id: ${section.text}
text: 沙盒-重置冷却
description: -沙盒特供 \n -重置帝国技能冷却
iconImage: SHARED:cone_inverted_normal_128.png
highPriorityQueue: true
buildSpeed: 0.05s
pos: 3
clearAllActionCooldowns: true
takeResources: 帝国CD=600
takeResources_includeReference: globalSearchForFirstUnit(withTag='单位系统', relation='own')
takeResources_directTransferStoppingAtZero: true
setResourcesWithLogic: energy=600, 帝国CD=0
#--------------------


[decal_targetFire]
alwaysStartDirAtZero: true
layer: inactive

image: 帝国.png
imageScale: 1
alpha: 0.6

[decal_targetFireRange]
alwaysStartDirAtZero: true
layer: inactive

image: 黑障.png
imageScale: 8.18
alpha: 0.1


[turret_magic]
x: 0
y: 0
canShoot: false
limitingRange: 9999
barrelHeight: 15

[projectile_locating]
life: 50
directDamage: 0
targetGround: true
instant: true
explodeEffect: CUSTOM:为了帝皇
spawnUnit: 射程强化

[effect_为了帝皇]
priority: critical
attachedToUnit: false
image: 帝国.png
life: 100
scaleFrom: 1
scaleTo: 1.2

[projectile_move]
life: 60
speed: 5
instant: true
areaDamage: 0
areaRadius: 320
areaHitAirAndLandAtSameTime: true
areaExpandTime: 10
laserEffect: true
color: #000000
spawnUnit: 迁跃
pushForce: 50
pushVelocity: 20
explodeEffect: NONE
explodeEffectOnShield: NONE

[projectile_黑洞]
areaDamage: 0
areaRadius: 320
life: 25
speed: 0
targetGround: true
explodeOnEndOfLife: true
deflectionPower: -1
invisible: true
explodeEffect: NONE
explodeEffectOnShield: NONE
mutatorX_ifUnitWithoutTags: 虚无
mutatorX_areaDamageMultiplier: 0
mutatorX_addResourcesAreaHit: 虚空=1
areaHitAirAndLandAtSameTime: true
areaHitUnderwaterAlways: true
spawnProjectilesOnCreate: 黑障

[projectile_黑障]
areaDamage: 0
life: 30
speed: 0
targetGround: true
explodeOnEndOfLife: true
deflectionPower: -1
invisible: true
explodeEffect: NONE
explodeEffectOnShield: NONE
spawnUnit: 黑障

[effect_curewave]
createWhenOffscreen: true
showInFog: true
liveAfterAttachedDies: false
fadeOut: false
attachedToUnit: true
drawUnderUnits: false
image: 黑障.png
life: 31
fadeInTime: 30
scaleFrom: 0
scaleTo: 1.34
alpha: 3.0
priority: critical


[effect_shockwaveLarge]
stripIndex: shockwave_large
scaleFrom: 0.2
scaleTo: 2
life: 40
color: #FFB0B0B0

[effect_explosionFlashLarge]
image: SHARED:light_50.png
scaleFrom: 8
scaleTo: 4
life: 20
fadeOut: true
priority: critical
color: #FFB0B0B0

[effect_黑碎光]
image: SHARED:light_50.png
life: 45
lifeRandom: 10
scaleFrom: 0.4
scaleTo: 0.2
color: #323232
fadeOut: true
atmospheric: true
xSpeedRelativeRandom: 2
ySpeedRelativeRandom: 2

[hiddenAction_黑障之境]
convertTo: 黑障_T2 - 帝国远征军前哨站
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${ConvertUpdate2}

[global_resource_支配度]
hidden: false
displayName: 支配度
displayNameShort: 支配度
displayColor: #1E002B
priority: 0.8

[global_resource_支配值]
hidden: true
displayName: 支配值
displayNameShort: 支配值
priority: 0.8

[global_resource_帝国技能]
hidden: true
displayName: 帝国技能
displayColor: #000000
priority: 0.8

[resource_帝国CD]
hidden: true


[hiddenAction_AIempty]
autoTrigger: if self.transportingCount(lessThan=5)
temporarilyAddTags: 步兵堡垒空

[hiddenAction_AIfull]
autoTrigger: if self.transportingCount(equalTo=5)
temporarilyRemoveTags: 步兵堡垒空