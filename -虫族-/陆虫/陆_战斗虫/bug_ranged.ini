
[core]
name: bugRanged
altNames: 战斗虫
displayText: 战斗虫
displayDescription: -攻击地面单位 \n -受伤会降低输出提升保命能力
displayLocaleKey: NONE
class: CustomUnitMetadata
price: 550
#maxHp: 380
maxHp: 420
mass: 1200

techLevel: 1
buildSpeed: 0.003
#availableInDemo: true

radius: 9
displayRadius: 11
isBio: true
isBug: true
tags: units, 虫族, 小型虫, 开端辅虫, 战斗虫, 固定射击
showActionsWithMixedSelectionIfOtherUnitsHaveTag: 战斗虫

selfRegenRate:0.06



softCollisionOnAll: 12

builtFrom_1_name: bugNest
builtFrom_1_pos:  3

#test

overrideAndReplace: bugRanged

autoTriggerCooldownTime: 0.01s
autoTriggerCooldownTime_allowDangerousHighCPU:true

[action_Upgrade]
convertTo:bugRangedLarge
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${ConvertUpdate2}
price:腐蚀=85
text:腐蚀 - 巨化
displayType:upgrade
buildSpeed:12.8s
pos:1
description:-更大,更好,更强
descriptionAddUnitStats: ${section.convertTo}
iconExtraImage:SHARED:icon_upgrade_top.png
iconExtraColor:#AAFFFFFF
tags=腐蚀
setUnitMemory: 属性[24]=0

[action_且战且退]
isVisible: true
isActive: false
id: ${section.text}
text: 且战且退
description: -血量低于75%时触发 \n -获得15护甲，移速+0.2，但攻速减半
pos: 2
displayType: infoOnly
buildSpeed: 0s

[action_painting]
isVisible: if self.globalTeamTags(includes='风信子涂装')
convertTo: bugRanged[风信子]
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${ConvertUpdate2}
convertTo_keepCurrentFields: maxHp, maxShield
id: 涂装
text: “风信子”
description: -个性涂装 \n(不影响战斗属性)
displayType: upgrade
buildSpeed: 3.3s
pos: 3

[hiddenAction_涂装解锁]
autoTrigger: if ( self.kills(greaterThan=2) or self.playerName=="FengCong" ) and not self.globalTeamTags(includes='风信子涂装')
addGlobalTeamTags: 风信子涂装

[hiddenAction_retreat]
autoTrigger: if self.hp < self.maxHp * 0.75 and self.queueSize(empty=true)
convertTo: bugRanged[Retreat]
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${ConvertUpdate2}
convertTo_keepCurrentFields: maxHp, maxShield

[hiddenAction_腐蚀中]
autoTrigger: if self.queueSize(withActionTag="腐蚀")>0 and not self.tags(includes='腐蚀中')
setUnitMemory: 属性[24]=-${movement.moveSpeed}*0.6
alsoTriggerAction: 属性变化
temporarilyAddTags: 腐蚀中

[hiddenAction_腐蚀停止]
autoTrigger: if self.queueSize(withActionTag="腐蚀")<1 and self.tags(includes='腐蚀中')
setUnitMemory: 属性[24]=0
alsoTriggerAction: 属性变化
temporarilyRemoveTags: 腐蚀中

[hiddenAction_自动腐蚀]
autoTrigger: if (self.hasUnitInTeam(withTag="腐蚀-重型战斗虫") and self.hasUnitInTeam(withTag="腐蚀之意")) and self.hasResources(${action_Upgrade.price}) and self.queueSize(empty=true) and not self.isAttacking
alsoQueueAction: Upgrade
addResourcesWithLogic: ${action_Upgrade.price}*-1

[graphics]
total_frames: 6

image:        bug_ranged.png
image_wreak:  NONE
image_turret: NONE
#scaleImagesTo: 20
#scaleTurretImagesTo: 9

#AUTO
image_shadow: AUTO_ANIMATED
shadowOffsetX:1
shadowOffsetY:1


animation_moving_start: 0
animation_moving_end: 2
animation_moving_speed: 3

animation_idle_start: 0
animation_idle_end: 0
animation_idle_speed: 80
animation_idle_scale_start:1
animation_idle_scale_end:1.03
animation_idle_pingPong: true


animation_attack_start: 2
animation_attack_end: 5
animation_attack_speed: 3

lock_body_rotation_with_main_turret: true

[attack]


canAttack: true
canAttackFlyingUnits: false
canAttackLandUnits:   true
canAttackUnderwaterUnits: false

isFixedFiring: true

turretSize: 15
turretTurnSpeed: 3.5

maxAttackRange: 170
shootDelay: 48

[turret_1]
x: 0
y: 0

recoilOffset: -3
recoilOutTime: 6
recoilReturnTime: 18


[projectile_1]
tags= T-projectile
directDamage: 32
life: 80
speed: 7
#frame: 0

lightColor: #00ff00
lightSize: 0.3

explodeEffect: CUSTOM:explodeSmall

[effect_explodeSmall]
life: 25
fadeOut: false
attachedToUnit: false
image: explode_big2.png
scaleFrom: 0.5
scaleTo: 0.5
total_frames: 14
animateFrameStart: 0
animateFrameEnd: 13
animateFrameSpeed: 0.6

[movement]
movementType: LAND
moveSpeed: 1.0
moveAccelerationSpeed: 0.07
moveDecelerationSpeed: 0.12


maxTurnSpeed: 3.5
turnAcceleration: 0.5

targetHeight: 0
targetHeightDrift: 0

moveSlidingMode :true
moveIgnoringBody:true
moveSlidingDir:  181


[hiddenAction_AI集群进攻]
addWaypoint_type: guard
addWaypoint_prepend: true
addWaypoint_maxTime: 20s
addWaypoint_target_nearestUnit_tagged: 群虫成体
addWaypoint_target_nearestUnit_team: own
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.globalTeamTags(includes='AI屯兵') and not self.hasActiveWaypoint(type='guard') and self.globalTeamTags(includes='开端{I}') and not numberOfUnitsInEnemyTeam(withinRange=400, greaterThan=0, withTag='布克布克')

[hiddenAction_AI屯兵集结]
clearAllWaypoints: true
addWaypoint_type: guard
addWaypoint_prepend: true
addWaypoint_maxTime: 8s
addWaypoint_target_nearestUnit_tagged: 基地
addWaypoint_target_nearestUnit_team: own
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.globalTeamTags(includes='AI屯兵') and not self.isAttacking and not self.hasActiveWaypoint(type='guard')

[hiddenAction_AI遭遇布克]
addWaypoint_type: attack
addWaypoint_prepend: true
addWaypoint_maxTime: 20s
addWaypoint_target_nearestUnit_tagged: 布克布克
addWaypoint_target_nearestUnit_team: enemy
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.globalTeamTags(includes='开端{I}') and numberOfUnitsInEnemyTeam(withinRange=400, greaterThan=0, withTag='布克布克')

[hiddenAction_AI走位]
addWaypoint_type: move
addWaypoint_prepend: true
addWaypoint_maxTime: 3s
addWaypoint_target_mapMustBeReachable: true
addWaypoint_target_fromReference: attachment.getOffsetRelative(y=-80)
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.isAttacking and numberOfUnitsInEnemyTeam(greaterThan=0, withinRange=${attack.maxAttackRange -5}, withTag='units') and attachment.isAttacking and not self.hasActiveWaypoint(type='move')
[hiddenAction_AIclearWaypoints]
clearAllWaypoints: true
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.isAttacking and not numberOfUnitsInEnemyTeam(greaterThan=0, withinRange=${attack.maxAttackRange +5}, withTag='units') and self.hasActiveWaypoint(type='move')

[attachment_AI向定位]
x: 0
y: 0
onCreateSpawnUnitOf: AI单位向定位
alwaysAllowedToAttackParentsMainTarget: true
