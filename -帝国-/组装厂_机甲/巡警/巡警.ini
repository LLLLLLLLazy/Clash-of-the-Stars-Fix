[core]

name: 巡警
displayDescription: -攻击地面单位 \n -攻速逐渐加快 \n -可抛投三种不同的手雷 \n -受到来自正面的伤害减少25% \n -较远视野 \n -最终间隔: 0.11s

price: 4000
maxHp: 650
mass: 10000

maxShield: 900

tags: units, 转向攻击

techLevel: 1
buildSpeed: 19.8s
#availableInDemo: true

fogOfWarSightRange: 18

radius: 20
displayRadius: 22

energyMax: 10
energyRegen: 0.0167

[action_高爆弹]
displayType: queueUnit
price: energy=10
text: 高爆弹
description: -范围冲击伤害 \n -可击退己方单位 \n 250 | 60R
fireTurretXAtGround: skill
fireTurretXAtGround_withProjectile: null
fireTurretXAtGround_showGuideDecals: 技能范围圈, 高爆伤害范围
alsoTriggerAction: 高爆弹执行
buildSpeed: 0.2s
pos: 1

[action_燃烧弹]
displayType: queueUnit
price: energy=10
text: 燃烧弹
description: -范围持续伤害
fireTurretXAtGround: skill
fireTurretXAtGround_withProjectile: null
fireTurretXAtGround_showGuideDecals: 技能范围圈
alsoTriggerAction: 燃烧弹执行
buildSpeed: 0.2s
pos: 1

[action_烟雾弹]
displayType: queueUnit
price: energy=10
text: 烟雾弹
description: -战略掩护 \n -可被敌方攻击的烟雾
fireTurretXAtGround: skill
fireTurretXAtGround_withProjectile: null
fireTurretXAtGround_showGuideDecals: 技能范围圈
alsoTriggerAction: 烟雾弹执行
buildSpeed: 0.2s
pos: 1

[template_指定技能执行]
fireTurretXAtGround: magic
fireTurretXAtGround_withTarget: getOffsetRelative(y=min(distanceBetween(self, thisActionTarget), ${turret_magic.limitingRange}), dirOffset=directionBetween(self, thisActionTarget)-self.dir)

[hiddenAction_高爆弹执行]
@copyFromSection: template_指定技能执行
fireTurretXAtGround_withProjectile: 高爆弹

[hiddenAction_燃烧弹执行]
@copyFromSection: template_指定技能执行
fireTurretXAtGround_withProjectile: 燃烧弹

[hiddenAction_烟雾弹执行]
@copyFromSection: template_指定技能执行
fireTurretXAtGround_withProjectile: 烟雾弹

[decal_高爆伤害范围]
layer: inactive
image: SHARED:area_guide.png
@define area_guide_size: 100
imageScale: 60/${area_guide_size /2}
alpha: 0.5
color: #FF855C
drawLineTo: self

[decal_技能范围圈]
basePosition: self
layer: inactive
image: 范围圈600.png
imageScale: ${240/300}
alpha: 0.4



[hiddenAction_血盾记录]
autoTrigger: if self.resource.受击前血量!=self.hp or self.resource.受击前护盾!=self.shield
setResourcesWithLogic: 受击前血量=self.hp, 受击前护盾=self.shield

[hiddenAction_血量减伤]
autoTriggerOnEvent: tookDamage
requireConditional: if self.resource.受击前血量>self.hp and directionBetween(attachment(withTag='单位向定位'), eventSource)-attachment(withTag='单位向定位').dir >-45 and directionBetween(attachment(withTag='单位向定位'), eventSource)-attachment(withTag='单位向定位').dir <45
setResourcesWithLogic: hp=self.hp+(self.resource.受击前血量-self.hp) * 0.25, 受击前血量=self.hp

[hiddenAction_护盾减伤]
autoTriggerOnEvent: tookDamage
requireConditional: if self.resource.受击前护盾>self.shield and directionBetween(attachment(withTag='单位向定位'), eventSource)-attachment(withTag='单位向定位').dir >-45 and directionBetween(attachment(withTag='单位向定位'), eventSource)-attachment(withTag='单位向定位').dir <45
setResourcesWithLogic: shield=self.shield+(self.resource.受击前护盾-self.shield) *0.25, 受击前护盾=self.shield

[hiddenAction_受伤记录]
autoTriggerOnEvent: tookDamage
setResourcesWithLogic: 受击前血量=self.hp, 受击前护盾=self.shield

[resource_受击前血量]
hidden: true

[resource_受击前护盾]
hidden: true


[attachment_单位向定位]
x: 0
y: 0
onCreateSpawnUnitOf: 单位向定位(addResources=setFlag:1)
alwaysAllowedToAttackParentsMainTarget: true
resetRotationWhenNotAttacking: true


[graphics]
image: 巡警身体.png
image_wreak: 巡警残骸.png
image_shield: 大骑士之盾.png

#scaleImagesTo: 46
#scaleTurretImagesTo: 53

image_shadow: AUTO
shadowOffsetX: 2
shadowOffsetY: 2

lock_body_rotation_with_main_turret: true
teamColorsOnTurret: true

[attack]
canAttack: true
canAttackFlyingUnits: false
canAttackLandUnits: true
canAttackUnderwaterUnits: false

turretSize: 20
turretTurnSpeed: 3

maxAttackRange: 210
shootDelay: 15

turretRotateWithBody: false

[hiddenAction_属性改变设定]
setUnitMemory: 属性[41]=cos(180)*(${turret_2.warmupShootDelayTransfer} / ${attack.shootDelay})

[turret_2]
x: 15
y: 0
image: 巡警机枪.png
idleDir: 0

barrelX: 0
barrelY: 28

slave: true
attachedTo: 1

turnSpeed: 2.9
turnSpeedAcceleration: 0.3

recoilOffset: -0.5
recoilOutTime: 3
recoilReturnTime: 5

warmup: 180
warmupCallDownRate: 1
warmupNoReset: true
warmupShootDelayTransfer: 8

projectile: 1

shoot_sound: tank_firing
shoot_sound_vol: 0.2
shoot_flame: small, CUSTOM:弹壳

canShoot: true

[turret_3]
x: -15
y: 0
image: 巡警盾.png
idleDir: -30

#slave: true
attachedTo: 1

turnSpeed: 2.9
turnSpeedAcceleration: 0.3

projectile: 1附

canShoot: true
energyUsage: 11

[turret_1]
x: 0
y: 0
idleDir: 0
canShoot: false

image: 巡警身体.png

turnSpeed: 2.9
turnSpeedAcceleration: 0.3

[turret_magic]
x: 0
y: 0
canShoot: false

image: 巡警头.png

idleSweepAngle: 20
idleSweepDelay: 210
idleSweepSpeed: 0.2
idleSweepCondition:if not self.isMoving()

limitingRange: 240

[turret_skill]
x: 0
y: 0
invisible: true
canShoot: false
limitingRange: 9999


[projectile_1]
directDamage: 40
life: 100

frame: 5

drawSize: 1

#speed: 2
speed: 0
targetSpeed: 8
targetSpeedAcceleration: 1.5

[projectile_高爆弹]
life: 360
speed: 3.5

image: 手雷.png

areaDamage: 250
areaRadius: 60

largeHitEffect: true
targetGround: true

targetGroundSpread: 20
initialUnguidedSpeedHeight: 1.2
gravity: 0.1
lightCastOnGround: true

spawnProjectilesOnExplode: 1附

[projectile_1附]
life: 0
speed: 0
explodeOnEndOfLife: true
invisible: true
targetGround: true
areaDamage: 0
areaRadius: 60
pushForce: 5
pushVelocity: 3
friendlyFire: true
explodeEffect: CUSTOM:explodeCore, CUSTOM:explodeCore2, CUSTOM:sparks*6, CUSTOM:fire*3


[effect_explodeCore]
priority: veryhigh
life: 24
attachedToUnit: true
stripIndex: explode_big2
scaleFrom: 2.0
scaleTo: 2.0
alpha: 1
total_frames: 14
animateFrameStart: 0
animateFrameEnd: 13
animateFrameSpeed: 0.6
fadeOut: false

[effect_explodeCore2]
priority: veryhigh
life: 36
attachedToUnit: true
stripIndex: explode_big2
scaleFrom: 1.5
scaleTo: 1.5
alpha: 1
total_frames: 14
animateFrameStart: 0
animateFrameEnd: 13
animateFrameSpeed: 0.4
fadeOut: false

[effect_sparks]
attachedToUnit: false
life: 100
physics: true
xSpeedRelativeRandom: 1.8
ySpeedRelativeRandom: 1.8
hSpeed: 3
image: SHARED:spark.png
color: #FF0000
priority: verylow

[effect_fire]
priority: low
life: 30
lifeRandom: 5
alpha: 1
scaleFrom: 0.8
scaleTo: 0.6
stripIndex: fire
drawUnderUnits: false
atmospheric: true
attachedToUnit: false
hSpeed: 2
xSpeedRelativeRandom: 2.4
ySpeedRelativeRandom: 2.4

[projectile_燃烧弹]
life: 360
speed: 3.5

image: 手雷.png

areaDamage: 30
areaRadius: 60

largeHitEffect: true
targetGround: true

targetGroundSpread: 20
initialUnguidedSpeedHeight: 1.2
gravity: 0.1
lightCastOnGround: true

explodeEffect: NONE

spawnUnit: 火花Z2(addResources=energy:2)

[projectile_烟雾弹]
life: 360
speed: 3.5

image: 手雷.png

areaDamage: 0
areaRadius: 0

largeHitEffect: true
targetGround: true

targetGroundSpread: 20
initialUnguidedSpeedHeight: 1.2
gravity: 0.1
lightCastOnGround: true

explodeEffect: NONE

spawnUnit: 烟雾

[projectile_null]
areaDamage: 0
areaRadius: 0
invisible: true
life: 0
speed: 0
deflectionPower: -1
explodeEffect: NONE

[movement]
movementType: OVER_CLIFF
moveSpeed: 0.6
moveAccelerationSpeed: 0.07
moveDecelerationSpeed: 0.17

maxTurnSpeed: 5.0
turnAcceleration: 0.5

moveSlidingMode :true
moveIgnoringBody:true

reverseSpeedPercentage: 0

[leg_1]
x: 9
y: 0
moveSpeed: 1.32
moveWarmUp: 16
attach_x: 8
attach_y: 0
rotateSpeed: 30
heightSpeed: 0.5
resetAngle: 0.00000001
image_foot: 巡警脚.png
image_leg: leg.png
dust_effect: true
holdDisMin: 10
holdDisMax: 10
estimatingPositionMultiplier: 0.65

[leg_2]
x: -9
y: 0
attach_x: -8
attach_y: 0
copyFrom: 1

[effect_弹壳]
#frameIndex: 4
#stripIndex: projectiles2
image: 弹壳.png
atmospheric: true
attachedToUnit: false
life: 100
physics: true
xOffsetRelative: 4
yOffsetRelative: -28
xSpeedRelative: 1.2
ySpeedRelative: -0.4
#scaleFrom: 1.0
#scaleTo: 1.0
hSpeed: 0.5
#dirSpeed: 1
#color: #FFF06E
