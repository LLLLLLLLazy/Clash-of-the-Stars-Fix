
[core]
name:布克布克
class: CustomUnitMetadata
price:credits=400, 腐蚀=${corrode}
maxHp: 600
mass: 1000

radius:12
selfRegenRate:0.06

softCollisionOnAll: 5

buildSpeed: 3.3s
isBug:true
isBio:true

displayDescription: -攻击地面单位 \n -冲向目标并自爆 \n -死亡后聚吸附近敌人并剧烈爆炸 \n -对建筑伤害稍低

transportSlotsNeeded:1
tags: units, 虫族, 中型虫, 自爆虫, 布克布克, 开端辅虫, 固定射击

explodeOnDeath: false
effectOnDeath: 

unitsSpawnedOnDeath: 资源返还(addResources=ammo:100|energy:${int(corrode*0.25)})

autoTriggerCooldownTime: 0.01s
autoTriggerCooldownTime_allowDangerousHighCPU: true

[hiddenAction_亡灵生成]
autoTriggerOnEvent: destroyed
requireConditional: if self.globalTeamTags(includes='狂猎') and self.globalTeamTags(includes='皎红')
spawnUnits: 布克布克[亡灵]

[hiddenAction_腐蚀价格]
@global corrode: 100
autoTrigger: if memory.腐蚀价格!=${corrode}
setUnitMemory: 腐蚀价格=${corrode}

[action_狂猎击杀]
@copyFromSection: template_狂猎击杀

[action_狂猎击杀2]
@copyFromSection: template_狂猎击杀2


[hiddenAction_死亡爆炸]
autoTriggerOnEvent: destroyed
requireConditional: if not self.hasFlag(id=2)
fireTurretXAtGround: 2

[hiddenAction_空爆]
autoTriggerOnEvent: destroyed
requireConditional: if self.hasFlag(id=2)
fireTurretXAtGround: 3

[hiddenAction_运输结束]
autoTrigger: if self.hasFlag(id=2)
addResources: unsetFlag=2

[hiddenAction_危爆]
autoTrigger: if self.hasFlag(id=0)
setResourcesWithLogic: hp=-99999

[action_explode]
displayType: action

price:  0
id: ${section.text}
text: 自爆
buildSpeed: 0.8s
addResources: hp:-1000
allowMultipleInQueue: false
autoTrigger: if self.isOverLiquid and not self.isOverwater


[hiddenAction_无延迟追击B]
@copyFromSection: template_无延迟追击B
[hiddenAction_无延迟追击B2]
@copyFromSection: template_无延迟追击B2


[hiddenAction_爆蛋]
autoTriggerOnEvent: created
requireConditional: if self.hasFlag(id=2)
switchToAggressiveTeam: true

[action_扩散移动点开]
@copyFromSection: template_扩散移动点开

[action_扩散移动点关]
@copyFromSection: template_扩散移动点关

[hiddenAction_设置扩散移动点]
@copyFromSection: template_设置扩散移动点

[hiddenAction_清除当前非巡逻路径]
@copyFromSection: template_清除当前非巡逻路径

[hiddenAction_锁定扩散移动点]
@copyFromSection: template_锁定扩散移动点

[hiddenAction_执行扩散移动点]
@copyFromSection: template_执行扩散移动点

[graphics]
image:布克布克!.png
image_turret:NONE
splastEffect:true
image_shadow:AUTO_ANIMATED
shadowOffsetX:1
shadowOffsetY:1

#imageScale: 1.5

total_frames:3

animation_moving_start:0
animation_moving_end:2
animation_moving_speed:2
animation_moving_pingPong:true

animation_idle_start:0
animation_idle_end:0
animation_idle_speed:60
animation_idle_scale_start:1
animation_idle_scale_end:1.2
animation_idle_pingPong:true

[attack]

isMelee: true
meleeEngangementDistance: 150

dieOnAttack: true

canAttack: true
canAttackFlyingUnits: false
canAttackLandUnits:   if self.queueSize(withActionTag="黯回之生", lessThan=1)
canAttackUnderwaterUnits: false

isFixedFiring: true

turretSize: 0
turretTurnSpeed: 3

maxAttackRange: 9
shootDelay: 0

[turret_1]
x:0
y:0
invisible:true
projectile:1
canAttackCondition: if attacking == activeWaypointTarget or not self.hasActiveWaypoint(type='attack') and not self.hasActiveWaypoint(type='move')

[projectile_1]
areaDamage:0
areaRadius:0
life:50
instant:true
explodeEffect:NONE
explodeEffectOnShield:NONE

[turret_2]
x:0
y:0
warmup:30
invisible:true
projectile: implosion
shoot_flame: 闪光, 中心光, 光柱*3, 收缩波, 扭曲收缩
canAttackCondition: if attacking == activeWaypointTarget or not self.hasActiveWaypoint(type='attack') and not self.hasActiveWaypoint(type='move')

[turret_3]
x:0
y:0
copyFrom:2
barrelHeight:35
canShoot:false

[projectile_implosion]
areaDamage: 0
areaRadius: 70
areaRadiusFromEdge: true
pushVelocity: -0.5
pushForce: -500

life: 0
speed: 0
invisible: true
explodeOnEndOfLife: true

explodeEffect: NONE
explodeEffectOnShield: NONE

spawnProjectilesOnCreate: explodeArea(recursionLimit=1), explodeNearSpace(recursionLimit=1)
spawnProjectilesOnExplode: implosionV(recursionLimit=15)

[projectile_implosionV]
@copyFromSection: projectile_implosion
delayedStartTimer: 2
pushVelocity: -0.15
pushForce: -100


[projectile_explodeArea]
delayedStartTimer: 30
#directDamage: 250
areaDamage: 500
areaRadius: 85
areaExpandTime: 10
areaRadiusFromEdge: true
buildingDamageMultiplier: 0.75

life: 0
speed: 0
invisible: true
explodeOnEndOfLife: true

#areaHitAirAndLandAtSameTime: true

explodeEffect: 扭曲波, 绿爆光, 绿雾*2, 绿雾散*3, 冲击波*2, 大爆炸*5
explodeEffectOnShield: ${section.explodeEffect}

[projectile_explodeNearSpace]
@copyFromSection: projectile_explodeArea
areaRadius: 15
areaHitAirAndLandAtSameTime: true
mutatorX_ifUnitWithoutTags: 近战飞行
mutatorX_areaDamageMultiplier: 0
explodeEffect: NONE
explodeEffectOnShield: NONE


[effect_闪光]
priority: low

image: SHARED:light_50.png
life: 14
fadeOut: true
attachedToUnit: false
color: #EEFFCC

scaleFrom: 1.8
scaleTo: 1.8
alpha: 0.6
drawUnderUnits:false

[effect_中心光]
priority: high

image: SHARED:light_50.png
life: 30
fadeOut: false
attachedToUnit: false
color: #FFFFFF

scaleFrom: 0.25
scaleTo: 0.1
alpha: 1
drawUnderUnits:false

[effect_光柱]
priority: low
image: 光柱.png
life: 30
lifeRandom: 10
fadeOut: false
attachedToUnit: false
color: #FFFFFF

scaleFrom: 1
scaleTo: 0.1
alpha: 0.6
drawUnderUnits:false

dirOffsetRandom: 180
dirSpeedRandom: 6

[effect_收缩波]
priority: low
stripIndex: shockwave_large
life: 30
fadeInTime: 2
scaleFrom: 1.2
scaleTo: 0
alpha: 0.1

[effect_扭曲收缩]
drawType: displacement

image: SHARED:shockwave_normal_128.png
life: 30
fadeOut: true
fadeInTime: 2
scaleFrom: 1
scaleTo: 0
alpha: 0.1
drawUnderUnits: false

dirOffsetRandom: 180
dirSpeedRandom: 1


[effect_扭曲波]
@copyFromSection: effect_扭曲收缩
life: 40
scaleFrom: 0
scaleTo: 1.6
alpha: 0.3

[effect_绿爆光]
priority: low

image: SHARED:light_50.png
life: 30
fadeOut: true
attachedToUnit: false
color: #EEFFCC

scaleFrom: 1.8
scaleTo: 3.4
alpha: 0.6
drawUnderUnits:false

[effect_绿雾]
priority: low
attachedToUnit: false
life: 40
scaleFrom: 0
scaleTo: 1.3
dirOffsetRandom: 180
dirSpeedRandom: 0.3
image: 白雾.png
color: #3BFF00

[effect_绿雾散]
priority: verylow
attachedToUnit: false
life: 60
scaleFrom: 0.3
scaleTo: 0.5
alpha: 0.6
image: 白雾.png
color: #3BFF00

dirOffsetRandom: 180
dirSpeedRandom: 0.3
xSpeedRelativeRandom: 1
ySpeedRelativeRandom: 1

[effect_冲击波]
priority: low
stripIndex: shockwave_large
life: 40
lifeRandom: 20
scaleFrom: 0
scaleTo: 1.7
alpha: 1
color: #3BFF00

[effect_大爆炸]
priority: veryhigh
life: 30
attachedToUnit: false
image: 白爆.png
scaleFrom: 1.2
scaleTo: 1.2
alpha: 0.8
color: #3BFF00
total_frames: 14
animateFrameStart: 0
animateFrameEnd: 13
animateFrameSpeed: 0.5
fadeOut: false
alsoPlaySound: buiding_explode:2

delayedStartTimerRandom: 20
xOffsetRelativeRandom: 30
yOffsetRelativeRandom: 30


[movement]
movementType: LAND
moveSpeed: 0.8
moveAccelerationSpeed: 0.1
moveDecelerationSpeed: 0.12
maxTurnSpeed: 5.4
turnAcceleration: 0.7

targetHeight: 0
targetHeightDrift: 0

moveSlidingMode: true
moveIgnoringBody: true

[ai]
upgradedFrom: 炮弹虫

[hiddenAction_AIloadInto]
addWaypoint_type: loadInto
addWaypoint_prepend: true
addWaypoint_maxTime: 20s
addWaypoint_target_nearestUnit_tagged: 空传导
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_mapMustBeReachable: false
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.isAttacking() and not self.hasActiveWaypoint(type='loadInto')

[hiddenAction_AI集群进攻]
addWaypoint_type: guard
addWaypoint_prepend: true
addWaypoint_maxTime: 20s
addWaypoint_target_nearestUnit_tagged: 群虫成体
addWaypoint_target_nearestUnit_team: own
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.hasActiveWaypoint(type='guard') and not self.hasActiveWaypoint(type='attack') and not self.hasActiveWaypoint(type='loadInto') and self.globalTeamTags(includes='开端{I}')

[hiddenAction_AI遭遇布克]
addWaypoint_type: attack
addWaypoint_prepend: true
addWaypoint_maxTime: 20s
addWaypoint_target_nearestUnit_tagged: 布克布克
addWaypoint_target_nearestUnit_team: enemy
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.globalTeamTags(includes='开端{I}') and numberOfUnitsInEnemyTeam(withinRange=500, greaterThan=0, withTag='布克布克')

[hiddenAction_AI指定攻击]
addWaypoint_type: attack
addWaypoint_prepend: true
addWaypoint_maxTime: 20s
addWaypoint_target_nearestUnit_tagged: 地震塔, T3机枪, 火炮塔, 毒气兵
addWaypoint_target_nearestUnit_team: enemy
addWaypoint_target_nearestUnit_maxRange: 500
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.globalTeamTags(includes='开端{I}') and not numberOfUnitsInEnemyTeam(withinRange=500, greaterThan=0, withTag='布克布克')
