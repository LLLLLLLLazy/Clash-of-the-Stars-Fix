
[core]
name: 血魔伤害标记
displayDescription: -目标受伤额外造成25%伤害
class: CustomUnitMetadata
price: 0
maxHp: 1
mass: 0

tags: 血魔伤害标记

#隐藏单位本身
showInEditor: false
radius: 0
fogOfWarSightRange: 0
ignoreInUnitCapCalculation: true
disableAllUnitCollisions: true
isUnselectable:	true
canNotBeDirectlyAttacked: true
showOnMinimap: false

#禁止死亡痕迹
numBitsOnDeath:	0
explodeOnDeath:	false
hideScorchMark: true

energyMax: 7
energyRegen: -0.0166
dieOnZeroEnergy: true

@memory 锁定目标:unit

autoTriggerCooldownTime: 0.01s
autoTriggerCooldownTime_allowDangerousHighCPU:true

[hiddenAction_锁定目标]
setUnitMemory: 锁定目标=attacking
teleportTo: memory.锁定目标
alsoTriggerAction: single, 标记完成

[hiddenAction_传送目标]
autoTrigger: if distanceBetween(memory.锁定目标, self)>1
teleportTo: memory.锁定目标

[hiddenAction_single]
requireConditional: if nearestUnit(withTag='血魔伤害标记').readUnitMemory("锁定目标", type='unit') == memory.锁定目标
takeResources: energy=-5
takeResources_includeUnitsWithinRange: 100
takeResources_excludeUnitsWithoutTags: 血魔伤害标记
takeResources_maxUnits: 1
deleteSelf: true

[hiddenAction_标记完成]
requireConditional: if nearestUnit(withTag='血魔伤害标记').readUnitMemory("锁定目标", type='unit') != memory.锁定目标
addResources: setFlag=1

[hiddenAction_消失]
autoTrigger: if memory.锁定目标.hp+memory.锁定目标.shield<=0 and self.hasFlag(id=1) or self.timeAlive>0.1 and not self.hasFlag(id=1)
deleteSelf: true


[hiddenAction_血量记录]
autoTrigger: if self.resource.目标血量<memory.锁定目标.hp+memory.锁定目标.shield
setResourcesWithLogic: 目标血量=memory.锁定目标.hp+memory.锁定目标.shield

[hiddenAction_伤害25%]
autoTrigger: if self.resource.目标血量>memory.锁定目标.hp+memory.锁定目标.shield and self.queueSize <1
setUnitStats: shootDamageMultiplier=(self.resource.目标血量 - (memory.锁定目标.hp+memory.锁定目标.shield) )*0.25
setResourcesWithLogic: ammo=1

[hiddenAction_伤害重置开始]
alsoQueueAction: 伤害重置

[hiddenAction_伤害重置]
buildSpeed: 0.02s
setResourcesWithLogic: 目标血量=memory.锁定目标.hp+memory.锁定目标.shield
setUnitStats: shootDamageMultiplier=0


[resource_目标血量]
hidden: true


[graphics]
image: SHARED:blank.png
showEnergyBar: false
showQueueBar: false

[decal_1]
layer: beforeUI
image: icon_红标.png
alpha: 0.5
color: #FF0000
imageScale: max(1, 1.5+(cos(180)*self.timeAlive))
basePosition: memory.锁定目标
alwaysStartDirAtZero: true

[attack]
canAttack: true
canAttackFlyingUnits: true
canAttackLandUnits:   true
canAttackUnderwaterUnits: false

turretTurnSpeed: 1000
maxAttackRange: 10
shootDelay: 10

aimOffsetSpread: 0
isMelee: true

[turret_1]
x: 0
y: 0
projectile: 1
canAttackCondition: if memory.锁定目标==nullUnit
onShoot_triggerActions: 锁定目标

[turret_2]
x: 0
y: 0
projectile: 2
resourceUsage: ammo=1
canAttackCondition: if self.resource.目标血量>memory.锁定目标.hp+memory.锁定目标.shield
onShoot_triggerActions: 伤害重置开始

[turret_3]
x: 0
y: 0
projectile: 3

[projectile_1]
mutatorX_ifUnitWithoutTags: ʚ♡⃛ɞ(ू•ᴗ•ू❁)
mutatorX_directDamageMultiplier: 0.0000001
directDamage: -1
life: 5
instant: true
teleportSource: true
explodeEffect: NONE
explodeEffectOnShield: NONE

[projectile_2]
directDamage: 1
life: 5
instant: true
teleportSource: true
explodeEffect: CUSTOM:红光散*3
explodeEffectOnShield: CUSTOM:红光散*3

[projectile_3]
directDamage: 10
life: 5
instant: true
teleportSource: true
shieldDamageMultiplier: 0.5
shieldDefectionMultiplier: 0.5
ignoreParentShootDamageMultiplier: true
explodeEffect: CUSTOM:弱红光散*3
explodeEffectOnShield: CUSTOM:弱红光散*3

[effect_红光散]
image: SHARED:light_50.png
life: 70
lifeRandom: 20
fadeOut: true
attachedToUnit: false
color: #FF0000
fadeInTime: 2
scaleFrom: 0.5
scaleTo: 0.5
alpha: 0.8
xSpeedRelativeRandom: 1.2
ySpeedRelativeRandom: 1.2
hSpeed: 0.3

[effect_弱红光散]
@copyFromSection: effect_红光散
life: 60
alpha: 0.5

[movement]
movementType: AIR
moveSpeed: 0
moveAccelerationSpeed: 0.0
moveDecelerationSpeed: 0.0
