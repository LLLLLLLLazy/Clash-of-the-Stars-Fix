
[core]
name: 紫水晶柱
displayDescription: -每次紫晶炮击会共鸣光束 \n -被摧毁时爆炸并对目标造成瓦解
class: CustomUnitMetadata
price: 0
maxHp: 240
mass: 6000
tags: 紫水晶柱, 可承伤单位, 召唤物
showActionsWithMixedSelectionIfOtherUnitsHaveTag: 紫水晶柱

fogOfWarSightRange: 5

showInEditor: false

techLevel: 1
buildSpeed: 3.33s
#availableInDemo: true

selfRegenRate: -0.067

radius: 8
displayRadius: 8
disableAllUnitCollisions: true

isBio: false
isBuilding: true
footprint: 1,1,-1,-1
constructionFootprint: 1,1,-1,-1
buildingSelectionOffset: 15

numBitsOnDeath:	0
explodeOnDeath:	false
hideScorchMark: true

isUnrepairableUnit: true

energyMax: 1

disableDeathOnZeroHp: true

autoTriggerCooldownTime: 10

[hiddenAction_创建时]
autoTriggerOnEvent: created
resetCustomTimer: true
alsoTriggerAction: 附从攻击, 附从攻击2

[hiddenAction_仅陆地生成]
autoTrigger: if self.isOverLiquid
deleteSelf: true


[hiddenAction_附从攻击]
autoTrigger: if customTarget1.hasActiveWaypoint(type='attack') and (not self.hasActiveWaypoint(type='attack') or activeWaypointTarget!=customTarget1.activeWaypointTarget) and distanceBetween(self, customTarget1.activeWaypointTarget) <= ${attack.maxAttackRange}
addWaypoint_type: attack
addWaypoint_prepend: true
addWaypoint_target_fromReference: customTarget1.activeWaypointTarget

[hiddenAction_附从攻击2]
requireConditional: if customTarget1.attacking!=null and (not self.hasActiveWaypoint(type='attack') or activeWaypointTarget!=customTarget1.attacking and activeWaypointTarget!=customTarget1.activeWaypointTarget) and distanceBetween(self, customTarget1.attacking) <= ${attack.maxAttackRange}
autoTrigger: if customTarget1.attacking!=null and (not self.hasActiveWaypoint(type='attack') or activeWaypointTarget!=customTarget1.attacking and activeWaypointTarget!=customTarget1.activeWaypointTarget) and distanceBetween(self, customTarget1.attacking) <= ${attack.maxAttackRange}
addWaypoint_type: attack
addWaypoint_prepend: true
addWaypoint_target_fromReference: customTarget1.attacking

[hiddenAction_新主单位]
autoTrigger: if customTarget1==null and numberOfUnitsInTeam(withTag='紫水晶', withinRange=1000)>0
setCustomTarget1: nearestUnit(withinRange=1000, withTag='紫水晶', relation='own')


[hiddenAction_destroy]
autoTrigger: if self.hp(empty=true) and not self.hasFlag(id=0)
fireTurretXAtGround: 1
fireTurretXAtGround_withOffset: 0, 0
fireTurretXAtGround_withProjectile: destroy
addResources: setFlag=0
resetCustomTimer: true

[hiddenAction_消失]
autoTrigger: if self.hasFlag(id=0) and self.customTimer>0.1
deleteSelf: true

[hiddenAction_killed]
autoTriggerOnEvent: killedAnyUnit
takeResources: ammo=-1
takeResources_includeReference: customTarget1
takeResources_includeUnitsWithinRange_team: own
takeResources_discardCollected: true


[hiddenAction_转移]
autoTrigger: if numberOfUnitsInTeam(withTag='紫水晶柱', withinRange=5)>1 and self.customTimer < 3
fireTurretXAtGround: 1
fireTurretXAtGround_withProjectile: 紫晶柱移
fireTurretXAtGround_withTarget: getOffsetRelative(x=rnd(-40, 40), y=rnd(-40, 40))
resetCustomTimer: true
spawnEffects: 紫水晶柱光边

#[hiddenAction_转移2]
#@copyFromSection: hiddenAction_转移
#autoTrigger: if numberOfUnitsInTeam(withTag='紫水晶柱', withinRange=10)>1 and numberOfUnitsInTeam(withTag='紫水晶柱', withinRange=80)>=12 and self.customTimer < 3
#fireTurretXAtGround_withTarget: getOffsetRelative(x=rnd(-80, 80), y=rnd(-80, 80))


[hiddenAction_水晶粒子]
autoTrigger: true
spawnEffects: CUSTOM:上浮紫粒

[graphics]
total_frames: 1
imageScale: 0.4
image:        紫水晶.png
image_wreak:  NONE
image_turret: NONE

image_shadow: AUTO
shadowOffsetX: 1
shadowOffsetY: 1

showHealthBar: false
showEnergyBar: false
disableLowHpSmoke: true
disableLowHpFire: true

[attack]
canAttack: true
canAttackFlyingUnits: false
canAttackLandUnits:   true
canAttackUnderwaterUnits: false

turretTurnSpeed: 1000

maxAttackRange: 150
#shootDelay: 5
shootDelay: 60

[turret_1]
x: 0
y: 0
energyUsage: 1

[projectile_1]
life: 35

instant: true
instantReuseLast: true
instantReuseLast_alsoChangeTurretAim: true
moveWithParent: true

beamImage:      SHARED:beam3.png
beamImageEnd:   SHARED:beam1_end.png
beamImageStart: SHARED:beam1_start.png
beamImageOffsetRate: 3

explodeEffect: CUSTOM:explode, 粒子散
explodeEffectOnShield: ${section.explodeEffect}

sweepOffsetFromTargetRadius: 0.6
sweepSpeed: 10

directDamage: 70

color: #8F49C0

[turret_2]
x: 0
y: 0
resourceUsage: hasFlag=0
onShoot_triggerActions: 消失
projectile: 2

[projectile_2]
life: 25

instant: true

beamImage:      beamDrain.png
beamImageEnd:   SHARED:beam1_end.png
beamImageStart: SHARED:beam1_start.png
beamImageOffsetRate: 20

explodeEffect: 束裂, 粒子散*2
explodeEffectOnShield: ${section.explodeEffect}

sweepOffsetFromTargetRadius: 0.6
sweepSpeed: 5

directDamage: 90

color: #BD61FF


[projectile_destroy]
life: 50
speed: 5
drawSize: 0

largeHitEffect: true

targetGround: true

areaDamage: 20
areaRadius: 70
areaDamageNoFalloff: true

deflectionPower: -1

explodeEffect: CUSTOM:explodeCore, CUSTOM:shockwave_large, CUSTOM:triangle*4, 闪光


[effect_explode]
priority: veryhigh
life: 25
attachedToUnit: true
image: explode.png
scaleFrom: 0.5
scaleTo: 0.5
alpha: 1
total_frames: 14
animateFrameStart: 0
animateFrameEnd: 13
animateFrameSpeed: 0.5
fadeOut: false


[effect_explodeCore]
priority: veryhigh
life: 30
attachedToUnit: true
image: explode.png
scaleFrom: 1.3
scaleTo: 1.3
alpha: 0.3
total_frames: 14
animateFrameStart: 0
animateFrameEnd: 13
animateFrameSpeed: 0.5
fadeOut: false
alsoPlaySound: missile_hit:0.3

[effect_shockwave_large]
life: 25
stripIndex: shockwave_large
scaleFrom: 0.1
scaleTo: 1.4
alpha: 0.8
color: #AA57E6

[effect_闪光]
life: 15
image:巨大光星.png
scaleFrom:1
scaleTo:0
alpha:5
color: #AA57E6

[effect_triangle]
life:20
attachedToUnit: false
atmospheric: true
image:effect_triangle.png
priority:verylow
createWhenZoomedOut:false
createWhenOffscreen:false
showInFog:false
dirSpeedRandom:10
xOffsetRelativeRandom:2
yOffsetRelativeRandom:2
xSpeedRelativeRandom:2.5
ySpeedRelativeRandom:2.5
scaleFrom:0.15
scaleTo:0.15
color:#BD61FF
alpha:3


[effect_束裂]
priority:veryhigh
life: 32

scaleFrom: 0.7
scaleTo: 0.7
alpha: 0.8

image: 紫Breath.png
total_frames: 15
animateFrameStart: 0
animateFrameEnd: 14
animateFramePingPong: false
animateFrameSpeed: 1
delayedStartTimerRandom: 5

[effect_粒子散]
life: 60
image: SHARED:spark.png
priority: verylow
color: #BD61FF
scaleFrom: 1.5
scaleTo: 1.5
alpha: 1
dirOffsetRandom: 180
dirSpeedRandom: 6
xSpeedRelativeRandom: 1.5
ySpeedRelativeRandom: 1.5
delayedStartTimerRandom: 5


[projectile_紫晶柱移]
directDamage: 0
life: 200
speed: 8
drawSize: 0

targetGround: true
teleportSource: true

deflectionPower: -1

effectOnCreate: 紫水晶柱
explodeEffect: NONE
explodeEffectOnShield: NONE

[effect_紫水晶柱]
priority: veryhigh
life: 200
attachedToUnit: true
image: 紫水晶.png
scaleFrom: 0.4
scaleTo: 0.4
alpha: 0.5
fadeOut: false
liveAfterAttachedDies: false
alwayStartDirAtZero: true

[effect_紫水晶柱光边]
priority: verylow
life: 30
attachedToUnit: true
image: 紫水晶.png
scaleFrom: 0.4
scaleTo: 0.5
alpha: 0.3
fadeOut: true


[effect_上浮紫粒]
priority: verylow
attachedToUnit: false
life:40
image: SHARED:spark.png
color:#BD61FF
scaleFrom: 2
scaleTo: 1
hSpeed: 1
hSpeedRandom: 0.2
xOffsetRelativeRandom: 8
yOffsetRelativeRandom: 8
drawUnderUnits: false
spawnChance:0.1

[movement]
movementType: BUILDING
moveSpeed: 0
moveAccelerationSpeed: 0.0
moveDecelerationSpeed: 0.0

targetHeight: 0

maxTurnSpeed: 0.0
turnAcceleration: 0.25

moveSlidingMode :false
moveIgnoringBody:false

[ai]
lowPriorityTargetForOtherUnits: true
