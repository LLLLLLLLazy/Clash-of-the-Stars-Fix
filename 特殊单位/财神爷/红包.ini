[core]
showInEditor: false

name: 红包
displayText: 红包
displayDescription: -拾取可随机获得20/50/100资金 \n -最多存在60s
maxHp: 0
mass: 10
price: 0

radius: 7

createOnAggressiveTeam: true

fogOfWarSightRange: 0
disableAllUnitCollisions: true
canNotBeDirectlyAttacked: true
ignoreInUnitCapCalculation: true
isUnselectable: true

numBitsOnDeath:	0
explodeOnDeath:	false
hideScorchMark: true

disableDeathOnZeroHp: true

autoTriggerCooldownTime: 0.1s

@memory 数字:float
@memory 金币帧:float

[hiddenAction_created]
autoTriggerOnEvent: completeAndActive
setBodyRotation: self.dir-(self.dir+90)
addResourcesWithLogic: 资金级=int(rnd(1, 3.99))
alsoTriggerAction: 数字
[hiddenAction_数字]
setUnitMemory:"""
数字=
select
(self.resource.资金级<=1, 20,
  select
  (self.resource.资金级==2, 50,
    select
    (self.resource.资金级>=3, 100, 0
    )
  )
)
"""

[resource_资金级]
displayName: 资金级


[hiddenAction_拾取]
resetCustomTimer: true
playSoundAtUnit: Coin_0.ogg, Coin_1.ogg, Coin_2.ogg, Coin_3.ogg, Coin_4.ogg
addResources: setFlag=1
spawnEffects: 黄影散, 闪光

[hiddenAction_金币帧]
autoTrigger: if self.hasFlag(id=1)
setUnitMemory: 金币帧=select(memory.金币帧<7, memory.金币帧+1, 0)

[hiddenAction_消失]
autoTrigger: if self.timeAlive>60 and not self.hasFlag(id=1) or self.hasFlag(id=1) and self.customTimer>=1
deleteSelf: true


[hiddenAction_金粒子]
autoTrigger: if not self.hasFlag(id=1) or self.hasFlag(id=1) and self.customTimer<0.5
spawnEffects: 金粒子

[effect_金粒子]
priority: verylow
image: 白粒.png
life: 150
lifeRandom: 30
fadeInTime: 5
attachedToUnit: false
scaleFrom: 1.4
scaleTo: 0.7
alpha: 0.8
color: #D9D919
drawUnderUnits: true
dirSpeedRandom: 3
xSpeedRelativeRandom: 0.25
ySpeedRelativeRandom: 0.25
delayedStartTimerRandom: 5

[effect_黄影散]
priority: high
life: 20
alpha: 0.6
scaleFrom: 1
scaleTo: 1.15
image: 红包黄影.png
color: #FFFFFF


[graphics]
image: 空16.png
disableLowHpFire: true
disableLowHpSmoke: true
showHealthBar: false
icon_zoomed_out_neverShow: true

[decal_body]
layer: afterBody
image: 红包.png
alpha: 1 * min(60 - self.timeAlive, 1) * max(select(self.hasFlag(id=1), 1 - self.customTimer*4, 1), 0)
alwaysStartDirAtZero: true

[decal_圆影]
layer: shadow
imageScale: 0.15
image: 圆影.png
alpha: 0.5 * max(select(self.hasFlag(id=1), 1 - self.customTimer*4, 1), 0)
alwaysStartDirAtZero: true
alwaysStartHeightAtZero: true

[decal_阴影]
layer: shadow
image: SHADOW:红包.png
alpha: 0.1 * max(select(self.hasFlag(id=1), 1 - self.customTimer*4, 1), 0)
alwaysStartDirAtZero: true
alwaysStartHeightAtZero: true

[decal_轮廓影]
layer: beforeBody
image: 红包黄影.png
imageScale: 1.05 + cos( ((self.timeAlive % 4) / 4) * 360) * 0.025
alpha: (0.3 +  cos( ((self.timeAlive % 3) / 3) * 360) * 0.1 ) * max(select(self.hasFlag(id=1), 1 - self.customTimer*2, 1), 0)
alwaysStartDirAtZero: true

[decal_十烁光]
layer: beforeBody
@define timer_3s: ((self.timeAlive() % 3) / 3)
alpha: (0.3+cos( ${timer_3s} * 360) * 0.3) * max(select(self.hasFlag(id=1), 1 - self.customTimer, 1), 0)
image: 红十烁光.png
imageScale: ${0.02 * core.radius}
basePositionFromLegEnd: arm_1

[decal_十烁光2]
@copyFromSection: decal_十烁光
alpha: (0.3-cos( ${timer_3s} * 360) * 0.3) * max(select(self.hasFlag(id=1), 1 - self.customTimer, 1), 0)
image: 黄十烁光.png

[decal_微光]
layer: onTop
image: 金光.png
imageScale: 0.6 * max(select(self.hasFlag(id=1), 1 - self.customTimer, 1), 0)
alpha: 0.3 + ${timerCos_3s}
@define timerCos_3s: cos( ((self.timeAlive % 3) / 3) * 360) * 0.05


[decal_金币]
layer: beforeUI
isVisible: if self.hasFlag(id=1)
image: Gold_Coin.png

frame: memory.金币帧
total_frames: 8

yOffsetAbsolute: - select(self.hasFlag(id=1), self.customTimer*12, 0)
xOffsetAbsolute: 0

imageScale: 0.5
alpha: select(self.hasFlag(id=1), 1 - self.customTimer/1, 1)
alwaysStartDirAtZero: true

[decal_数字显示]
@define digit=1
@define display=memory.数字
layer: beforeUI
isVisible: if self.hasFlag(id=1) and select(${digit}==1, ${display} >=0, length( str (${display}) ) > length( str(${display} % ${digit})))
image: 数字_金.png

frame: int( (${display} % ${digit*10}) / ${digit} )
total_frames: 10

yOffsetAbsolute: - select(self.hasFlag(id=1), self.customTimer*12, 0)
xOffsetAbsolute: 5 + (length( str( int(${display}))) * 4 - length( str( ${digit})) * 4)

imageScale: ${core.radius * 0.03}
alpha: select(self.hasFlag(id=1), 1 - self.customTimer/1, 1)
alwaysStartDirAtZero: true

[decal_数字显示2位]
@copyFromSection: decal_数字显示
@define digit=10

[decal_数字显示3位]
@copyFromSection: decal_数字显示
@define digit=100


[arm_1]
x: 0
y: 0
spinRate: 0.3

[attack]
canAttack: true
canAttackFlyingUnits: if self.timeAlive>0.5
canAttackLandUnits: if self.timeAlive>0.5
canAttackUnderwaterUnits: if self.timeAlive>0.5
aimOffsetSpread: 0
turretTurnSpeed: 1000
maxAttackRange: 1
shootDelay: 5

turretMultiTargeting: true
isMelee: true

[turret_1]
x: 0
y: 0
projectile: 1
resourceUsage: hasMissingFlag=1
canAttackCondition: if self.resource.资金级<=1
onShoot_triggerActions: 拾取

[turret_2]
@copyFromSection: turret_1
projectile: 2
canAttackCondition: if self.resource.资金级==2

[turret_3]
@copyFromSection: turret_1
projectile: 3
canAttackCondition: if self.resource.资金级>=3

[projectile_1]
life: 10
instant: true
moveWithParent: true
beamImage:      中空射线.png
beamImageEnd:  SHARED:beam1_end.png
beamImageStart: SHARED:beam1_start.png
beamImageOffsetRate: 3
explodeEffect: NONE
explodeEffectOnShield: NONE
directDamage: -1
mutatorX_ifUnitWithoutTags: ʚ♡⃛ɞ(ू•ᴗ•ू❁)
mutatorX_directDamageMultiplier: 0.00001
mutatorX_addResourcesDirectHit: credits=20
color: #20D9D919

[projectile_2]
@copyFromSection: projectile_1
mutatorX_addResourcesDirectHit: credits=50

[projectile_3]
@copyFromSection: projectile_1
mutatorX_addResourcesDirectHit: credits=100

[effect_闪光]
priority: low
life: 17
alpha: 0.8
scaleFrom: 1
scaleTo: 1
image: SHARED:light_50.png
color: #D9D919
drawUnderUnits: false


[movement]
movementType: AIR
moveSpeed: 0
moveAccelerationSpeed: 0
moveDecelerationSpeed: 0
ignoreMoveOrders: true

targetHeight: 6
targetHeightDrift: 1.5
heightChangeRate: 0.03

maxTurnSpeed: 0
turnAcceleration: 0
