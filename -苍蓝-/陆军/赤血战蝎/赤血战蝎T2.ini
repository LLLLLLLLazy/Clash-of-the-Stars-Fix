
[core]
name: 赤血战蝎T2
displayText: T2 - 赤血战蝎
displayDescription: -于烈火中屹立不倒 \n -因异化而无坚不摧 \n -受伤且周围有敌人时可累积血战强化
class: CustomUnitMetadata
price: 70700, 腐蚀=7000
maxHp: 9000
mass: 90000

maxShield: 2000
shieldRegen: -1
startShieldAtZero: true
shieldRenderRadius:	24

armour: 10
armourMinDamageToKeep: 0

tags: units, 赤, 贝露大型战斗单位, 焚烬之冷血, 能量冷却

energyMax: 10
energyRegen: 0.01

techLevel: 2

buildSpeed: 0.0002

fogOfWarSightRange: 24

availableInDemo: false

selfRegenRate: 0.5

radius: 35
displayRadius: 38
isBio: true

softCollisionOnAll: 15

transportSlotsNeeded: 12

experimental: true

unitsSpawnedOnDeath:烈焰G2*5

autoTriggerCooldownTime: 0.03s
autoTriggerCooldownTime_allowDangerousHighCPU:true

[hiddenAction_攻击接近]
autoTriggerOnEvent: newWaypointGivenByPlayer
requireConditional: if self.hasActiveWaypoint(type='attack')
addWaypoint_type: touchTarget
addWaypoint_prepend: true
addWaypoint_target_fromReference: activeWaypointTarget


[action_bloody]
isActive: false
isGuiBlinking: if self.resource.血战>5
autoTrigger: if self.attachment(withTag="攻击检测").attacking != nullUnit and not self.hp(full=true) and self.resource.血战<20
text: 血战
description: -失血的战斗将叠加血战层数 \n -血战5层:每秒回复血战层数*15的血量 \n -血战10层:每秒回复已损失血量百分比*10的护盾 \n -血战15层:血量低于20%时击杀敌人将永久提升1000血量上限(血战层数归零后刷新冷却) \n -血战20层:强化闪焰冲击-造成目标血量上限40%的真实伤害
pos: 0
displayType: infoOnly
buildSpeed: 0s
iconImage: 血涡.png
addResources: 血战=0.03

[hiddenAction_血涸]
autoTrigger: if self.attachment(withTag="攻击检测").attacking == nullUnit and self.hp(full=true) and self.resource.血战>0
addResources: 血战=-0.06

[hiddenAction_血霾]
autoTrigger: if self.resource.血战>5
spawnEffects: CUSTOM:血橙雾蒙*2
addResourcesWithLogic: hp=self.resource.血战*0.45

[hiddenAction_橙影]
autoTrigger: if self.resource.血战>10
spawnEffects: CUSTOM:残影
addResourcesWithLogic: shield=(self.maxHp - self.hp) * 0.00375

[hiddenAction_溅火]
autoTrigger: if self.resource.血战>15 and self.customTimer(laterThanSeconds=0.12)
fireTurretXAtGround: magic
fireTurretXAtGround_withOffset: 0, 0
fireTurretXAtGround_withProjectile: 溅火
resetCustomTimer: true

[hiddenAction_炽热扭曲]
autoTrigger: if self.resource.血战>=20 and self.resource.炽曲>=2
spawnEffects: CUSTOM:displacement
setResourcesWithLogic: 炽曲=0

[hiddenAction_炽曲]
autoTrigger: if self.resource.炽曲<2
addResources: 炽曲=0.03

[hiddenAction_血噬]
requireConditional: if self.resource.血战>15 and self.hp < self.maxHp * 0.2 and self.resource.血噬<1 and not eventSource.self.tags(includes="召唤物")
autoTriggerOnEvent: killedAnyUnit
setUnitStats: hp+=1000
setUnitMemory: 属性[14]=memory.属性[14]+1000
alsoTriggerAction: 属性变化
addResources: 血噬=1

[hiddenAction_血凝]
autoTrigger: if self.resource.血战<=0 and self.resource.血噬>0
addResources: 血噬=-1

[resource_炽曲]
displayName: 炽曲
hidden: true

[resource_血噬]
displayName: 血噬
hidden: true

[resource_冲焰]
displayName: 冲焰
hidden: true

[action_闪焰冲击]
isActive: if self.isEnergyFull()
isGuiBlinking: if self.resource.血战>=20
convertTo: 赤血战蝎T2[闪焰冲击]
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${ConvertUpdate2}
displayType: action
text: 闪焰冲击
description: -向指定位置猛冲
buildSpeed: 2s
pos: 0.1
whenBuilding_cannotMove: true
whenBuilding_rotateTo_aimAtActionTarget: true
playSoundAtUnit: 闪焰冲击.ogg:1.5
fireTurretXAtGround: flashFlame
fireTurretXAtGround_withProjectile: 溅火
fireTurretXAtGround_count: 10
fireTurretXAtGround_showGuideDecals: 技能范围圈, 闪焰伤害范围, 赤星伤害范围

clearAllWaypoints: true
addWaypoint_type: move
addWaypoint_prepend: true
addWaypoint_maxTime: 5s
addWaypoint_target_mapMustBeReachable: false
addWaypoint_target_fromReference: getOffsetRelative(y=min(distanceBetween(self, thisActionTarget), 400), dirOffset=directionBetween(self, thisActionTarget)-self.dir)

convertTo_keepCurrentFields: maxHp
alsoTriggerAction: 赤星

[decal_技能范围圈]
basePosition: self
layer: inactive
image: 范围圈1000.png
imageScale: ${400/500}
alpha: 0.4

[decal_闪焰伤害范围]
layer: inactive
image: SHARED:area_guide.png
@define area_guide_size: 100
imageScale: 100/${area_guide_size /2}
alpha: 0.5
color: #E64D00
drawLineTo: self

[decal_赤星伤害范围]
@copyFromSection: decal_闪焰伤害范围
isVisible: if self.resource.血战>=20
imageScale: 200/${area_guide_size /2}
color: #FF0000


[hiddenAction_赤星]
requireConditional: if self.resource.血战>=20
spawnEffects: CUSTOM:赤星

[hiddenAction_攻击检测器]
autoTrigger: if self.attachment(slot="攻击检测")==nullUnit
attachments_addNewUnits: 攻击检测(addResources=setFlag:1-2)
attachments_onlyOnSlots: 攻击检测

[attachment_攻击检测]
x: 0
y: 0
onCreateSpawnUnitOf: 攻击检测(addResources=setFlag:1-2)

[resource_血战]
displayName: 血战

[effect_血橙雾蒙]
priority: low
attachedToUnit: true
fadeInTime: 6
life: 120
lifeRandom: 10
alpha: 0.3
scaleFrom: 0.6
scaleTo: 1.2
image: SHARED:light_50.png
color: #E64D00
drawUnderUnits: false
atmospheric: true
xOffsetRelativeRandom: 30
yOffsetRelativeRandom: 30
xSpeedRelativeRandom: 1.2
ySpeedRelativeRandom: 1.2
delayedStartTimerRandom: 5

[effect_displacement]
drawType: displacement

image: SHARED:ripple_normal_128.png
life: 40
fadeOut: true
fadeInTime: 2

attachedToUnit: true
color: #FFFFFF
scaleFrom: 0
scaleTo: 4
alpha: 0.25
drawUnderUnits:false

dirOffsetRandom: 180
dirSpeedRandom: 1


[action_熔化]
isActive: false
isVisible: if self.isOverLiquid and not self.isOverwater
autoTrigger: if self.isOverLiquid and not self.isOverwater
isGuiBlinking: if self.isOverLiquid and not self.isOverwater
addResources: hp=-3, energy=0.02
pos: 1
id: ${section.text}
text: 熔焱
description: -在岩浆中持续流血 \n -加快能量恢复速度 \n -可保持血战层数
buildSpeed: 0s
displayType: infoOnly
iconImage: 火焰弹.png

[graphics]
total_frames: 1

image:        赤血战蝎T2.png
image_wreak:  蝎壳T2.png
image_turret: 震波炮T2.png
image_shield: 赤血橙影.png
showShieldBar: false

image_shadow: AUTO
shadowOffsetX:1
shadowOffsetY:1

dustEffect: true

[effect_残影]
createWhenZoomedOut: false
priority: verylow
image: 赤血橙影.png
life: 25
fadeOut: true
attachedToUnit: false
fadeInTime: 2
scaleFrom: 1
scaleTo: 0.9
alpha: 0.4
drawUnderUnits: true
ySpeedRelative: -0.4
atmospheric: true

[effect_赤粒子]
image: SHARED:light_50.png
life: 25
fadeOut: true
attachedToUnit: false
color: #E62600
fadeInTime: 5
scaleFrom: 0.4
scaleTo: 0.2
alpha: 0.8
dirSpeedRandom: 5
yOffsetRelative: 30
xSpeedRelativeRandom: 3
ySpeedRelativeRandom: 3
xOffsetRelativeRandom: 20
yOffsetRelativeRandom: 20
priority: verylow

[effect_火光罩]
priority: low
image: circle_50.png
scaleTo: 3
scaleFrom: 0
color: #50E63900
life: 10
yOffsetRelative: 15

[effect_散焰]
priority: low
life: 30
lifeRandom: 10
alpha: 1
scaleFrom: 0.8
scaleTo: 0.8
stripIndex: fire
drawUnderUnits: false
atmospheric: true
attachedToUnit: false
xOffsetRelativeRandom: 20
yOffsetRelativeRandom: 20
xSpeedRelativeRandom: 2.4
ySpeedRelativeRandom: 2.4

[effect_赤星]
image: ROOT:/素材/白星.png
life: 120
fadeOut: true
attachedToUnit: true
color: #FF0000
fadeInTime: 10
scaleFrom: 3
scaleTo: 3
alpha: 1

[effect_炽星光]
image: ROOT:/素材/白星.png
life: 40
lifeRandom: 10
fadeOut: true
attachedToUnit: false
color: #FF5500
scaleFrom: 2
scaleTo: 0.6
alpha: 0.1
yOffsetRelative: 25
dirSpeedRandom: 20
dirOffsetRandom: 30
drawUnderUnits: false

[effect_星炽曲]
drawType: displacement
image: SHARED:shockwave_normal_128.png
life: 20
lifeRandom: 5
fadeOut: true
attachedToUnit: true
color: #FFFFFF
scaleFrom: 2
scaleTo: 3
alpha: 0.03
dirOffsetRandom: 360
drawUnderUnits: false

[decal_血战红橙条框]
image: 白色条框.png
color: #FF6633

layer: beforeUI
alwaysStartDirAtZero: true
yOffsetAbsolute: ${core.radius + 15}
xOffsetAbsolute: 0.5

imageScaleX: ${core.radius - 0.5}
lineWidth: ${core.radius}

onlyWhileAlive: true

[decal_血战红橙条-左边框]
@copyFromSection: decal_血战红橙条框
image: 白色条左边框.png

xOffsetAbsolute: -${core.radius - 0.5}
imageScaleX: 1

[decal_血战红橙条-右边框]
@copyFromSection: decal_血战红橙条-左边框
image: 白色条右边框.png

xOffsetAbsolute: ${core.radius + 0.5}

[decal_血战红橙条]
@copyFromSection: decal_血战红橙条框
image: 白色条.png
color: #FF4000

xOffsetAbsolute: -${core.radius}
imageScaleX: ${core.radius} * 0.1 * self.resource.血战

[attack]
canAttack: true
canAttackFlyingUnits: true
canAttackLandUnits:   true
canAttackUnderwaterUnits: false

turretSize: 15
turretTurnSpeed: 3

maxAttackRange: 300
shootDelay: 0.13s

aimOffsetSpread:0

[turret_1]
x: -12
y: 28

canAttackFlyingUnits: false
canAttackLandUnits:   true

projectile: 1

turnSpeed: 8.0
turnSpeedAcceleration: 1.0
shoot_flame:CUSTOM:smoke, CUSTOM:lightSlowFade

canShoot: true

limitingRange: 180
limitingAngle:45
idleSweepAngle:45

#resourceUsage: shield=-6

image:火钳T2.png

[turret_2]
x: 12
y: 28
copyFrom: 1
image:火钳T2.png

[turret_X]
x: 0
y: -28
canAttackFlyingUnits: true
canAttackLandUnits: true
canAttackUnderwaterUnits: false

recoilOffset: -3
recoilOutTime: 5
recoilReturnTime: 7

delay:4s

projectile:X

#resourceUsage: shield=-50

[turret_XX]
x: 0
y: 0
barrelY: 35
invisible:true

canAttackFlyingUnits: false
canAttackLandUnits:   true

turnSpeed: 0
turnSpeedAcceleration: 1.0

shoot_sound:large_gun_fire2
shoot_sound_vol:0.3
shoot_flame:large
shoot_light:#FFEECCCC

limitingRange: 100
limitingAngle:30

canAttackMaxAngle:360

delay:0.2s
warmup: 0.8s

#resourceUsage: shield=-80

chargeEffectImage:火焰弹充能.png

projectile: XX


[turret_thump]
x: 0
y: 0
invisible:true

canShoot: false

canAttackFlyingUnits: false
canAttackLandUnits:  true
turnSpeed: 100
delay: 0s
projectile: thump
shoot_sound: large_gun_fire2
shoot_sound_vol: 1.0

limitingRange: 40

resourceUsage:ammo=1

[turret_magic]
x: 0
y: -5
invisible: true
canShoot: false
size: 0

[turret_flashFlame]
x: 0
y: 0
invisible: true
canShoot: false
limitingRange: 9999
limitingMinRange: 100

[projectile_thump]
life: 600
speed: 1
instant: true
largeHitEffect:true
targetGround:true
areaDamage: 830
areaRadius: 100
pushForce: 100
pushVelocity: 10
deflectionPower: -1

spawnUnit: 火花Z2

[projectile_赤血祭焰]
life: 99
instant: true
targetGround: true
areaDamage: 0
areaRadius: 200
areaHitAirAndLandAtSameTime: true
mutatorX_ifUnitWithoutTags: NONE任意
mutatorX_areaDamageMultiplier: 0
mutatorX_addResourcesAreaHit: 赤血祭焰=1

[projectile_1]
areaDamage:7
flameWeapon:true
areaRadius:33
spawnProjectilesOnCreate:1(recursionLimit=9,yOffsetRelative=16),2*3(offsetRandomDir=180)
life:0
speed:9
frame:5
drawSize:0
explodeOnEndOfLife:true
sweepOffsetFromTargetRadius:0.4
sweepSpeed:10
largeHitEffect:true
#explodeEffect: CUSTOM:hitFlame, shockwave
#effectOnCreate: CUSTOM:attachedFlame, CUSTOM:attachedLight

[projectile_2]
life: 70
speed: 7
targetSpeed: 2.5
targetSpeedAcceleration: 0.3
speedSpread: 1
frame: 3
drawSize: 1
flameWeapon: true
hitSound: false
targetGround:true
targetGroundSpread: 35
deflectionPower: -1
areaDamage: 3
areaRadius: 65
spawnProjectilesOnExplode:3(recursionLimit=3,yOffsetRelative=32)
explodeEffect: CUSTOM:hitFlame1
effectOnCreate: CUSTOM:attachedFlame1, CUSTOM:attachedLight1
lightSize:0.4
lightColor:#EC7F18

[projectile_3]
areaDamage:1
flameWeapon:true
areaRadius:33
spawnProjectilesOnCreate:3(recursionLimit=3,yOffsetRelative=32)
life:0
speed:9
frame:5
drawSize:0
explodeOnEndOfLife:true

[projectile_X]
directDamage: 100
areaDamage: 150
areaRadius: 75
life: 300
speed: 6
deflectionPower: 10

largeHitEffect: true
autoTargetingOnDeadTarget: true
spawnUnit: 火花Z2
image: 红导弹T2.png
trailEffect: CUSTOM:炙热
trailEffectRate: 1.5
lightColor: #FF6A00
lightSize: 0.5
spawnProjectilesOnCreate: 派生导弹*1

[projectile_派生导弹]
directDamage: 50
areaDamage: 75
areaRadius: 50
life: 300
speed: 5

largeHitEffect: true
autoTargetingOnDeadTarget: true
drawSize: 0.8
image: 红导弹T2.png

lightColor: #FF6A00
lightSize: 0.4

[projectile_XX]
life: 180
speed: 8
largeHitEffect: true
areaDamage: 100
areaRadius: 100
armourIgnoreAmount: 100
deflectionPower: -1
drawSize: 1.2
image: 火焰弹.png
lightColor: #ffe92b
lightSize: 1
spawnUnit:灼烧
friendlyFire:true

explodeEffect:CUSTOM:explodeCore
spawnProjectilesOnExplode:爆炸效果

[projectile_爆炸效果]
areaDamage:0
areaRadius:100
largeHitEffect: true
life:0
explodeOnEndOfLife:true
explodeEffectOnShield:NONE

[projectile_溅火]
areaDamage: 0
spawnProjectilesOnCreate: 小火苗(spawnChance=0.8)
life: 0
explodeEffect: NONE

[projectile_小火苗]
life: 200
speed: 4
speedSpread: 0.5
frame: 3
drawSize: 0.7
flameWeapon: true
targetGround: true
targetGroundSpread: 120
deflectionPower: -1
areaDamage: 3
areaRadius: 65
explodeEffect: CUSTOM:hitFlame
effectOnCreate: CUSTOM:attachedLight
lightSize: 0.3
lightColor: #DDED6D18
lightCastOnGround: true
initialUnguidedSpeedHeight: 1.5
gravity: 0.12
spawnUnit: 灼烧(addResources=setFlag:1)

[projectile_火花冲击]
life: 99
instant: true
invisible: true
targetGround: true
areaDamage: 25
areaRadius: 40
pushForce: 600
pushVelocity: 6
spawnUnit: 火花Z(spawnChance=0.5)
explodeEffect: CUSTOM:冲焰闪光

[effect_attachedFlame]
priority:veryhigh
frameIndex: 3
stripIndex: projectiles
life: 120
fadeOut: true
attachedToUnit: true
#color: #fdc14d
color: #FFFFFF
fadeInTime:9
scaleFrom: 0.5
scaleTo: 0.8
alpha: 1.5
drawUnderUnits:false
liveAfterAttachedDies: false


[effect_attachedLight]
priority:veryhigh
image: SHARED:light_50.png
life: 80
fadeOut: true
attachedToUnit: true
color: #EC7F18
fadeInTime:4
scaleFrom: 0.3
scaleTo: 0.3
alpha: 0.5
drawUnderUnits:false
liveAfterAttachedDies: false


[effect_hitFlame]
priority: low
frameIndex: 3
stripIndex: projectiles
life: 30
fadeOut: true
attachedToUnit: false
#color: #fdc14d
color: #FFFFFF
scaleFrom: 0.6
scaleTo: 0.7
alpha: 0.5
drawUnderUnits:false
liveAfterAttachedDies: false
physics: true
ySpeedRelative:0.4
hSpeed: 0.3


[effect_flameExit]
#priority:high
frameIndex: 3
stripIndex: projectiles
alwayStartDirAtZero:true
life: 15
fadeOut: true
attachedToUnit: false
#color: #fdc14d
color: #FFFFFF
#fadeInTime:5
scaleFrom: 0.0
scaleTo: 1.3
alpha: 0.4
drawUnderUnits:false
liveAfterAttachedDies: false
#ySpeedRelative:0.4
hSpeed:0.2
atmospheric: true


[effect_smoke]
#priority:high
frameIndex: 0
stripIndex: smoke_black
spawnChance: 0.3
life: 90
fadeOut: true
attachedToUnit: false
#color: #fdc14d
color: #FFFFFF
fadeInTime:15
scaleFrom: 0.3
scaleTo: 0.6
alpha: 0.8
drawUnderUnits:false
liveAfterAttachedDies: false
hSpeed: 0.2
dirOffsetRandom:180
atmospheric: true


[effect_lightSlowFade]
image: SHARED:light_50.png
life: 30
fadeOut: true
attachedToUnit: true
color: #ff9224
scaleFrom: 0.25
scaleTo: 0.25
alpha: 0.6

[effect_attachedFlame1]
priority:high
frameIndex: 3
stripIndex: projectiles
life: 120
fadeOut: true
attachedToUnit: true
color: #fdc14d
#color: #FFFFFF
fadeInTime:9
scaleFrom: 0.9
scaleTo: 1.3
alpha: 1.5
drawUnderUnits:false
liveAfterAttachedDies: false

[effect_attachedLight1]
priority:high
image: SHARED:light_50.png
life: 80
fadeOut: true
attachedToUnit: true
color: #fdc14d
fadeInTime:4
scaleFrom: 0.4
scaleTo: 0.4
alpha: 0.5
drawUnderUnits:false
liveAfterAttachedDies: false

[effect_hitFlame1]
frameIndex: 3
stripIndex: projectiles
life: 40
fadeOut: true
attachedToUnit: false
color: #fdc14d
#color: #FFFFFF
scaleFrom: 1.0
scaleTo: 1.2
alpha: 0.5
drawUnderUnits:false
liveAfterAttachedDies: false
physics: true
ySpeedRelative:0.4
hSpeed: 0.3

[effect_explodeCore]
priority: veryhigh
life: 30
attachedToUnit: true
stripIndex: explode_big2
scaleFrom: 2.5
scaleTo: 2.5
alpha: 1
total_frames: 14
animateFrameStart: 0
animateFrameEnd: 13
animateFrameSpeed: 0.5
fadeOut: false

[effect_冲焰闪光]
image: SHARED:light_50.png
life: 25
fadeOut: true
attachedToUnit: false
color: #FF5500
scaleFrom: 1.8
scaleTo: 2.2
alpha: 0.4
dirSpeed: 3
yOffsetRelative: 20

[effect_血星]
priority: critical
image: ROOT:/素材/白星.png
life: 60
fadeOut: true
attachedToUnit: false
color: #FF0000
fadeInTime: 20
scaleFrom: 5
scaleTo: 5.2
alpha: 2

[effect_血光]
priority: critical
image: SHARED:light_50.png
life: 80
fadeOut: true
attachedToUnit: false
color: #FF0000
fadeInTime: 10
scaleFrom: 4
scaleTo: 0
alpha: 2

[effect_血祭扭曲]
priority: critical
drawType: displacement

image: SHARED:cone_inverted_normal_128.png
life: 70
lifeRandom: 10
fadeOut: true
fadeInTime: 2

attachedToUnit: true
color: #FFFFFF
scaleFrom: 5
scaleTo: 0
alpha: 0.3
drawUnderUnits:false

dirOffsetRandom: 180
dirSpeedRandom: 1


[leg_1]
x: -33
y: 23
attach_x: 0
attach_y: 10
moveSpeed: 3.4
resetAngle:5
heightSpeed: 0.8
dust_effect: true
holdDisMin: 11
holdDisMax: 13
hardLimit: 22
image_leg:  leg5.png

[leg_2]
x: 33
y: 23
attach_x: 0
attach_y: 10
copyFrom: 1

[leg_3]
x: -33
y: -23
attach_x: 0
attach_y: -10
copyFrom: 1

[leg_4]
x: 37
y: -23
attach_x: 0
attach_y: -10
copyFrom: 1
image_leg:  leg4.png

#[leg_5]
#x: -37
#y: -0
#attach_x: 0
#attach_y: 0
#copyFrom: 1

[leg_6]
x: 37
y: 0
attach_x: 0
attach_y: 0
copyFrom: 1

[effect_尾焰]
image: 狂化.png
life: 60
scaleTo: 3
alpha: 0.5
fadeOut: true

[effect_炙热]
priority: low
image: light.png
life: 40
scaleFrom: 1.2
scaleTo: 0
alpha: 0.6
fadeOut: true
attachedToUnit: false
ySpeedRelative: 0.1

[movement]
movementType: OVER_CLIFF
moveSpeed: 1.1
moveAccelerationSpeed: 0.08
moveDecelerationSpeed: 0.08
joinsGroupFormations: false

maxTurnSpeed: 2.5
turnAcceleration: 0.5
targetHeight: 3
targetHeightDrift: 0
moveSlidingMode :true
moveIgnoringBody:true
moveSlidingDir:  45
slowDeathFall: true

reverseSpeedPercentage: 1.0

[resource_赤血祭焰]
displayName: 赤血祭焰



