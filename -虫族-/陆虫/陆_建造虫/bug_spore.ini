
[core]
name: bugSpore
altNames: 建造虫
displayText: 建造虫
displayDescription: -建造虫族建筑 \n -没有攻击与维修能力
class: CustomUnitMetadata
price: 150
maxHp: 100
mass: 500

techLevel: 1
buildSpeed: 0.005
#availableInDemo: true

radius: 8
displayRadius: 10
isBio: true
isBug: true
tags: units, 虫族, 小型虫, 建造虫, 虫筑系T1, 一次性建造, 固定射击

selfRegenRate:0.06


softCollisionOnAll: 12

builtFrom_1_name: bugNest
builtFrom_1_pos:  1



dieOnConstruct: true
nanoRange: 12

#showActionsWithMixedSelectionIfOtherUnitsHaveTag: 虫筑系T1

fogOfWarSightRange: 12

overrideAndReplace:bugSpore

autoTriggerCooldownTime: 0.1s

@memory 扩散建造锁定:unit

[template_Build]
isLocked: if not self.globalTeamTags(includes='启')
isLockedMessage: 在母巢生成普拉克勒斯并选择腐蚀分支

[canBuild_1]
@copyFromSection: template_Build
name: bugExtractor
pos:  1


[canBuild_2]
@copyFromSection: template_Build
name: bugNest
pos:  2


[canBuild_3]
@copyFromSection: template_Build
name: bugTurret
pos:  3
isVisible: if not self.globalTeamTags(includes='AI系统') or not (${HalfCorrosion} ${HalfCorrosionLimit})


[canBuild_4]
@copyFromSection: template_Build
name: 飞虫地巢
pos:  4


[canBuild_5]
@copyFromSection: template_Build
name: 水巢
pos:  5


[canBuild_6]
@copyFromSection: template_Build
name: 治愈池
pos:  6


[canBuild_7]
@copyFromSection: template_Build
name: 虫墙
pos:  7


[canBuild_8]
@copyFromSection: template_Build
name: 融合之卵
pos:  8


[canBuild_9]
@copyFromSection: template_Build
name: bugGenerator
pos:  9


[canBuild_恐虐传送门]
name: 亚空间水晶
pos: 100
isVisible: if self.hasResources(混沌元素=1)


[canBuild_1+]
name: 虫族资源抽取器[建造指意]
pos:  1
isVisible: false


[action_皎红化]
isVisible: if self.resource.虚红感染>=1
price: 150
text: 皎红化
descriptionAddFromUnit: ${section.convertTo}
descriptionAddUnitStats: ${section.convertTo}
iconExtraImage: 红散裂.png
displayType: upgrade
buildSpeed: 0.01
pos: 0
convertTo: 皎红建造虫
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${ConvertUpdate2}
spawnEffects: 皎红光

[effect_皎红光]
life: 50
image: SHARED:light_50.png
color: #ff0000
scaleFrom: 1.2
scaleTo: 0.5
alpha: 1.2

[resource_虚红感染]
displayName: 虚红感染
hidden: true


[action_腐蚀之意-扩散]
isVisible: if self.globalTeamTags(includes='腐蚀之意')
isActive: if not self.tags(includes="腐蚀之意-扩散建造虫")
price: 600
text: 腐蚀之意 - 扩散
description: -自动寻找地图中非己方的资源池建造虫族资源抽取器 \n -每个建造虫会前往不同的资源池
buildSpeed: 0s
pos: 15
unitShownInUI: bugExtractor
iconExtraImage: 六边形.png
iconExtraColor: #AAFFFFFF
temporarilyAddTags: 腐蚀之意-扩散建造虫
isGuiBlinking: if self.tags(includes="腐蚀之意-扩散建造虫")
highPriorityQueue: true
allowMultipleInQueue: false
takeResources_includeUnitsWithinRange: 9999
takeResources_excludeUnitsWithoutTags: 资源池
takeResources_includeUnitsWithinRange_team: neutral
takeResources_triggerActionForEach: 虫族抽取器-扩散建造
takeResources_searchOnly: true
clearAllWaypoints: true
alsoQueueAction: 扩散建造锁定

[hiddenAction_虫族抽取器-扩散建造]
requireConditional: if thisActionTarget.getAsMarker.numberOfUnitsInTeam(withTag='资源提取器', withinRange=20, incompleteBuildings=true) + thisActionTarget.getAsMarker.self.numberOfUnitsInAllyNotOwnTeam(withTag='资源提取器', withinRange=20, incompleteBuildings=true)<1
addWaypoint_type: build
addWaypoint_unitType: bugExtractor
addWaypoint_target_mapMustBeReachable: false
addWaypoint_target_fromReference: thisActionTarget
takeResources_includeUnitsWithinRange: 9999
takeResources_excludeUnitsWithoutTags: 腐蚀之意-扩散建造虫
takeResources_includeUnitsWithinRange_team: own
takeResources_triggerActionForEach: 一次性建造优化
takeResources_searchOnly: true

[hiddenAction_扩散建造锁定]
id: 扩散建造锁定
buildSpeed: 0.01s
highPriorityQueue: true
setUnitMemory: 扩散建造锁定=activeWaypointTarget.getAsMarker
alsoTriggerAction: 扩散建造归一

[hiddenAction_扩散建造归一]
addWaypoint_type: build
addWaypoint_unitType: 虫族资源抽取器[建造指意]
addWaypoint_prepend: true
addWaypoint_target_mapMustBeReachable: false
addWaypoint_target_fromReference: memory.扩散建造锁定
clearAllWaypoints: true

[hiddenAction_扩散建造取消]
autoTriggerOnEvent: newWaypointGivenByPlayer, destroyed
autoTrigger: if self.tags(includes="腐蚀之意-扩散建造虫") and not self.hasActiveWaypoint(type='build')
requireConditional: if self.tags(includes="腐蚀之意-扩散建造虫") and self.numberOfQueuedWaypoints(type='build')<2
temporarilyRemoveTags: 腐蚀之意-扩散建造虫
setUnitMemory: 扩散建造锁定=null
addResources: 600


[hiddenAction_一次性建造优化检测]
@copyFromSection: template_一次性建造优化检测

[hiddenAction_一次性建造优化]
@copyFromSection: template_一次性建造优化

[graphics]

total_frames: 3
image:        bug_spore.png
image_wreak:  NONE
image_turret: NONE
#scaleImagesTo: 20
#scaleTurretImagesTo: 9

#AUTO
image_shadow: AUTO_ANIMATED
shadowOffsetX:1
shadowOffsetY:1


animation_moving_start: 0
animation_moving_end: 2
animation_moving_speed: 4

animation_idle_start: 0
animation_idle_end: 0



[attack]

isMelee: true

canAttack: false
canAttackFlyingUnits: false
canAttackLandUnits:   true
canAttackUnderwaterUnits: false

isFixedFiring: true

turretSize: 20
turretTurnSpeed: 3

maxAttackRange: 9
shootDelay: 30


[projectile_1]
tags= T-projectile
directDamage: 23
life: 50
instant: true


[movement]
movementType: LAND
moveSpeed: 0.8
moveAccelerationSpeed: 0.12
moveDecelerationSpeed: 0.12


maxTurnSpeed: 6.5
turnAcceleration: 0.4

moveSlidingMode :true
moveIgnoringBody:true
moveSlidingDir:  181

reverseSpeedPercentage:0


[global_resource_玩家总数]
displayName: 玩家总数


[ai]
useAsBuilder: true

[global_resource_混沌元素]
hidden: false
displayName: 混沌元素
displayColor: #FF1A00
priority: 1


[hiddenAction_AI{AddTags}]
autoTrigger: if numberOfUnitsInEnemyTeam(withTag='AI系统', greaterThan=0) and numberOfUnitsInEnemyTeam(withTag='基地', greaterThan=0, withinRange=1000)
temporarilyAddTags: 建造者[侵]
[hiddenAction_AI{resetTags}]
autoTrigger: if numberOfUnitsInEnemyTeam(withTag='AI系统', greaterThan=0) and numberOfUnitsInEnemyTeam(lessThan=1, withinRange=1000)
temporarilyRemoveTags: 建造者[侵]


[canBuild_AI4]
name: AI虫塔
pos:  4
isVisible: if self.globalTeamTags(includes='AI系统') and ${HalfCorrosion} ${HalfCorrosionLimit}

[hiddenAction_AIMiner]
autoTrigger: if self.globalTeamTags(includes='AI系统') and not numberOfUnitsInTeam(withTag='造矿虫', greaterThan=0) and numberOfUnitsInTeam(withTag='虫巢', greaterThan=0, incompleteBuildings=true)
temporarilyAddTags: 造矿虫

[hiddenAction_AIMiner+]
autoTrigger: if self.globalTeamTags(includes='AI系统') and not numberOfUnitsInTeam(withTag='造矿虫', greaterThan=1) and not self.globalTeamTags(includes='开端{I}') and not numberOfUnitsInTeam(withTag='资源提取器', greaterThan=5) and numberOfUnitsInTeam(withTag='虫巢', greaterThan=0, incompleteBuildings=true)
temporarilyAddTags: 造矿虫

[hiddenAction_AI-BuildCheck]
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.hasActiveWaypoint(type='build') and self.tags(includes='造矿虫')
takeResources: hp=0
takeResources_includeUnitsWithinRange: 9999
takeResources_includeUnitsWithinRange_team: any
takeResources_excludeUnitsWithoutTags: 矿点1
takeResources_maxUnits: 1
takeResources_triggerActionIfAnyCollected: AI-Build

[hiddenAction_AI-Build]
addWaypoint_type: build
addWaypoint_unitType: bugExtractor
addWaypoint_prepend: true
addWaypoint_target_mapMustBeReachable: false
addWaypoint_target_nearestUnit_tagged: 矿点1
addWaypoint_target_nearestUnit_team: any
clearAllWaypoints: true

[hiddenAction_AI-Buildturret]
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.hasActiveWaypoint(type='build') and numberOfUnitsInEnemyTeam(withTag='炮塔', greaterThan=0, withinRange=500, incompleteBuildings=true) and not numberOfUnitsInTeam(withTag='炮塔', greaterThan=1, withinRange=400, incompleteBuildings=true) and not numberOfUnitsInTeam(greaterThan=1, withinRange=80, incompleteBuildings=true)
addWaypoint_type: build
addWaypoint_unitType: AI虫塔
addWaypoint_prepend: true
addWaypoint_target_nearestUnit_tagged: 建造虫
addWaypoint_target_nearestUnit_team: own

[hiddenAction_AIBuildAccomplish]
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.hasActiveWaypoint(type='build') and self.tags(includes='造矿虫') and self.hasFlag(id=0)
alsoTriggerAction: AI-Build

[hiddenAction_AIBuildBlocked]
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.hasActiveWaypoint(type='build') and self.tags(includes='造矿虫') and not self.isMoving
addResources: AI阻挡=1

[hiddenAction_AIBuildBlockedRecover]
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.hasActiveWaypoint(type='build') and self.tags(includes='造矿虫') and self.isMoving and self.hasResources(AI阻挡=1)
addResources: AI阻挡=-1

[hiddenAction_AIBlockInformation]
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.hasActiveWaypoint(type='build') and self.tags(includes='造矿虫') and not self.isMoving and self.hasResources(AI阻挡=4)
takeResources: setFlag=0
takeResources_includeUnitsWithinRange: 2000
takeResources_includeUnitsWithinRange_team: any
takeResources_excludeUnitsWithoutTags: 矿点1
takeResources_maxUnits: 1
alsoTriggerAction: AI-Build
resourceAmount: AI阻挡
resourceAmount_setValue: 0

[hiddenAction_AIGroundDetection]
addWaypoint_type: move
addWaypoint_prepend: false
addWaypoint_maxTime: 0s
addWaypoint_target_nearestUnit_tagged: 基地
addWaypoint_target_nearestUnit_team: own
addWaypoint_triggerActionIfMatched: AIBuildAddTag
autoTrigger:if self.globalTeamTags(includes='AI系统') and self.hasResources(600) and not self.hasActiveWaypoint(type='move') and not self.hasActiveWaypoint(type='build') and self.globalTeamTags(includes='战隙{I}') and not self.globalTeamTags(includes='中刻{I}') and not self.tags(includes='基地路径确认')

[hiddenAction_AIBuildAddTag]
temporarilyAddTags: 基地路径确认

[hiddenAction_AI-bugNestBuild]
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.hasActiveWaypoint(type='build') and not self.hasActiveWaypoint(type='move') and (not numberOfUnitsInTeam(withTag='虫巢', greaterThan=0, incompleteBuildings=true) and self.timeAlive(laterThanSeconds=0.4) )
addWaypoint_type: build
addWaypoint_unitType: bugNest
addWaypoint_prepend: true
addWaypoint_target_mapMustBeReachable: true
addWaypoint_position_fromAction: true
alsoTriggerAction: AIrandomMove

[hiddenAction_AIrandomMove]
addWaypoint_type: move
addWaypoint_prepend: false
addWaypoint_target_mapMustBeReachable: true
addWaypoint_position_randomOffsetFromSelf: 150,150

[hiddenAction_AI-飞虫地巢Build]
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.hasActiveWaypoint(type='build') and not self.hasActiveWaypoint(type='move') and self.globalTeamTags(includes='中刻{I}') and not self.globalTeamTags(includes='后界{I}')
addWaypoint_type: build
addWaypoint_unitType: 飞虫地巢
addWaypoint_prepend: true
addWaypoint_target_mapMustBeReachable: true
addWaypoint_position_fromAction: true
alsoTriggerAction: AIrandomMove

[resource_AI阻挡]
displayName: AI阻挡