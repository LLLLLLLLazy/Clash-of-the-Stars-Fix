[core]

name: 群虫
displayText: 群虫
displayDescription: -攻击地面单位 \n -死亡时治疗周围友军 \n -血量归零不会立即死亡 \n “我们是一个整体！”
class: CustomUnitMetadata
price: 650, 腐蚀=${corrode}
maxHp: 320
mass: 800

armour: 2
armourMinDamageToKeep: 2

techLevel: 2
buildSpeed: 0.0065
#availableInDemo: true

radius: 10
displayRadius: 12
isBio: true
isBug: true
tags: units, 虫族, 小型虫, 群虫, 群虫成体, 转向攻击
showActionsWithMixedSelectionIfOtherUnitsHaveTag: 群虫

numBitsOnDeath: 5



selfRegenRate: 0.1


softCollisionOnAll: 5

disableDeathOnZeroHp: true

unitsSpawnedOnDeath: 资源返还(addResources=ammo: 125|energy: 2)

autoTriggerCooldownTime: 0.001s
autoTriggerCooldownTime_allowDangerousHighCPU: true

@memory 临死时间:float

[hiddenAction_腐蚀价格]
@global corrode: 10
autoTrigger: if memory.腐蚀价格!=${corrode}
setUnitMemory: 腐蚀价格=${corrode}

[action_狂猎击杀]
@copyFromSection: template_狂猎击杀

[action_狂猎击杀2]
@copyFromSection: template_狂猎击杀2

[action_治疗液]
isActive: false
text: 治疗液
description: -濒死时治疗附近的己方单位 \n 治疗: 200 | 范围: 85 | 随距离衰减 | 边缘计算
pos: 0
displayType: infoOnly
buildSpeed: 0s
addResources: hp=1

[hiddenAction_临死时间]
autoTriggerOnEvent: created
setUnitMemory: 临死时间=rnd(0, self.id)/self.id*0.2

[hiddenAction_临死]
autoTriggerOnEvent: tookDamage
autoTrigger: if self.hp < 1 and not self.hasFlag(id=0)
requireConditional: if self.hp < 1 and not self.hasFlag(id=0)
addResources: setFlag=0
resetCustomTimer: true
convertTo: 群虫[临死]
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${ConvertUpdate2}
convertTo_keepCurrentFields: maxHp, maxShield

[hiddenAction_濒死]
autoTrigger: if self.hasFlag(id=0) and (self.customTimer>memory.临死时间 or numberOfUnitsInTeam(withTag='群虫临死', withinRange=95)<=1)
fireTurretXAtGround: 2
fireTurretXAtGround_withOffset: 0,0
setUnitMemory: 属性[24]=-${movement.moveSpeed*0.5}, 属性[14]=0
setResourcesWithLogic: hp=5
convertTo: 群虫[濒死]
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${ConvertUpdate2}


[hiddenAction_无延迟追击B]
@copyFromSection: template_无延迟追击B
[hiddenAction_无延迟追击B2]
@copyFromSection: template_无延迟追击B2


[action_扩散移动点开]
@copyFromSection: template_扩散移动点开

[action_扩散移动点关]
@copyFromSection: template_扩散移动点关

[hiddenAction_设置扩散移动点]
@copyFromSection: template_设置扩散移动点

[hiddenAction_清除当前非巡逻路径]
@copyFromSection: template_清除当前非巡逻路径

[hiddenAction_锁定扩散移动点]
@copyFromSection: template_锁定扩散移动点

[hiddenAction_执行扩散移动点]
@copyFromSection: template_执行扩散移动点

[graphics]
total_frames: 5

image: bug_melee.png

image_turret: NONE
#scaleImagesTo: 20
#scaleTurretImagesTo: 9

#AUTO
image_shadow: AUTO_ANIMATED
shadowOffsetX: 0
shadowOffsetY: 0


animation_moving_start: 0
animation_moving_end: 2
animation_moving_speed: 3
#animation_moving_pingPong: true

animation_idle_start: 0
animation_idle_end: 0
animation_idle_speed: 120
animation_idle_scale_start: 1
animation_idle_scale_end: 1.03
animation_idle_pingPong: true

animation_attack_start: 2
animation_attack_end: 4
animation_attack_speed: 4


lock_body_rotation_with_main_turret: true


[attack]

isMelee: true
meleeEngangementDistance: 150

canAttack: true
canAttackFlyingUnits: false
canAttackLandUnits: true
canAttackUnderwaterUnits: false

#isFixedFiring: true

turretSize: 20
turretTurnSpeed: 6

maxAttackRange: 12
shootDelay: 42

[turret_1]
x: 0
y: 0

recoilOffset: 3
recoilOutTime: 6
recoilReturnTime: 18

projectile: 1
onShoot_triggerActions: AIattack确认

[turret_2]
x: 0
y: 0

canShoot: false

projectile: 2

[projectile_1]
tags= T-projectile
directDamage: 30
life: 50
instant: true

[projectile_2]
tags= T-projectile
areaDamage: -200
areaRadius: 85
areaRadiusFromEdge: true
areaHitAirAndLandAtSameTime: true
shieldDefectionMultiplier: 0
shieldDamageMultiplier: 0
life: 50
instant: true
targetGround: true
friendlyFire: only-ignoreEnemy
explodeEffect: CUSTOM:shockwave
mutatorX_ifUnitWithTags: 群虫
mutatorX_areaDamageMultiplier: 1
mutatorX_addResourcesAreaHit: unsetFlag=0

mutator2_ifUnitWithTags: 群虫濒死
mutator2_areaDamageMultiplier: 0

mutator1_ifUnitWithTags: 中立资源
mutator1_areaDamageMultiplier: 0

[effect_shockwave]
life: 30
image: bubble.png
scaleFrom: 0
scaleTo: 3.5
alpha: 0.8
drawUnderUnits:true

[movement]
movementType: LAND
moveSpeed: 1.1
moveAccelerationSpeed: 0.07
moveDecelerationSpeed: 0.12


maxTurnSpeed: 5.5
turnAcceleration: 0.5

targetHeight: 0
targetHeightDrift: 0

moveSlidingMode: true
moveIgnoringBody: true
moveSlidingDir: 181



reverseSpeedPercentage: 0

[ai]
upgradedFrom: 群虫幼体

[hiddenAction_AIGather]
addWaypoint_type: guard
addWaypoint_prepend: true
addWaypoint_maxTime: 2s
addWaypoint_target_nearestUnit_tagged: 基地
addWaypoint_target_nearestUnit_team: own
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.hasActiveWaypoint(type='guard') and (not self.globalTeamTags(includes='开端{I}') or numberOfUnitsInTeam(withTag='群虫幼体', greaterThan=5) and not self.globalTeamTags(includes='战隙{I}') or numberOfUnitsInEnemyTeam(withTag='地震塔T2', greaterThan=0) and (not self.globalTeamTags(includes='开端计攻2') or numberOfUnitsInTeam(withTag='寻攻路筛选', greaterThan=0))) and (numberOfUnitsInEnemyTeam(withTag='地震T2升级中', lessThan=1, withinRange=1000) or self.globalTeamTags(includes='开端{I}'))

[hiddenAction_AI屯兵集结]
clearAllWaypoints: true
addWaypoint_type: guard
addWaypoint_prepend: true
addWaypoint_maxTime: 8s
addWaypoint_target_nearestUnit_tagged: 资源提取器
addWaypoint_target_nearestUnit_team: own
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.globalTeamTags(includes='AI屯兵') and not self.isAttacking and not self.hasActiveWaypoint(type='guard') and numberOfUnitsInTeam(withTag='资源提取器', greaterThan=0, withinRange=650) and numberOfUnitsInEnemyTeam(withTag='units', lessThan=2, withinRange=420)

[hiddenAction_AI屯兵基地集结]
clearAllWaypoints: true
addWaypoint_type: guard
addWaypoint_prepend: true
addWaypoint_maxTime: 8s
addWaypoint_target_nearestUnit_tagged: 基地
addWaypoint_target_nearestUnit_team: own
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.globalTeamTags(includes='AI屯兵') and not self.isAttacking and not self.hasActiveWaypoint(type='guard') and (numberOfUnitsInTeam(withTag='资源提取器', lessThan=1, withinRange=650) or numberOfUnitsInEnemyTeam(withTag='units', greaterThan=1, withinRange=420))

[hiddenAction_AI爆发突击]
clearAllWaypoints: true
addWaypoint_type: attackMove
addWaypoint_prepend: true
addWaypoint_maxTime: 20s
addWaypoint_target_nearestUnit_tagged: 基地
addWaypoint_target_nearestUnit_team: enemy
addWaypoint_target_mapMustBeReachable: true
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.globalTeamTags(includes='AI爆发') and not self.globalTeamTags(includes='AI屯兵') and not self.isAttacking and not self.hasActiveWaypoint(type='attackMove') and not numberOfUnitsInEnemyTeam(withinRange=300, greaterThan=0, withTag='布克布克')

[hiddenAction_AIBack]
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.hasActiveWaypoint(type='guard') and self.isAttacking and not self.globalTeamTags(includes='开端{I}') and self.hp(lessThan=300)
clearAllWaypoints: true
addWaypoint_type: touchTarget
addWaypoint_prepend: true
addWaypoint_maxTime: 20s
addWaypoint_target_nearestUnit_tagged: 基地
addWaypoint_target_nearestUnit_team: own

[hiddenAction_AI攻震前虫]
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.globalTeamTags(includes='开端{I}') and numberOfUnitsInEnemyTeam(withTag='地震T2升级中', greaterThan=0, withinRange=1000) and numberOfUnitsInEnemyTeam(withTag='地震T2升级中', lessThan=1, withinRange=400) and numberOfUnitsInTeam(withTag='群虫前锋', lessThan=1)
temporarilyAddTags: 群虫前锋

[hiddenAction_AI攻震]
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.globalTeamTags(includes='开端{I}') and numberOfUnitsInEnemyTeam(withTag='地震T2升级中', greaterThan=0, withinRange=1000) and self.tags(includes='群虫前锋') and not self.hasActiveWaypoint(type='attack')
clearAllWaypoints: true
addWaypoint_type: attack
addWaypoint_prepend: true
addWaypoint_maxTime: 5s
addWaypoint_target_nearestUnit_tagged: 地震T2升级中
addWaypoint_target_nearestUnit_team: enemy
addWaypoint_target_mapMustBeReachable: true

[hiddenAction_AI攻震跟虫]
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.globalTeamTags(includes='开端{I}') and numberOfUnitsInEnemyTeam(withTag='地震T2升级中', greaterThan=0) and not numberOfUnitsInTeam(withTag='群虫前锋', greaterThan=0, withinRange=150) and not self.tags(includes='群虫前锋') and not self.hasActiveWaypoint(type='attack')
@copyFromSection: hiddenAction_AI攻震

[hiddenAction_AI攻震跟虫撤]
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.globalTeamTags(includes='开端{I}') and numberOfUnitsInEnemyTeam(withTag='地震T2升级中', greaterThan=0) and numberOfUnitsInTeam(withTag='群虫前锋', greaterThan=0, withinRange=150) and not self.tags(includes='群虫前锋')
@copyFromSection: hiddenAction_AIwithdraw

[hiddenAction_AImoveattack]
clearAllWaypoints: true
addWaypoint_type: follow
addWaypoint_prepend: true
addWaypoint_maxTime: 20s
addWaypoint_target_nearestUnit_tagged: 基地
addWaypoint_target_nearestUnit_team: enemy
addWaypoint_target_mapMustBeReachable: true
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.globalTeamTags(includes='AI屯兵') and not self.isAttacking and self.globalTeamTags(includes='开端{I}') and not numberOfUnitsInTeam(withTag='群虫幼体', greaterThan=5) and not self.hasActiveWaypoint(type='follow') and not numberOfUnitsInEnemyTeam(withinRange=300, greaterThan=0, withTag='布克布克') and (not numberOfUnitsInEnemyTeam(withTag='地震塔T2', greaterThan=0) or self.globalTeamTags(includes='开端计攻2') and not self.globalTeamTags(includes='攻路2确定') and numberOfUnitsInTeam(withTag='寻攻路筛选', lessThan=1))

[hiddenAction_AImoveattack2]
@copyFromSection: hiddenAction_AImoveattack
addWaypoint_type: guard
addWaypoint_target_nearestUnit_tagged: 攻路确定
addWaypoint_target_nearestUnit_team: any
addWaypoint_target_mapMustBeReachable: false
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.globalTeamTags(includes='AI屯兵') and not self.isAttacking and self.globalTeamTags(includes='开端{I}') and not numberOfUnitsInTeam(withTag='群虫幼体', greaterThan=5) and not self.hasActiveWaypoint(type='guard') and not numberOfUnitsInEnemyTeam(withinRange=300, greaterThan=0, withTag='布克布克') and self.globalTeamTags(includes='开端计攻2') and self.globalTeamTags(includes='攻路2确定')

[hiddenAction_AIattack2Gather]
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.globalTeamTags(includes='开端{I}') and self.globalTeamTags(includes='开端计攻2') and self.globalTeamTags(includes='攻路2确定')
takeResources: hp=0
takeResources_includeUnitsWithinRange: 200
takeResources_includeUnitsWithinRange_team: any
takeResources_excludeUnitsWithoutTags: 攻路确定
takeResources_maxUnits: 1
takeResources_triggerActionIfAnyCollected: AIattack2Arrives
takeResources_triggerActionIfNoneCollected: AIattack2Ungathered

[hiddenAction_AIattack2Arrives]
temporarilyRemoveTags: 群虫攻路二集
alsoTriggerAction: AIattack2Gathered

[hiddenAction_AIattack2Ungathered]
temporarilyAddTags: 群虫攻路二集

[hiddenAction_AIattack2Gathered]
requireConditional: if self.globalTeamTags(includes='AI系统') and self.globalTeamTags(includes='开端{I}') and self.globalTeamTags(includes='开端计攻2') and self.globalTeamTags(includes='攻路2确定') and numberOfUnitsInTeam(withTag='群虫攻路二集', lessThan=5)
removeGlobalTeamTags: 攻路2确定
takeResources: setFlag=1
takeResources_discardCollected: true
takeResources_includeUnitsWithinRange: 200
takeResources_includeUnitsWithinRange_team: any
takeResources_excludeUnitsWithoutTags: 攻路确定
takeResources_maxUnits: 1


[hiddenAction_AI攻击计时重置]
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.globalTeamTags(includes='开端{I}') and not numberOfUnitsInTeam(withTag='群虫幼体', greaterThan=5) and not self.hasActiveWaypoint(type='follow') and self.hasActiveWaypoint(type='attackMove') and not numberOfUnitsInEnemyTeam(withinRange=300, greaterThan=0, withTag='布克布克') and not numberOfUnitsInEnemyTeam(withinRange=400, greaterThan=0, withTag='地震塔T2') and self.isAttacking and self.customTimer(laterThanSeconds=8)
resetCustomTimer: true

[hiddenAction_AIinvalidattack]
@copyFromSection: hiddenAction_AImoveattack
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.globalTeamTags(includes='开端{I}') and not numberOfUnitsInTeam(withTag='群虫幼体', greaterThan=5) and not self.hasActiveWaypoint(type='follow') and self.hasActiveWaypoint(type='attackMove') and not numberOfUnitsInEnemyTeam(withinRange=300, greaterThan=0, withTag='布克布克') and not numberOfUnitsInEnemyTeam(withinRange=400, greaterThan=0, withTag='地震塔T2') and self.isAttacking and self.customTimer(laterThanSeconds=6)
resetCustomTimer: true
temporarilyAddTags: 无效攻击

[hiddenAction_AIInvalidrecovery]
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.globalTeamTags(includes='开端{I}') and not numberOfUnitsInTeam(withTag='群虫幼体', greaterThan=5) and self.hasActiveWaypoint(type='follow') and self.customTimer(laterThanSeconds=6)
temporarilyRemoveTags: 无效攻击

[hiddenAction_AIattack]
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.globalTeamTags(includes='AI屯兵') and numberOfUnitsInEnemyTeam(withinRange=300, greaterThan=0) and (self.hasActiveWaypoint(type='follow') or self.hasActiveWaypoint(type='attack') or self.hasActiveWaypoint(type='guard') and self.globalTeamTags(includes='攻路2确定')) and self.customTimer(laterThanSeconds=3) and not numberOfUnitsInEnemyTeam(withinRange=300, greaterThan=0, withTag='布克布克') and not numberOfUnitsInEnemyTeam(withinRange=400, greaterThan=0, withTag='地震塔T2') and not self.tags(includes='无效攻击')
clearAllWaypoints: true
addWaypoint_type: attackMove
addWaypoint_prepend: true
addWaypoint_maxTime: 20s
addWaypoint_target_nearestUnit_tagged: 基地
addWaypoint_target_nearestUnit_team: enemy
addWaypoint_target_mapMustBeReachable: true
resetCustomTimer: true

[hiddenAction_AI指定攻击]
addWaypoint_type: attack
addWaypoint_prepend: true
addWaypoint_maxTime: 20s
addWaypoint_target_mapMustBeReachable: true
addWaypoint_target_nearestUnit_tagged: T3机枪, 电机枪塔, 火焰喷射器T2, 毒气兵, 火炮塔
addWaypoint_target_nearestUnit_team: enemy
addWaypoint_target_nearestUnit_maxRange: 200
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.globalTeamTags(includes='AI屯兵') and self.globalTeamTags(includes='开端{I}') and not numberOfUnitsInEnemyTeam(withinRange=300, greaterThan=0, withTag='布克布克') and not numberOfUnitsInEnemyTeam(withinRange=400, greaterThan=0, withTag='地震塔T2')

[hiddenAction_AIwithdraw]
addWaypoint_type: move
addWaypoint_prepend: true
addWaypoint_maxTime: 5s
addWaypoint_target_nearestUnit_tagged: 基地
addWaypoint_target_nearestUnit_team: own
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.hasActiveWaypoint(type='move') and (numberOfUnitsInEnemyTeam(withinRange=300, greaterThan=0, withTag='布克布克') and numberOfUnitsInTeam(withTag='开端辅虫', greaterThan=2, withinRange=500) or numberOfUnitsInEnemyTeam(withinRange=400, greaterThan=0, withTag='地震塔T2') and numberOfUnitsInTeam(withTag='自爆飞虫', greaterThan=2, withinRange=600))

[hiddenAction_AIattack侦测]
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.globalTeamTags(includes='AI屯兵') and self.customTimer(laterThanSeconds=0.5, withinSeconds=1.5) and not self.isAttacking() and not self.tags(includes='无效攻击')
alsoTriggerAction: AImoveattack

[hiddenAction_AIattack确认]
resetCustomTimer: true
