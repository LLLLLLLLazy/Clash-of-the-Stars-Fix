
[core]
name: 行愿人
displayText: 行愿人
displayDescription: -近身范围斩击 \n -神光系统 \n -受到来自正面的伤害减少25%
class: CustomUnitMetadata
price: 11000, 苍蓝能量=1
maxHp: 7000
mass: 70000

tags: units, 转向攻击, 行愿人
showActionsWithMixedSelectionIfOtherUnitsHaveTag: 行愿人

techLevel: 2
buildSpeed: 0.0005

armour: 15
armourMinDamageToKeep: 15

radius: 33
displayRadius: 33

selfRegenRate: 0.2

energyMax: 3
energyRegen: 0.0167

transportSlotsNeeded: 3

[action_holyLight]
isActive: false
requireConditional: if self.isEnergyFull() and not eventSource.self.tags(includes="召唤物")
autoTriggerOnEvent: killedAnyUnit
text: 神光系统
description: [回光] \n -击杀目标后回复600血量 \n CD:3s \n [神光加护] \n -进入战斗时第一次受到伤害获得300临时护甲与0.6移速强化 \n -每秒减少100临时护甲与0.2移速
pos: 0
displayType: infoOnly
buildSpeed: 3s
iconImage: 神系光环.png
addResources: energy=-3, hp=600
spawnEffects: CUSTOM:holyLight, CUSTOM:holyLight2*8

[effect_holyLight]
alsoPlaySound:圣光.ogg:0.6
image: SHARED:light_50.png
life: 150
fadeOut: true
attachedToUnit: true
color: #FFFF68
scaleFrom: 1.6
scaleTo: 0.8
alpha: 0.9
drawUnderUnits:false

[effect_holyLight2]
priority:low
image: SHARED:light_50.png
life: 150
fadeOut: true
attachedToUnit: true
color: #FFFF68
hSpeed: 1
hSpeedRandom: 0.5
scaleFrom: 1.6
scaleTo: 0.2
alpha: 0.6
drawUnderUnits:false

[hiddenAction_holyLightShield]
requireConditional: if numberOfUnitsInEnemyTeam(withTag="units", greaterThan=0, withinRange=300) and not self.hp(full=true) and not self.tags(includes='神光守护') and self.resource.神光守护<=0
temporarilyAddTags: 神光守护
spawnEffects: 神光护盾显, 神光守护粒子聚合*20

addResources: 神光守护=400
setUnitMemory: 属性[26]=memory.属性[26]+400, 属性[24]=memory.属性[24]+0.8
alsoTriggerAction: 属性变化

[hiddenAction_holyLightShieldDissipation]
autoTrigger: if self.resource.神光守护>0
addResources: 神光守护=-100
setUnitMemory: 属性[26]=memory.属性[26]-100, 属性[24]=memory.属性[24]-0.2
alsoTriggerAction: 属性变化

[hiddenAction_holyLightShieldRefresh]
autoTrigger: if self.resource.神光守护<=0 and numberOfUnitsInEnemyTeam(withTag="units", lessThan=1, withinRange=300) and self.tags(includes='神光守护')
temporarilyRemoveTags: 神光守护

[resource_神光守护]
displayName: 神光守护


[effect_神光护盾显]
priority: critical
image: 神光护盾.png
life: 30
fadeInTime: 30
fadeOut: false
attachedToUnit: true
scaleFrom: 1
scaleTo: 1
alpha: 1
dirSpeed: 1
alsoEmitEffectsOnDeath: 神光护盾, 神光护盾闪

[effect_神光护盾]
priority: critical
image: 神光护盾.png
life: 150
fadeOut: true
attachedToUnit: true
scaleFrom: 1
scaleTo: 1
alpha: 3
color: #AAFFFFFF
dirSpeed: 2
trailEffect: 神光护盾渐烁
trailEffectRate: 8

[effect_神光护盾渐烁]
priority: verylow
image: 神光护盾.png
life: 60
fadeOut: true
attachedToUnit: true
scaleFrom: 1
scaleTo: 1.1
alpha: 0.2
dirSpeed: 1.75

[effect_神光护盾闪]
image: 神光护盾.png
life: 25
fadeOut: true
attachedToUnit: true
scaleFrom: 1
scaleTo: 1.05
alpha: 1
dirSpeed: 3


[effect_神光守护粒子聚合]
image: SHARED:blank.png
life: 0
dirOffsetRandom: 180
alsoEmitEffectsOnDeath: 神光守护粒子

[effect_神光守护粒子]
priority: verylow
image: 白粒.png
imageShadow: 白粒.png
life: 40
lifeRandom: 10
fadeInTime: 10
fadeOut: true
attachedToUnit: true
color: #FFFF68
scaleFrom: 2.5
scaleTo: 2.5
alpha: 0.7

physics: true
physicsGravity: 0.5

hOffset: 15
hOffsetRandom: 10

yOffsetRelative: 100
yOffsetRelativeRandom: 20

ySpeedRelative: -3
ySpeedRelativeRandom: -1

delayedStartTimerRandom: 10


[hiddenAction_vigilance]
autoTrigger: if numberOfUnitsInEnemyTeam(withTag="units", greaterThan=0, withinRange=300)
alsoQueueAction: GoIntoBattle

[hiddenAction_GoIntoBattle]
convertTo: 行愿人[战斗]
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${ConvertUpdate2}
buildSpeed: 0.9s
whenBuilding_playAnimation: Go

[animation_Go]
arm1_0s:{x:0, y:0, dir:0}
arm1_0.4s:{x:0, y:0, dir:50}
arm1_0.9s:{x:0, y:0, dir:100}

arm2_0s:{x:0, y:0, dir:0}
arm2_0.4s:{x:0, y:2, dir:7}
arm2_0.9s:{x:0, y:4, dir:15}


[hiddenAction_血量记录]
autoTrigger: if self.resource.受击前血量!=self.hp
setResourcesWithLogic: 受击前血量=self.hp

[hiddenAction_血量减伤]
autoTriggerOnEvent: tookDamage
requireConditional: if self.resource.受击前血量>self.hp and directionBetween(attachment(withTag='单位向定位'), eventSource)-attachment(withTag='单位向定位').dir >-45 and directionBetween(attachment(withTag='单位向定位'), eventSource)-attachment(withTag='单位向定位').dir <45
setResourcesWithLogic: hp=self.hp+(self.resource.受击前血量-self.hp) * 0.25, 受击前血量=self.hp

[hiddenAction_受伤记录]
autoTriggerOnEvent: tookDamage
setResourcesWithLogic: 受击前血量=self.hp

[resource_受击前血量]
hidden: true

[attachment_单位向定位]
x: 0
y: 0
onCreateSpawnUnitOf: 单位向定位
alwaysAllowedToAttackParentsMainTarget: true
resetRotationWhenNotAttacking: true


[graphics]
total_frames: 1
image:       圣骑士主体.png
image_wreak: NONE
image_turret: NONE

#teamColorsOnTurret: true

image_shadow: AUTO
shadowOffsetX:2
shadowOffsetY:2

lock_body_rotation_with_main_turret: true
lock_leg_rotation_with_main_turret: true

[attack]
canAttack: true
canAttackFlyingUnits: false
canAttackLandUnits:   true
canAttackUnderwaterUnits: false

turretSize: 20
turretTurnSpeed: 3

maxAttackRange: 30
shootDelay: 60

isMelee: true

[turret_1]
#主体
invisible: true
canShoot: false
x: 0
y: 0
idleDir: 0
turnSpeed: 2.9
turnSpeedAcceleration: 0.3

recoilOffset: 1
recoilOutTime: 7
recoilReturnTime: 21

[turret_2]
#右臂
invisible: true
attachedTo: 1
x: 0
y: 0
idleDir: 0

turnSpeed: 4.0
turnSpeedAcceleration: 1.0

shoot_sound:斩击.wav
shoot_sound_vol:0.4
#shoot_flame:small

projectile: 1

[turret_3]
#肩甲
image: 圣骑士主体.png
canShoot: false
x: 0
y: 0
attachedTo: 1
slave: true
idleDir: 0

turnSpeed: 0

[projectile_1]
tags= T-projectile
areaDamage: 200
areaRadius: 70
areaRadiusFromEdge: true
largeHitEffect: true
life: 50
instant: true

explodeEffect: CUSTOM:爆裂, CUSTOM:hitLightFlash
explodeEffectOnShield: CUSTOM:爆裂, CUSTOM:hitLightFlash
#spawnProjectilesOnExplode:爆炸效果

[projectile_爆炸效果]
tags= T-projectile
areaDamage: 0
areaRadius: 70
largeHitEffect: true
life:0
explodeOnEndOfLife:true

[effect_爆裂]
priority:veryhigh
life: 64

scaleFrom: 2.0
scaleTo: 2.0

drawUnderUnits:false

image: Breath.png
total_frames: 15
animateFrameStart: 0
animateFrameEnd: 14
animateFramePingPong: false
animateFrameSpeed: 0.5

[effect_hitLightFlash]
image: SHARED:light_50.png
life: 64
fadeOut: true
attachedToUnit: false
color: #FFFF68

scaleFrom: 1.8
scaleTo: 1.8
alpha: 0.6
drawUnderUnits:false

[movement]
movementType: OVER_CLIFF
moveSpeed: 0.8
moveAccelerationSpeed: 0.07
moveDecelerationSpeed: 0.17

reverseSpeedPercentage: 0

maxTurnSpeed: 5.0
turnAcceleration: 0.5

moveSlidingMode :true
moveIgnoringBody:true

[arm_1]
x: 24
y: 0
image_end: 圣骑士右.png
drawOverBody: false
drawDirOffset: -60
moveSpeed: 18

[arm_2]
x: -24
y: 0
image_end: 圣骑士左.png
drawOverBody: false
drawDirOffset: 50
moveSpeed: 18

[leg_1]
x: -15
y: -2
attach_x: -8
attach_y: -2
moveSpeed: 2.4

rotateSpeed: 7

heightSpeed: 0.8
resetAngle:25

image_leg:  圣骑士的腿.png
image_foot: 圣骑士的脚.png

#draw_foot_on_top: true
#dust_effect: false

holdDisMin: 21
holdDisMax: 45


[leg_2]
x: 15
y: -2
attach_x: 8
attach_y: -2
copyFrom: 1