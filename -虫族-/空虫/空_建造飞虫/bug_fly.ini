
[core]
name: bugFly
displayText: 建造飞虫
displayDescription: -建造虫族建筑
class: CustomUnitMetadata
price: 500
maxHp: 160
mass: 500

overrideAndReplace: bugFly

techLevel: 1
buildSpeed: 0.005
#availableInDemo: true

radius: 8
displayRadius: 10
isBio: true
isBug: true
tags: units, 虫族, 小型虫, 建造飞虫, 虫筑系T1, 虫水筑系T1, 一次性建造, 固定射击

selfRegenRate:0.06

softCollisionOnAll: 12


builtFrom_1_name: bugNest
builtFrom_1_pos:  2



dieOnConstruct: true
nanoRange: 12

showActionsWithMixedSelectionIfOtherUnitsHaveTag: 虫筑系T1

@memory 扩散建造锁定:unit

[template_Build]
isLocked: if not self.globalTeamTags(includes='启')
isLockedMessage: 在母巢生成普拉克勒斯并选择腐蚀分支

[canBuild_1]
@copyFromSection: template_Build
name: bugExtractor
pos:  1


[canBuild_2]
@copyFromSection: template_Build
name: bugNest
pos:  2


[canBuild_3]
@copyFromSection: template_Build
name: bugTurret
pos:  3


[canBuild_4]
@copyFromSection: template_Build
name: 飞虫地巢
pos:  4


[canBuild_5]
@copyFromSection: template_Build
name: 水巢
pos:  5


[canBuild_6]
@copyFromSection: template_Build
name: 治愈池
pos:  6


[canBuild_7]
@copyFromSection: template_Build
name: 虫墙
pos:  7


[canBuild_8]
@copyFromSection: template_Build
name: 融合之卵
pos:  8


[canBuild_9]
@copyFromSection: template_Build
name: bugGenerator
pos:  9


[canBuild_恐虐传送门]
name: 亚空间水晶
pos: 100
isVisible: if self.hasResources(混沌元素=1)


[canBuild_1+]
name: 虫族资源抽取器[建造指意]
pos:  1
isVisible: false

[action_腐蚀之意-扩散]
isVisible: if self.globalTeamTags(includes='腐蚀之意')
isActive: if not self.tags(includes="腐蚀之意-扩散建造虫")
price: 600
text: 腐蚀之意 - 扩散
description: -自动寻找地图中非己方的资源池建造虫族资源抽取器 \n -每个建造虫会前往不同的资源池
buildSpeed: 0s
pos: 15
unitShownInUI: bugExtractor
iconExtraImage: 六边形.png
iconExtraColor: #AAFFFFFF
temporarilyAddTags: 腐蚀之意-扩散建造虫
isGuiBlinking: if self.tags(includes="腐蚀之意-扩散建造虫")
highPriorityQueue: true
allowMultipleInQueue: false
takeResources_includeUnitsWithinRange: 9999
takeResources_excludeUnitsWithoutTags: 资源池
takeResources_includeUnitsWithinRange_team: neutral
takeResources_triggerActionForEach: 虫族抽取器-扩散建造
takeResources_searchOnly: true
clearAllWaypoints: true
alsoQueueAction: 扩散建造锁定

[hiddenAction_虫族抽取器-扩散建造]
requireConditional: if thisActionTarget.getAsMarker.numberOfUnitsInTeam(withTag='资源提取器', withinRange=20, incompleteBuildings=true) + thisActionTarget.getAsMarker.self.numberOfUnitsInAllyNotOwnTeam(withTag='资源提取器', withinRange=20, incompleteBuildings=true)<1
addWaypoint_type: build
addWaypoint_unitType: bugExtractor
addWaypoint_target_mapMustBeReachable: false
addWaypoint_target_fromReference: thisActionTarget
takeResources_includeUnitsWithinRange: 9999
takeResources_excludeUnitsWithoutTags: 腐蚀之意-扩散建造虫
takeResources_includeUnitsWithinRange_team: own
takeResources_triggerActionForEach: 一次性建造优化
takeResources_searchOnly: true

[hiddenAction_扩散建造锁定]
id: 扩散建造锁定
buildSpeed: 0.01s
highPriorityQueue: true
setUnitMemory: 扩散建造锁定=activeWaypointTarget.getAsMarker
alsoTriggerAction: 扩散建造归一

[hiddenAction_扩散建造归一]
addWaypoint_type: build
addWaypoint_unitType: 虫族资源抽取器[建造指意]
addWaypoint_prepend: true
addWaypoint_target_mapMustBeReachable: false
addWaypoint_target_fromReference: memory.扩散建造锁定
clearAllWaypoints: true

[hiddenAction_扩散建造取消]
autoTriggerOnEvent: newWaypointGivenByPlayer, destroyed
autoTrigger: if self.tags(includes="腐蚀之意-扩散建造虫") and not self.hasActiveWaypoint(type='build')
requireConditional: if self.tags(includes="腐蚀之意-扩散建造虫") and self.numberOfQueuedWaypoints(type='build')<2
temporarilyRemoveTags: 腐蚀之意-扩散建造虫
setUnitMemory: 扩散建造锁定=null
addResources: 600


[hiddenAction_一次性建造优化检测]
@copyFromSection: template_一次性建造优化检测

[hiddenAction_一次性建造优化]
@copyFromSection: template_一次性建造优化

[graphics]

total_frames: 2
image:        bug_fly.png
image_wreak:  NONE
image_turret: NONE
#scaleImagesTo: 20
#scaleTurretImagesTo: 9

#AUTO
image_shadow: AUTO_ANIMATED
shadowOffsetX:1
shadowOffsetY:1


animation_moving_start: 0
animation_moving_end: 1
animation_moving_speed: 2

animation_idle_start: 0
animation_idle_end: 0
animation_idle_speed: 10


[attack]

isMelee: true

canAttack: false
canAttackFlyingUnits: true
canAttackLandUnits:   true
canAttackUnderwaterUnits: false

isFixedFiring: true

turretSize: 20
turretTurnSpeed: 3

maxAttackRange: 9
shootDelay: 30


[projectile_1]
tags= T-projectile
directDamage: 10
life: 50
instant: true


[movement]
movementType: AIR
moveSpeed: 1.4
moveAccelerationSpeed: 0.12
moveDecelerationSpeed: 0.12


landOnGround: true


targetHeight: 15
targetHeightDrift: 3

maxTurnSpeed: 6.5
turnAcceleration: 0.4

moveSlidingMode :true
moveIgnoringBody:true
moveSlidingDir:  181


[ai]
useAsBuilder: true

[global_resource_混沌元素]
hidden: false
displayName: 混沌元素
displayColor: #FF1A00
priority: 1



[canBuild_AI中位虫塔]
name: AI中位虫塔
isVisible: false

[hiddenAction_AIMidworm]
autoTrigger: if self.globalTeamTags(includes='AI系统') and not numberOfUnitsInTeam(withTag='中塔虫', greaterThan=0) and not self.globalTeamTags(includes='开端{I}')
temporarilyAddTags: 中塔虫
addResources: 中位=1

[hiddenAction_AI-bugTurretBuild]
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.hasActiveWaypoint(type='build') and self.tags(includes='中塔虫') and self.hasResources(1000)
addWaypoint_type: build
addWaypoint_unitType: AI中位虫塔
addWaypoint_prepend: true
addWaypoint_target_mapMustBeReachable: false
addWaypoint_target_nearestUnit_tagged: 中点塔位
addWaypoint_target_nearestUnit_team: any
alsoTriggerAction: AI-MidpointDetection

[hiddenAction_AI-MidpointDetection]
takeResources: hp=0
takeResources_includeUnitsWithinRange: 80
takeResources_includeUnitsWithinRange_team: any
takeResources_excludeUnitsWithoutTags: 中点塔位
takeResources_triggerActionIfAnyCollected: AI-bugTurretBuildRandom

[hiddenAction_AI-bugTurretBuildRandom]
addWaypoint_type: move
addWaypoint_prepend: false
addWaypoint_target_mapMustBeReachable: true
addWaypoint_position_randomOffsetFromSelf: 80, 80
addWaypoint_triggerActionIfMatched: AI-bugTurretBuild2
addWaypoint_maxTime: 0s

[hiddenAction_AI-bugTurretBuild2]
addWaypoint_type: build
addWaypoint_unitType: AI中位虫塔
addWaypoint_prepend: true
addWaypoint_position_fromAction: true

[hiddenAction_AIMiner]
autoTrigger: if self.globalTeamTags(includes='AI系统') and numberOfUnitsInTeam(withTag='造矿飞虫', lessThan=3) and numberOfUnitsInNeutralTeam(withTag='空资源池', greaterThan=0) and (numberOfUnitsInTeam(withTag='中塔虫', greaterThan=0) and not self.tags(includes='中塔虫') or self.globalTeamTags(includes='开端{I}'))
temporarilyAddTags: 造矿飞虫

[hiddenAction_AIMiner+]
autoTrigger: if self.globalTeamTags(includes='AI系统') and numberOfUnitsInTeam(withTag='造矿飞虫', lessThan=4) and numberOfUnitsInNeutralTeam(withTag='空资源池', greaterThan=0) and not numberOfUnitsInTeam(withTag='资源提取器', greaterThan=12) and (numberOfUnitsInTeam(withTag='中塔虫', greaterThan=0) and not self.tags(includes='中塔虫') or self.globalTeamTags(includes='开端{I}')) and (not self.globalTeamTags(includes='中刻{I}') or self.hasResources(900))
temporarilyAddTags: 造矿飞虫

[hiddenAction_AIMiner屯兵扩张]
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.globalTeamTags(includes='AI屯兵') and numberOfUnitsInNeutralTeam(withTag='空资源池', greaterThan=0) and numberOfUnitsInTeam(withTag='造矿飞虫', lessThan=5) and not self.tags(includes='造矿飞虫')
temporarilyAddTags: 造矿飞虫

[hiddenAction_AI-Build]
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.hasActiveWaypoint(type='build') and self.tags(includes='造矿飞虫') and numberOfUnitsInNeutralTeam(withTag='空资源池', greaterThan=0)
addWaypoint_type: build
addWaypoint_unitType: bugExtractor
addWaypoint_prepend: true
addWaypoint_target_mapMustBeReachable: true
addWaypoint_target_nearestUnit_tagged: 空资源池
addWaypoint_target_nearestUnit_team: any

[hiddenAction_AI-Buildturret]
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.hasActiveWaypoint(type='build') and self.tags(includes='造矿飞虫') and not self.tags(includes='AI矿坑护塔完成') and self.hasResources(900) and not numberOfUnitsInTeam(withTag='炮塔', greaterThan=3, withinRange=380, incompleteBuildings=true) and self.numberOfUnitsInAllyNotOwnTeam(withTag='炮塔', lessThan=5, withinRange=380, incompleteBuildings=true) and not numberOfUnitsInTeam(greaterThan=3, withinRange=90, incompleteBuildings=true)
addWaypoint_type: build
addWaypoint_unitType: bugTurret
addWaypoint_prepend: true
addWaypoint_target_nearestUnit_tagged: 建造飞虫
addWaypoint_target_nearestUnit_team: own
temporarilyAddTags: AI矿坑护塔完成

[hiddenAction_AI-BuildturretReset]
autoTrigger: if self.tags(includes='AI矿坑护塔完成') and not self.hasActiveWaypoint(type='build')
temporarilyRemoveTags: AI矿坑护塔完成

[hiddenAction_AI-矿区预建塔]
autoTrigger: if self.globalTeamTags(includes='AI系统') and (self.globalTeamTags(includes='AI屯兵') or self.globalTeamTags(includes='AI爆发')) and not self.hasActiveWaypoint(type='build') and not self.hasActiveWaypoint(type='move') and self.hasResources(900) and numberOfUnitsInTeam(withTag='资源提取器', greaterThan=0, withinRange=500) and numberOfUnitsInEnemyTeam(withTag='units', lessThan=3, withinRange=520) and not numberOfUnitsInTeam(withTag='炮塔', greaterThan=3, withinRange=340, incompleteBuildings=true) and self.numberOfUnitsInAllyNotOwnTeam(withTag='炮塔', lessThan=6, withinRange=340, incompleteBuildings=true) and numberOfUnitsInTeam(withTag='虫建筑', lessThan=7, withinRange=110, incompleteBuildings=true) and self.numberOfUnitsInAllyNotOwnTeam(withTag='虫建筑', lessThan=5, withinRange=110, incompleteBuildings=true)
addWaypoint_type: build
addWaypoint_unitType: bugTurret
addWaypoint_prepend: true
addWaypoint_target_nearestUnit_tagged: 资源提取器
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_mapMustBeReachable: true

[hiddenAction_AI-占区防御建塔]
autoTrigger: if self.globalTeamTags(includes='AI系统') and (self.globalTeamTags(includes='AI屯兵') or self.globalTeamTags(includes='AI爆发')) and self.globalTeamTags(includes='战隙{I}') and not self.hasActiveWaypoint(type='build') and not self.hasActiveWaypoint(type='move') and self.hasResources(900) and numberOfUnitsInTeam(withTag='资源提取器', greaterThan=0, withinRange=500) and not numberOfUnitsInTeam(withTag='炮塔', greaterThan=5, withinRange=340, incompleteBuildings=true) and self.numberOfUnitsInAllyNotOwnTeam(withTag='炮塔', lessThan=7, withinRange=340, incompleteBuildings=true) and numberOfUnitsInTeam(withTag='虫建筑', lessThan=7, withinRange=110, incompleteBuildings=true) and self.numberOfUnitsInAllyNotOwnTeam(withTag='虫建筑', lessThan=5, withinRange=110, incompleteBuildings=true)
addWaypoint_type: build
addWaypoint_unitType: bugTurret
addWaypoint_prepend: true
addWaypoint_target_nearestUnit_tagged: 资源提取器
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_mapMustBeReachable: true

[hiddenAction_AI-前线压进建塔]
autoTrigger: if self.globalTeamTags(includes='AI系统') and (self.globalTeamTags(includes='AI屯兵') or self.globalTeamTags(includes='AI爆发')) and self.globalTeamTags(includes='战隙{I}') and self.hasResources(900) and not self.hasActiveWaypoint(type='build') and not self.hasActiveWaypoint(type='move') and numberOfUnitsInTeam(withTag='资源提取器', greaterThan=0, withinRange=560) and numberOfUnitsInEnemyTeam(withTag='units', greaterThan=0, withinRange=560) and not numberOfUnitsInTeam(withTag='炮塔', greaterThan=5, withinRange=420, incompleteBuildings=true) and self.numberOfUnitsInAllyNotOwnTeam(withTag='炮塔', lessThan=7, withinRange=420, incompleteBuildings=true) and numberOfUnitsInTeam(withTag='虫建筑', lessThan=7, withinRange=110, incompleteBuildings=true) and self.numberOfUnitsInAllyNotOwnTeam(withTag='虫建筑', lessThan=5, withinRange=110, incompleteBuildings=true)
addWaypoint_type: build
addWaypoint_unitType: bugTurret
addWaypoint_prepend: true
addWaypoint_target_nearestUnit_tagged: 资源提取器
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_mapMustBeReachable: true

[hiddenAction_AI-占区恢复建池]
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.globalTeamTags(includes='AI屯兵') and self.globalTeamTags(includes='战隙{I}') and not self.hasActiveWaypoint(type='build') and not self.hasActiveWaypoint(type='move') and self.hasResources(1600) and numberOfUnitsInTeam(withTag='资源提取器', greaterThan=0, withinRange=430) and not numberOfUnitsInTeam(withTag='治愈池', greaterThan=0, withinRange=320, incompleteBuildings=true) and self.numberOfUnitsInAllyNotOwnTeam(withTag='治愈池', lessThan=1, withinRange=320, incompleteBuildings=true) and numberOfUnitsInEnemyTeam(withTag='units', lessThan=2, withinRange=520) and numberOfUnitsInTeam(withTag='虫建筑', lessThan=5, withinRange=100, incompleteBuildings=true) and self.numberOfUnitsInAllyNotOwnTeam(withTag='虫建筑', lessThan=3, withinRange=100, incompleteBuildings=true)
addWaypoint_type: build
addWaypoint_unitType: 治愈池
addWaypoint_prepend: true
addWaypoint_target_nearestUnit_tagged: 资源提取器
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_mapMustBeReachable: true

[hiddenAction_AI-占区兵营建巢]
autoTrigger: if self.globalTeamTags(includes='AI系统') and (self.globalTeamTags(includes='AI屯兵') or self.globalTeamTags(includes='AI爆发')) and self.globalTeamTags(includes='中刻{I}') and not self.hasActiveWaypoint(type='build') and not self.hasActiveWaypoint(type='move') and self.hasResources(900) and numberOfUnitsInTeam(withTag='资源提取器', greaterThan=0, withinRange=500) and numberOfUnitsInTeam(withTag='虫巢', lessThan=1, withinRange=460, incompleteBuildings=true) and self.numberOfUnitsInAllyNotOwnTeam(withTag='虫巢', lessThan=1, withinRange=460, incompleteBuildings=true) and numberOfUnitsInEnemyTeam(withTag='units', lessThan=3, withinRange=540) and numberOfUnitsInTeam(withTag='虫建筑', lessThan=5, withinRange=100, incompleteBuildings=true) and self.numberOfUnitsInAllyNotOwnTeam(withTag='虫建筑', lessThan=3, withinRange=100, incompleteBuildings=true)
addWaypoint_type: build
addWaypoint_unitType: bugNest
addWaypoint_prepend: true
addWaypoint_target_nearestUnit_tagged: 资源提取器
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_mapMustBeReachable: true

[hiddenAction_AI-占区空巢建造]
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.globalTeamTags(includes='中刻{I}') and not self.hasActiveWaypoint(type='build') and not self.hasActiveWaypoint(type='move') and self.hasResources(1500) and numberOfUnitsInTeam(withTag='资源提取器', greaterThan=0, withinRange=520) and numberOfUnitsInTeam(withTag='虫巢', greaterThan=1, withinRange=520, incompleteBuildings=true) and numberOfUnitsInTeam(withTag='虫飞巢', lessThan=1, withinRange=520, incompleteBuildings=true) and self.numberOfUnitsInAllyNotOwnTeam(withTag='虫飞巢', lessThan=1, withinRange=520, incompleteBuildings=true) and numberOfUnitsInTeam(withTag='虫飞巢', lessThan=2, incompleteBuildings=true) and self.numberOfUnitsInAllyNotOwnTeam(withTag='虫飞巢', lessThan=2, incompleteBuildings=true) and numberOfUnitsInEnemyTeam(withTag='units', lessThan=3, withinRange=560) and numberOfUnitsInTeam(withTag='虫建筑', lessThan=5, withinRange=100, incompleteBuildings=true) and self.numberOfUnitsInAllyNotOwnTeam(withTag='虫建筑', lessThan=3, withinRange=100, incompleteBuildings=true)
addWaypoint_type: build
addWaypoint_unitType: 飞虫地巢
addWaypoint_prepend: true
addWaypoint_target_nearestUnit_tagged: 资源提取器
addWaypoint_target_nearestUnit_team: own
addWaypoint_target_mapMustBeReachable: true

[hiddenAction_AI-占区水巢建造]
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.globalTeamTags(includes='中刻{I}') and not self.hasActiveWaypoint(type='build') and not self.hasActiveWaypoint(type='move') and self.isOverwater and self.hasResources(1000) and (numberOfUnitsInTeam(withTag='资源提取器', greaterThan=0, withinRange=560) or numberOfUnitsInTeam(withTag='基地', greaterThan=0, withinRange=820)) and numberOfUnitsInTeam(withTag='水下工厂', lessThan=1, withinRange=640, incompleteBuildings=true) and self.numberOfUnitsInAllyNotOwnTeam(withTag='水下工厂', lessThan=1, withinRange=640, incompleteBuildings=true) and numberOfUnitsInTeam(withTag='水下工厂', lessThan=3, incompleteBuildings=true) and self.numberOfUnitsInAllyNotOwnTeam(withTag='水下工厂', lessThan=3, incompleteBuildings=true) and numberOfUnitsInTeam(withTag='虫建筑', lessThan=6, withinRange=110, incompleteBuildings=true) and self.numberOfUnitsInAllyNotOwnTeam(withTag='虫建筑', lessThan=4, withinRange=110, incompleteBuildings=true)
addWaypoint_type: build
addWaypoint_unitType: 水巢
addWaypoint_prepend: true
addWaypoint_target_mapMustBeReachable: true
addWaypoint_position_fromAction: true

[resource_中位]
displayName: AI中位
