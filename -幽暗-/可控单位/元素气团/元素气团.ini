
[core]
name: 元素气团
displayText: 元素气团
displayDescription: -混沌的无息气团 \n -概率闪避伤害 \n -伤害地面与空中 \n -使目标丧失抵抗能力
class: CustomUnitMetadata
switchPriceWithStreamingCost: true
price: 6000
maxHp: 1000
mass: 1800
tags: 效果免疫, 防毒

techLevel: 1
buildSpeed: 0.001
#availableInDemo: true

radius: 18
displayRadius: 26

isBio: true
isBug: false

selfRegenRate: 0.2

softCollisionOnAll: 26

showOnMinimapToEnemies: false

[action_near]
isActive: if not self.hasFlag(id=1)
addResources: setFlag=1
displayType: action
text: 启用闪烁
description: -允许闪烁
buildSpeed: 0
pos: 1
allowMultipleInQueue: false

[action_far]
isActive: if self.hasFlag(id=1)
addResources: unsetFlag=1
displayType: action
text: 禁用闪烁
description: -禁止闪烁
buildSpeed: 0
pos: 2
allowMultipleInQueue: false

[hiddenAction_血量记录]
autoTrigger: if self.resource.受击前血量!=self.hp
setResourcesWithLogic: 受击前血量=self.hp, 闪避概率=rnd(0, 1)

[hiddenAction_伤害随机]
autoTriggerOnEvent: tookDamage
requireConditional: if self.resource.受击前血量>self.hp and self.resource.闪避概率<0.6
setResourcesWithLogic: hp=self.hp+(self.resource.受击前血量-self.hp), 受击前血量=self.hp, 闪避概率=rnd(0, 1)

[hiddenAction_受伤记录]
autoTriggerOnEvent: tookDamage
requireConditional: if self.resource.闪避概率>=0.6
setResourcesWithLogic: 受击前血量=self.hp, 闪避概率=rnd(0, 1)


[resource_受击前血量]
hidden: true

[resource_闪避概率]
hidden: true


[hiddenAction_gas]
autoTrigger: true
spawnEffects:CUSTOM:gas*3

[hiddenAction_gas2]
autoTrigger: if self.isMoving
spawnEffects: gas2*2

[effect_gas]
priority: veryhigh
stripIndex: effects
frameIndex: 0

life: 330
fadeOut: true
attachedToUnit: true
color: #360D70
fadeInTime: 20
scaleFrom: 3
scaleTo: 4
alpha: 0.6
drawUnderUnits:false

shadow: true
atmospheric: true

hSpeed: 0.1

dirOffsetRandom:180

xOffsetRelativeRandom:20
yOffsetRelativeRandom:20

xSpeedAbsoluteRandom: 0.2
ySpeedAbsoluteRandom: 0.2

[effect_gas2]
@copyFromSection: effect_gas
priority: low
attachedToUnit: false
delayedStartTimerRandom: 40

[graphics]
total_frames: 1

image:        null.png
image_wreak:  NONE
image_turret: NONE
#scaleImagesTo: 20
#scaleTurretImagesTo: 9
icon_zoomed_out_neverShow: true

#AUTO
image_shadow: NONE
shadowOffsetX:0
shadowOffsetY:0

showHealthBar: false

[decal_紫雾Preview]
onlyInPreview: true
order: 0.1
layer: afterBody
image: 云.png
imageScale: 0.3
color: #360D70
alpha: 0.7

[decal_紫雾2Preview]
@copyFromSection: decal_紫雾Preview
isVisible: if rnd(1, 8) <2
image: fog.png
imageScale: 0.4

[decal_紫雾3Preview]
@copyFromSection: decal_紫雾Preview
isVisible: if rnd(1, 8) >2 and rnd(1, 8) <=5
image: fog2.png
imageScale: 1

[decal_紫雾4Preview]
@copyFromSection: decal_紫雾Preview
isVisible: if rnd(1, 8) >=4 and rnd(1, 8) <=6
image: fog3.png
imageScale: 0.14

[decal_紫雾5Preview]
@copyFromSection: decal_紫雾Preview
isVisible: if rnd(1, 8) >=5
image: fog4.png
imageScale: 0.16

[attack]
canAttack: true
canAttackFlyingUnits: true
canAttackLandUnits:   true
canAttackUnderwaterUnits: false

turretSize: 1
turretTurnSpeed: 20

maxAttackRange: 260
shootDelay: 6

turretMultiTargeting: true

[turret_1]
x: 0
y: 0

shoot_flame: CUSTOM:hitLightFlash

limitingMinRange: 40

projectile: 1

[projectile_1]
life: 100
speed: 9
targetSpeed: 6

invisible: true

deflectionPower: -1

areaDamage: 10
areaRadius: 65
shieldDamageMultiplier: 0.5
shieldDefectionMultiplier: 0.5

explodeEffect: CUSTOM:detentionGas
explodeEffectOnShield: CUSTOM:detentionGas

trailEffect: CUSTOM:dangerGas
trailEffectRate: 2

spawnUnit: 麻痹(spawnChance=0.05)

[turret_2]
x: 0
y: 0

shoot_flame: CUSTOM:hitLightFlash

canAttackCondition: if self.hasFlag(id=1)

limitingMinRange: 40

delay: 400

projectile: 2

[projectile_2]
life: 100
speed: 5

invisible: true

deflectionPower: -1

teleportSource: true

areaDamage: 100
areaRadius: 80
shieldDamageMultiplier: 0.5
shieldDefectionMultiplier: 0.5

explodeEffect: CUSTOM:hitLightFlash, CUSTOM:displacement, CUSTOM:displacement2, CUSTOM:superDangerGas*8
explodeEffectOnShield: CUSTOM:hitLightFlash, CUSTOM:displacement, CUSTOM:displacement2, CUSTOM:superDangerGas*8

trailEffect: CUSTOM:hitLightFlash
trailEffectRate: 5

spawnUnit: 麻痹

[turret_3]
x: 0
y: 0

shoot_flame: CUSTOM:hitLightFlash

limitingRange: 40

projectile: 3

[projectile_3]
life: 50
speed: 20

invisible: true

deflectionPower: -1

areaDamage: 25
areaRadius: 80
shieldDamageMultiplier: 0.5
shieldDefectionMultiplier: 0.5

explodeEffect: CUSTOM:superDangerGas*2
explodeEffectOnShield: CUSTOM:superDangerGas*2

spawnUnit: 麻痹(spawnChance=0.1)

[effect_hitLightFlash]
priority:high

image: SHARED:light_50.png
life: 30
fadeOut: true
attachedToUnit: false
color: #584770

scaleFrom: 1.8
scaleTo: 1.2
alpha: 0.6
drawUnderUnits:false

[effect_dangerGas]
priority: low
stripIndex: effects
frameIndex: 0

life: 20
fadeOut: true
attachedToUnit: false
color: #360D70
fadeInTime: 3
scaleFrom: 2.7
scaleTo: 0.3
alpha: 0.3
drawUnderUnits:false

dirOffsetRandom:180

xOffsetRelativeRandom:2
yOffsetRelativeRandom:2

xSpeedAbsoluteRandom: 0.2
ySpeedAbsoluteRandom: 0.2

[effect_detentionGas]
priority: low
stripIndex: effects
frameIndex: 0

life: 50
fadeOut: true
attachedToUnit: false
color: #360D70
fadeInTime: 5
scaleFrom: 2.0
scaleTo: 3.0
alpha: 0.4
drawUnderUnits:false

dirOffsetRandom:180

xSpeedAbsoluteRandom: 0.4
ySpeedAbsoluteRandom: 0.4

[effect_displacement]
drawType: displacement

image: SHARED:ripple_normal_128.png
life: 40
fadeOut: true
fadeInTime: 2

attachedToUnit: false
color: #FFFFFF
scaleFrom: 0
scaleTo: 3.0
alpha: 0.5
drawUnderUnits:false

hOffset: 30

dirOffsetRandom: 180
dirSpeedRandom: 1

alsoPlaySound:重雾.ogg:0.8

[effect_displacement2]
drawType: displacement

image: SHARED:ripple_normal_128.png
delayedStartTimer: 25
life: 20
fadeOut: true
fadeInTime: 2

attachedToUnit: false
color: #FFFFFF
scaleFrom: 2.5
scaleTo: 0
alpha: 0.5
drawUnderUnits:false

hOffset: 30

dirOffsetRandom: 180
dirSpeedRandom: 1

[effect_superDangerGas]
priority: low
stripIndex: effects
frameIndex: 0

life: 150
fadeOut: true
attachedToUnit: false
color: #360D70
fadeInTime: 10
scaleFrom: 2.5
scaleTo: 3.3
alpha: 0.5
drawUnderUnits:false

dirOffsetRandom:180

xOffsetRelativeRandom:35
yOffsetRelativeRandom:35

xSpeedAbsoluteRandom: 0.9
ySpeedAbsoluteRandom: 0.9

[movement]
movementType: AIR
moveSpeed: 1.4
moveAccelerationSpeed: 0.04
moveDecelerationSpeed: 0.07

maxTurnSpeed: 5.5
turnAcceleration: 0.5

moveSlidingMode :true
moveIgnoringBody:true
moveSlidingDir:  181

reverseSpeedPercentage:0