
[core]
name: 反击坦克
displayText: 锁咒荆棘
displayDescription: -超厚装甲 \n -消耗能量束缚一定范围内锁定自身的敌方单位 \n -对近距离的敌人造成范围电击 \n -可使部分敌方单位不易脱离 \n -对建筑伤害较弱 \n -自我修复
class: CustomUnitMetadata
price: 8000
maxHp: 6000

mass: 20000
tags: units, 反击坦克

armour: 15
armourMinDamageToKeep: 15

transportSlotsNeeded: 3

techLevel: 3
buildSpeed: 0.0004
#availableInDemo: true

selfRegenRate: 0.1

radius:27
displayRadius: 27

isBio: false
softCollisionOnAll: 0

energyMax: 15
energyRegen: 0

autoTriggerCooldownTime: 0.1s

@memory 锁咒锁定:unit

[hiddenAction_攻击接近]
requireConditional: if activeWaypointTarget==attacking
addWaypoint_type: touchTarget
addWaypoint_prepend: true
addWaypoint_maxTime: 0.5s
addWaypoint_target_fromReference: activeWaypointTarget

[hiddenAction_锁咒检测]
autoTrigger: if memory.锁咒锁定==null and self.energy>5
takeResources_searchOnly: true
takeResources_includeUnitsWithinRange: 360
takeResources_excludeUnitsWithoutTags: units
takeResources_includeUnitsWithinRange_team: enemy
takeResources_triggerActionForEach: 锁咒锁定

[hiddenAction_锁咒锁定]
requireConditional: if memory.锁咒锁定==null and thisActionTarget.activeWaypointTarget==self and thisActionTarget.readUnitMemory("建筑", type='boolean')==false and thisActionTarget.maxMoveSpeed>0
setUnitMemory: 锁咒锁定=thisActionTarget
spawnUnits: 锁定目标(addResources=setFlag:2)
playSoundAtUnit: 电击.ogg

[hiddenAction_锁咒]
autoTrigger: if distanceBetween(self, memory.锁咒锁定)>250
fireTurretXAtGround: 2
fireTurretXAtGround_withTarget: memory.锁咒锁定
fireTurretXAtGround_withProjectile: 锁咒


[hiddenAction_锁咒耗能]
autoTrigger: if self.energy>0 and memory.锁咒锁定!=null
addResources: energy=-0.1

[hiddenAction_锁咒回能]
autoTrigger: if not self.isEnergyFull and memory.锁咒锁定==null
addResources: energy=0.15

[hiddenAction_锁咒断开]
autoTrigger: if memory.锁咒锁定.hp<=0 or self.energy<=0 or distanceBetween(self, memory.锁咒锁定)>360 or memory.锁咒锁定.readUnitMemory("建筑", type='boolean')==true
setUnitMemory: 锁咒锁定=null


[decal_锁咒范围]
isVisible: if memory.锁咒锁定!=null
alwaysStartDirAtZero: true
alwaysStartHeightAtZero: true
onlyWhileAlive: true
basePosition: self
layer: shadow
image: 范围圈600.png
imageScale: ${250/300}
alpha: 0.4
color: #00D4FF


[graphics]
total_frames: 8
teamColorsOnTurret: true
image: 锁咒荆棘.png
image_wreak:body_dead.png
image_turret: NONE
#AUTO
image_shadow: AUTO
shadowOffsetX:3
shadowOffsetY:3

animation_moving_start: 4
animation_moving_end: 7
animation_moving_speed: 4

animation_idle_start: 0
animation_idle_end: 3
animation_idle_speed: 10

dustEffect:true

[attack]
canAttack: true
canAttackFlyingUnits: true
canAttackLandUnits:   true
canAttackUnderwaterUnits: false

turretSize: 0
turretTurnSpeed: 100

maxAttackRange: 100
shootDelay: 0.5s

[turret_1]
x: 0
y: 0
idleDir: 0
canAttackMaxAngle: 181
onShoot_triggerActions: 攻击接近

shoot_sound: 电击2.ogg
shoot_sound_vol: 0.3
shoot_flame: CUSTOM:电流领域*4

[turret_2]
x: 0
y: 4
projectile: 3
canAttackMaxAngle: 181

[projectile_1]
tags= T-projectile
areaDamage: 35
areaRadius: 100
areaDamageNoFalloff: true

life: 0
speed: 0
invisible: true
explodeOnEndOfLife: true
areaHitAirAndLandAtSameTime: true

shieldDamageMultiplier: 1
shieldDefectionMultiplier: 0.1

buildingDamageMultiplier: 0.5

explodeEffect: 磁圈

spawnProjectilesOnExplode: 2

[projectile_2]
tags= T-projectile
areaDamage: 0
areaRadius: 99
areaIgnoreUnitsCloserThan: 86
areaHitAirAndLandAtSameTime: true

life: 0
speed: 0
explodeOnEndOfLife: true

pushVelocity: -0.06

explodeEffect: NONE
explodeEffectOnShield: NONE

moveWithParent: true
delayedStartTimer: 0.5
spawnProjectilesOnExplode: 2(recursionLimit=61)

[projectile_3]
tags= T-projectile
directDamage: 90
life: 5
instant: true
invisible: true

shieldDamageMultiplier: 1
shieldDefectionMultiplier: 0.1

buildingDamageMultiplier: 0.5

explodeEffect: 中心咒磁, 电粒子*5, hitLightFlash, lightningShock
explodeEffectOnShield: 中心咒磁, 电粒子*5, hitLightFlash, lightningShock

[projectile_锁咒]
tags= T-projectile
areaDamage: 0
areaRadius: 1
areaRadiusFromEdge: true
pushVelocity: -1.6

life: 5
instant: true
areaHitAirAndLandAtSameTime: true

retargetingInFlight: true
retargetingInFlightSearchDelay: 0
retargetingInFlightSearchRange: 5

explodeEffect: CUSTOM:雷核, CUSTOM:雷核光


[effect_电流领域]
life: 20
fadeOut: false
attachedToUnit: true
image: 电流领域.png
scaleFrom: 1.8
scaleTo: 1.5
alpha: 0.3
drawUnderUnits:false
total_frames: 4
animateFrameStart: 0
animateFrameEnd: 3
animateFramePingPong: false
animateFrameSpeed: 0.3
dirOffsetRandom:180

[effect_磁圈]
life: 60
fadeOut: true
attachedToUnit: false
image: 磁圈.png
scaleFrom: 6
scaleTo: 6
alpha: 0.2
color: #00D4FF
drawUnderUnits: false
dirOffsetRandom: 180
dirSpeedRandom: 5
dirSpeed: 10

[effect_中心咒磁]
life: 23
fadeInTime: 5
fadeOut: true
attachedToUnit: true
image: 白聚合束.png
scaleFrom: 1
scaleTo: 0.1
alpha: 0.9
color: #00D4FF
drawUnderUnits:false
total_frames: 3
animateFrameStart: 0
animateFrameEnd: 2
animateFramePingPong: false
animateFrameSpeed: 0.15
dirOffsetRandom: 180

[effect_电粒子]
attachedToUnit: false
life: 50
lifeRandom: 20
scaleFrom: 0.15
scaleTo: 0.1
color: #00D4FF
xSpeedRelativeRandom: 2
ySpeedRelativeRandom: 2
image: SHARED:light_50.png
priority: verylow

[effect_hitLightFlash]
priority:high

image: SHARED:light_50.png
life: 17
fadeOut: true
attachedToUnit: false
color: #00D4FF

scaleFrom: 1.8
scaleTo: 1.8
alpha: 0.6
drawUnderUnits:false

[effect_lightningShock]
life: 60
fadeOut: false
attachedToUnit: true

color: #00D4FF
alpha: 0.8
image: SHARED:lightning_shock.png
total_frames: 14
animateFrameStart: 0
animateFrameEnd: 13
animateFramePingPong: false
animateFrameSpeed: 0.5



[effect_雷核]
life: 15
fadeOut: true
attachedToUnit: true
image: 雷核.png
scaleFrom: 1.0
scaleTo: 1.0
alpha: 0.3
drawUnderUnits:false

[effect_雷核光]
life: 20
fadeOut: true
attachedToUnit: true
image: 雷核.png
scaleFrom: 1.5
scaleTo: 1.0
alpha: 0.3
drawUnderUnits:false

[movement]
movementType: LAND
moveSpeed: 0.7
moveAccelerationSpeed: 0.04
moveDecelerationSpeed: 0.04

maxTurnSpeed: 1.6
turnAcceleration: 0.08

moveSlidingMode: false
moveIgnoringBody: false

reverseSpeedPercentage: 1
