
[core]
name: 池虫
displayText: 池虫
displayDescription: -厚重的甲壳 \n -能越过水与山崖 \n -可供中小型虫寄居其中 \n -可搭载1个单位在池水中并大幅强化攻速和射程 \n -防护盾可保护其中的单位 \n -池水治愈 \n “边泡澡边驾驶巨兽，这可真有趣！”

price: 70000
maxHp: 12000
mass: 90000

maxShield: 7000

techLevel: 2
buildSpeed: 0.0002

#availableInDemo: true
transportSlotsNeeded: 36

radius: 65
displayRadius: 80

experimental: true

selfRegenRate: 1

isBio: true
isBug: true
tags: units, 虫族, 大型虫, 池虫

fogOfWarSightRange: 22

maxTransportingUnits: 30
transportUnitsHealBy: 1

transportUnitsRequireTag: 小型虫, 中型虫, 中型虫+
transportUnitsRequireMovementType: LAND, HOVER, OVER_CLIFF, OVER_CLIFF_WATER, WATER
transportUnitsBlockOtherTransports:	false
transportUnitsCanUnloadUnits: if not self.isMoving or not self.isTransportUnloading

exit_x: 0
exit_y: 95

autoTriggerCooldownTime: 9

@memory 指定坐标:unit

[action_范围运输]
@copyFromSection: template_范围运输

[hiddenAction_运输路径]
@copyFromSection: template_运输路径

[decal_运输范围]
@copyFromSection: template_运输范围

[action_swamp]
displayType: queueUnit
id: ${section.text}
text: 沼池庭院
description: -将至多前9个单位卸载至所选地面
fireTurretXAtGround: 1
fireTurretXAtGround_withProjectile: unload
fireTurretXAtGround_onlyOverPassableTileOf: OVER_CLIFF

highPriorityQueue: true

allowMultipleInQueue: false
addActionCooldownTime: 12s

canPlayerCancel: false

buildSpeed: 2s
pos: -1

[hiddenAction_护盾修正]
autoTrigger: if not self.shield(lessThan=300)
convertTo: 池虫[护盾]
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${ConvertUpdate2}
convertTo_keepCurrentFields: maxHp, maxShield


[hiddenAction_状态时间]
autoTrigger: if self.attachment(slot="1", withTag='中型虫')!=null or self.attachment(slot="1", withTag='中型虫+')!=null
takeResources: 池虫强化=-1
takeResources_excludeUnitsWithTheseResources: 池虫强化=2
takeResources_includeReference: attachment

[hiddenAction_状态时间附属]
@copyFromSection: hiddenAction_状态时间
autoTrigger: if self.attachment.attachment(slot="1", withTag='中型虫')!=null or self.attachment.attachment(slot="1", withTag='中型虫+')!=null
takeResources_includeReference: attachment.attachment

[resource_池虫强化]
displayName: 池虫强化
hidden: true


[hiddenAction_状态时间2]
@copyFromSection: hiddenAction_状态时间
autoTrigger: if self.attachment(slot="1", withTag='小型虫')!=null
takeResources: 池虫强化2=-1
takeResources_excludeUnitsWithTheseResources: 池虫强化2=2

[hiddenAction_状态时间2附属]
@copyFromSection: hiddenAction_状态时间2
autoTrigger: if self.attachment.attachment(slot="1", withTag='小型虫')!=null
takeResources_includeReference: attachment.attachment

[resource_池虫强化2]
displayName: 池虫强化2
hidden: true


[hiddenAction_攻击范围]
autoTrigger: if attachment.readUnitMemory("属性", type='float', index=4) != memory.属性[4]
setUnitMemory: 属性[20]=attachment.readUnitMemory("属性", type='float', index=4), 属性[55]=0
alsoTriggerAction: 属性变化

[attachment_1]
x: 0
y: -5
height: -2
canAttack: true
addTransportedUnits: true
#添加到被运输
canBeAttackedAndDamaged: true
#可被攻击损坏
rotateWithParent: true
#附属一同旋转
resetRotationWhenNotAttacking: true
#不攻击时恢复角度
lockLegMovement: true
#锁定腿脚
prioritizeParentsMainTarget: true
#优先考虑母体攻击
isUnselectable: false
#禁止选择: false
unloadInCurrentPosition: true
#卸载于此位置
redirectDamageToParent: true
redirectDamageToParent_shieldOnly: true
#重定向到母体护盾



[graphics]
drawLayer: experimentals
imageScale: 1
total_frames: 1
image:        池虫.png
image_wreak:  NONE
image_turret: NONE
image_shield: green_shields.png

image_shadow: AUTO
shadowOffsetX:2
shadowOffsetY:2
splastEffect: true

animation_idle_start: 0
animation_idle_end: 0
animation_idle_speed: 80
animation_idle_scale_start:1
animation_idle_scale_end:1.01
animation_idle_pingPong: true

[decal_1]
onlyWhileAlive: true
layer: beforeUI
image: 池虫池.png
alpha: 0.3
teamColors: true

[attack]
canAttack: true
canAttackFlyingUnits: true
canAttackLandUnits:   true
canAttackUnderwaterUnits: false

turretSize: 0
turretTurnSpeed: 0

maxAttackRange: 0
shootDelay: 50

[turret_1]
x: 0
y: 0
projectile: 1
canShoot: false
limitingRange: 300

[projectile_1]
tags= T-projectile
areaDamage:0
areaRadius:0
life:50
instant:true
explodeEffect:NONE
explodeEffectOnShield:NONE

[projectile_unload]
tags= T-projectile
areaDamage:0
areaRadius:0
life:50
instant:true
unloadUpToXUnitsFromSource:9
explodeEffect: CUSTOM:unload, CUSTOM:unload2, CUSTOM:displacement

[effect_unload]
image: 池.png
life: 200
fadeOut: true
fadeInTime: 5
scaleFrom: 2.5
scaleTo: 2.3
alpha: 0.7
drawUnderUnits:false

dirSpeed: 1.3

[effect_unload2]
image: 池底.png
life: 200
fadeOut: true
fadeInTime: 5
scaleFrom: 2.5
scaleTo: 2.3
alpha: 0.8
drawUnderUnits:true

dirSpeed: 1.3

[effect_displacement]
drawType: displacement

image: SHARED:ripple_normal_128.png
life: 30
fadeOut: true
fadeInTime: 2

attachedToUnit: false
color: #FFFFFF
scaleFrom: 1.5
scaleTo: 0
alpha: 0.5
drawUnderUnits:false

[leg_1]
x:40
y:60
moveSpeed:2
moveWarmUp:15
attach_x:36
attach_y:56
rotateSpeed:30
heightSpeed:0.5
resetAngle:0.00000001
image_foot:大胖的脚耶.png
image_leg:我要大盘，我要大盘.png
dust_effect:true
holdDisMin:14
holdDisMax:14
estimatingPositionMultiplier:1
image_end_teamColors:true

[leg_2]
x:-40
y:60
attach_x:-36
attach_y:56
copyFrom:1
[leg_3]
x:40
y:-40
attach_x:36
attach_y:-40
copyFrom:1
[leg_4]
x:-40
y:-40
attach_x:-36
attach_y:-40
copyFrom:1

[turret_skill]
x: 0
y: 0
invisible: true
canShoot: false
limitingRange: 9999

[movement]
movementType: OVER_CLIFF_WATER
moveSpeed: 0.45
moveAccelerationSpeed: 0.1
moveDecelerationSpeed: 0.3

maxTurnSpeed: 1.5
turnAcceleration: 0.3

targetHeight: 3
targetHeightDrift: 0

moveSlidingMode :true
moveIgnoringBody:true

reverseSpeedPercentage:0