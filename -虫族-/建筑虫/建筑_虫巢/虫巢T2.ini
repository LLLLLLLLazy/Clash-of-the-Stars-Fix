
[core]
name: 虫巢T2
displayText: T2 - 虫巢
displayDescription: -高效养育虫族战士
class: CustomUnitMetadata
price: 1800
maxHp: 900
mass: 9000

footprint: -1,-1,1,1
constructionFootprint: -1,-1,1,2

techLevel: 2
buildSpeed: 0.002

radius: 18

isBio: true
isBug: true
isBuilding: true
tags: units, 虫族, 虫建筑, 虫筑系T2, 虫巢
showActionsWithMixedSelectionIfOtherUnitsHaveTag: 虫巢

selfRegenRate:0.1
selfBuildRate:0.002

nanoFactorySpeed: 2

softCollisionOnAll: 3

exit_x:0
exit_y:-1

[hiddenAction_狂猎]
autoTrigger:if self.globalTeamTags(includes='狂猎')
convertTo: 虫巢T2[狂猎]
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${ConvertUpdate2}


[canBuild_setRally]
name: setRally
pos: 1

[canBuild_builder]
name: bugSpore
pos: 2
isVisible: if not self.globalTeamTags(includes='AI系统') or not self.globalTeamTags(includes='战隙{I}') or self.globalTeamTags(includes='中刻{I}')

[canBuild_T1]
name: bugMelee, 独角仙, bugRanged, bugBed, 炮弹虫, 面包虫, 巡林者, 冲射虫, 群虫幼体, 毒气
pos: 3
isLocked: if self.globalTeamTags(includes='AI系统') and self.globalTeamTags(includes='中刻{I}')
isLockedMessage: AI:中后期优先高阶兵种,低级单位产出受限

[canBuild_builderT2]
name: 两栖蝇
pos: 2.1


[action_繁育]
isActive: false
id: 繁育
text: 繁育: (%{self.resource.繁育}|2500)
description: -每消耗2500资源养育后触发 \n -生成2个不可控微噬虫 \n -进入10s强化状态:六倍生产速度
pos: 1.1
displayType: infoOnly
buildSpeed: 0s
iconImage: 繁育icon.png
isGuiBlinking: if self.resource.繁育强化>0

requireConditional: if self.resource.繁育>=2500
addResources: 繁育=-2500
produceUnits: 微噬虫

alsoTriggerAction: 繁育强化, 繁育时间, 繁育微噬
spawnEffects: 繁绿光, 繁绿光闪

[hiddenAction_繁育资源]
autoTriggerOnEvent: queuedUnitFinished
addResourcesWithLogic: 繁育=eventSource.priceCredits
alsoTriggerAction: 繁育

[hiddenAction_繁育强化]
requireConditional: if self.resource.繁育强化==0 and self.customTimer>10
setUnitMemory: 属性[33]=memory.属性[33]+4
alsoTriggerAction: 属性变化
setResourcesWithLogic: 繁育强化=1

[hiddenAction_繁育时间]
resetCustomTimer: true

[hiddenAction_繁育微噬]
id: 繁育微噬
highPriorityQueue: true
produceUnits: 微噬虫
buildSpeed: 0s

[hiddenAction_繁育结束]
autoTrigger: if self.resource.繁育强化>0 and self.customTimer>10
setUnitMemory: 属性[33]=memory.属性[33]-4
alsoTriggerAction: 属性变化
setResourcesWithLogic: 繁育强化=0

[hiddenAction_繁育粒子]
autoTrigger: if self.resource.繁育强化>0
spawnEffects: 繁光粒*3

[resource_繁育]
displayName: 繁育

[resource_繁育强化]
hidden: true


#[hiddenAction_绿之崩坏]
#autoTriggerOnEvent: destroyed
#spawnUnits: 绿之崩坏
#spawnEffects: 毒雾3*3, shockwave

[graphics]
total_frames: 1

image:        虫巢.png
image_back:   虫巢_back.png
image_wreak:  NONE

imageScale: 1.2

#AUTO
image_shadow: NONE
shadowOffsetX:1
shadowOffsetY:1

animation_idle_start: 0
animation_idle_end: 0
animation_idle_speed: 150
animation_idle_scale_start:1
animation_idle_scale_end:1.05
animation_idle_pingPong: true

[decal_繁光]
isVisible: if self.resource.繁育强化>0
onlyWhileAlive: true
layer: afterBody
alpha: 0.25
image: 绿光.png
imageScale: 1.5


[attack]
canAttack: false
canAttackFlyingUnits: false
canAttackLandUnits:   false
canAttackUnderwaterUnits: false

turretSize: 20
turretTurnSpeed: 3

maxAttackRange: 10
shootDelay: 50

[effect_繁绿光]
priority: low
life: 40
scaleFrom: 1.5
scaleTo: 1.5
alpha: 0.6
image: 幻影晶光.png
color: #00FF00

[effect_繁绿光闪]
@copyFromSection: effect_繁绿光
life: 15
scaleFrom: 2
scaleTo: 1.5

[effect_繁光粒]
priority: verylow
attachedToUnit: false
life: 100
lifeRandom: 30
image: 白粒.png
color: #55FF00
scaleFrom: 1
scaleTo: 2
hSpeed: 0.6
hSpeedRandom: 0.2
xOffsetRelativeRandom: 18
dirSpeedRandom: 1
drawUnderUnits: true
delayedStartTimerRandom: 50



[effect_毒雾3]
stripIndex: effects
frameIndex: 0
priority:low

life: 100
fadeOut: true
attachedToUnit: false
color: #AEFF00
fadeInTime:5
hSpeed: 0.8
scaleFrom: 1.0
scaleTo: 2.5
alpha: 0.6
drawUnderUnits:false
xSpeedRelativeRandom:0.5
ySpeedRelativeRandom:0.5

shadow: true
atmospheric: true

[effect_shockwave]
stripIndex: shockwave
life: 30
scaleFrom: 0
scaleTo: 1.2
alpha: 0.8
color: #AEFF00

[movement]
movementType: NONE
moveSpeed: 0
moveAccelerationSpeed: 0.01
moveDecelerationSpeed: 0.01

maxTurnSpeed: 0
turnAcceleration: 0.1

[ai]
upgradedFrom: 虫巢

[action_AI建造虫征集]
isVisible: if self.globalTeamTags(includes='AI系统') and self.globalTeamTags(includes='战隙{I}') and not self.globalTeamTags(includes='中刻{I}') and not self.globalTeamTags(includes='AI爆发')
unitShownInUI: bugSpore
textAddUnitName: bugSpore
descriptionAddFromUnit: bugSpore
descriptionAddUnitStats: bugSpore
produceUnits: bugSpore
buildSpeed: 0.005
price: 100
pos: 1

[hiddenAction_AIGroundDetection]
addWaypoint_type: guard
addWaypoint_prepend: true
addWaypoint_maxTime: 5s
addWaypoint_target_nearestUnit_tagged: 基地
addWaypoint_target_nearestUnit_team: own
addWaypoint_triggerActionIfMatched: AIbuildbugSpore
autoTrigger:if self.globalTeamTags(includes='AI系统') and self.hasResources(100) and self.globalTeamTags(includes='战隙{I}') and not self.globalTeamTags(includes='AI爆发') and not self.tags(includes='一隙之巢')

[hiddenAction_AIbuildbugSpore]
alsoQueueAction: AI建造虫征集
addResources: credits=-100
temporarilyAddTags: 一隙之巢

[hiddenAction_AIbuildbugSpore2]
autoTrigger:if self.globalTeamTags(includes='AI系统') and self.hasResources(100) and self.globalTeamTags(includes='中刻{I}') and not self.globalTeamTags(includes='AI爆发') and numberOfUnitsInTeam(withTag='建造虫', lessThan=3) and not self.tags(includes='中刻之巢')
alsoQueueAction: AI建造虫征集
addResources: credits=-100
temporarilyAddTags: 中刻之巢
