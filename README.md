# 群星之争测试版

## AI优化详细说明（虫族方向）

### 1. 优化范围与目标
- 本轮AI优化主要覆盖：`AI敌人操作虫族`。
- 优化目标：
  - 缩短低级期，提前进入中高阶节奏。
  - 减少低级单位的无效消耗与“持续送兵”。
  - 增加“屯兵 -> 爆发”的波次进攻行为。
  - 在保持进攻强度的前提下，降低高频触发造成的CPU压力。

### 2. 全局AI节奏系统（`-[AI+]-/AI系统.ini`）

#### 2.1 阶段标签时点
- `开端{I}`：`时点=180`
- `战隙{I}`：`时点=260`（由300提前）
- `中刻{I}`：`时点=390`（由450提前）
- `后界{I}`：`时点=1200`

#### 2.2 战术节拍（屯兵/爆发）
- 新增全局资源：`战术节拍`。
- 新增全局标签：`AI屯兵`、`AI爆发`。
- 节拍切换时点：

| 节拍序号 | 时点 | 状态 |
| --- | --- | --- |
| 1 | 205 | 屯兵 |
| 2 | 245 | 爆发 |
| 3 | 300 | 屯兵 |
| 4 | 340 | 爆发 |
| 5 | 405 | 屯兵 |
| 6 | 450 | 爆发 |
| 7 | 560 | 屯兵 |
| 8 | 620 | 爆发 |
| 9 | 760 | 屯兵 |
| 10 | 830 | 爆发 |

- 防守打断：
  - 当处于`AI屯兵`且`700`范围内敌军`>3`时，强制切换到`AI爆发`。

#### 2.3 风险态势标签
- 新增“家危/家安”双向切换：
  - `1000`范围敌军`>1`加`家危`。
  - `1000`范围敌军`<2`移除`家危`。

#### 2.4 关闭清理增强
- AI关闭时会清理更多全局标签，避免残局污染下一局：
  - 包含`AI屯兵`、`AI爆发`、`攻路受阻`、`攻路2确定`、`开端计攻2`等。
- 同步重置：`时点`与`战术节拍`。

### 3. 攻路系统优化（`寻攻路筛选.ini` / `寻攻路否.ini`）

#### 3.1 识别目标扩展
- 攻路判定由仅识别`地震塔T2`扩展为同时识别：
  - `地震塔T2`
  - `地震T2升级中`

#### 3.2 受阻状态机
- 新增全局标签：`攻路受阻`。
- 触发逻辑：
  - 探针检测到关键目标阻断 -> 标记`攻路受阻`并切换`寻攻路否`分支。
  - 路径成功确定后 -> 添加`攻路2确定`并清除`攻路受阻`。

#### 3.3 自动重试与容错
- 在`AI系统.ini`中新增受阻重试：
  - 满足`攻路受阻 + 开端计攻2 + 未攻路2确定`且无筛选探针时，每`12s`重试一次。
- 在探针中新增阻挡计数`AI阻挡`：
  - 卡住累计到阈值时强制触发再检测。
- 新增超时清理：
  - `寻攻路筛选`超时`60s`销毁。
  - `寻攻路否`超时`35s`销毁。

#### 3.4 频率控制
- `寻攻路筛选`冷却设为`0.1s`。
- `寻攻路否`冷却设为`0.11s`。
- 目标：保持探针响应同时避免0.01s级高频轮询。

### 4. 虫族经济与产能策略（建筑侧）

#### 4.1 母巢（`-虫族-/建筑虫/建筑_母巢/母巢.ini`）
- AI建造虫征集：
  - 仅在未进入`战隙{I}`时大量补建造虫。
- AI蚊子征集：
  - 增加`not AI屯兵`限制，屯兵期停止低级骚扰刷兵。
  - 单次花费由批量改为更保守批次（单次`380`，且要求队列空闲）。

#### 4.2 母巢T2（`-虫族-/建筑虫/建筑_母巢/母巢T2.ini`）
- 战隙期建造虫征集增加`not AI爆发`，爆发期让资源优先给重型单位。
- 两栖蝇与收成者征集保留数量与资源阈值判定。
- 新增爆发重型征集：
  - 条件：`AI爆发 + 中刻{I} + 资金12000 + 修复点不足`。
  - 行为：连续征集双收成者，提升中后期质量单位比重。

#### 4.3 虫巢（`-虫族-/建筑虫/建筑_虫巢/虫巢.ini`）
- 一号地巢开局批量噬咬虫数量从更激进方案下调到4只，降低早期低效堆量。
- 升级触发前置到`开端{I}`后半段，并结合`AI屯兵`或`战隙{I}`执行，减少盲升。

#### 4.4 虫巢T2（`-虫族-/建筑虫/建筑_虫巢/虫巢T2.ini`）
- 战隙/中刻的建造虫补充均加`not AI爆发`限制。
- 中刻补建造虫新增数量上限判断，防止多建筑重复补工导致浪费。

#### 4.5 飞虫地巢（`-虫族-/建筑虫/建筑_虫巢/飞虫地巢.ini`）
- 基础飞虫（bugWasp）可见条件新增`not AI屯兵`。
- 升级触发改为：`开端{I}`后，满足`AI屯兵`或`战隙{I}`时推进。

#### 4.6 飞虫地巢T2（`-虫族-/建筑虫/建筑_虫巢/飞虫地巢T2.ini`）
- 保留中刻常规高空编队（捕猎虫/音波）逻辑。
- 新增爆发高空压制：
  - 条件：`AI爆发 + 中刻{I} + 资金5000 + 队列空闲`
  - 行为：批量空军压制，形成波次制空。

### 5. 虫族作战行为优化（单位侧）

#### 5.1 蚊子（`-虫族-/空虫/空_蚊子/蚊子.ini`）
- 常规攻击、家危反击、attackMove中点推进均增加`not AI屯兵`条件。
- 新增两个战术动作：
  - `AI屯兵集结`：守基地（guard）
  - `AI爆发突击`：attackMove冲敌基地

#### 5.2 飞虫（`-虫族-/空虫/空_飞虫/bug_wasp.ini`）
- 初队进攻与中点推进增加`not AI屯兵`。
- 新增屯兵/爆发动作，行为与蚊子一致但持续时长更长。
- 集群进攻也受`not AI屯兵`约束，避免屯兵期提前出击。

#### 5.3 战斗虫（`-虫族-/陆虫/陆_战斗虫/bug_ranged.ini`）
- 集群进攻动作增加`not AI屯兵`。
- 新增屯兵集结动作（基地防守集合）。

#### 5.4 群虫（`-虫族-/陆虫/陆_群虫/群虫.ini`）
- 新增`AI屯兵集结`与`AI爆发突击`完整波次动作。
- 多个主动进攻触发增加`not AI屯兵`限制。
- 保留针对`地震T2升级中`的前锋/跟虫特殊攻坚逻辑。
- 保留无效攻击回收与重置流程，减少单位空转。

### 6. 性能与稳定性修复
- `numberOfUnitsInTeam`范围限制修复：
  - `withinRange=1200` -> `withinRange=1000`（引擎上限）。
- 路径探针冷却上调到`0.1s`级，降低CPU压力。
- 说明：
  - `autoTriggerCooldownTime`过低（如`0.01s`）在部分版本下即使写了`allowDangerousHighCPU`也可能被判定不通过。
  - 大规模单位建议维持`>=0.1s`，否则容易出现加载报错或帧耗尖峰。

### 7. 当前状态
- 本轮AI行为优化重点仍是虫族。
- AI随机阵营池当前仍为：`铁锈`、`虫族`。

### 8. 下一步计划
- 加入“经济状态 + 高级单位价值”动态评估，替代纯时间推进中高阶期。
- 增加“资源不足时的经济建筑优先级”和“基地周边防御建设（避免堵路）”专项逻辑。

## 关键修改文件
- `-[AI+]-/AI系统.ini`
- `-[AI+]-/寻攻路筛选.ini`
- `-[AI+]-/寻攻路否.ini`
- `-[AI+]-/漂浮灵控制.ini`
- `-虫族-/建筑虫/建筑_母巢/母巢.ini`
- `-虫族-/建筑虫/建筑_母巢/母巢T2.ini`
- `-虫族-/建筑虫/建筑_虫巢/虫巢.ini`
- `-虫族-/建筑虫/建筑_虫巢/虫巢T2.ini`
- `-虫族-/建筑虫/建筑_虫巢/飞虫地巢.ini`
- `-虫族-/建筑虫/建筑_虫巢/飞虫地巢T2.ini`
- `-虫族-/空虫/空_蚊子/蚊子.ini`
- `-虫族-/空虫/空_飞虫/bug_wasp.ini`
- `-虫族-/陆虫/陆_战斗虫/bug_ranged.ini`
- `-虫族-/陆虫/陆_群虫/群虫.ini`
