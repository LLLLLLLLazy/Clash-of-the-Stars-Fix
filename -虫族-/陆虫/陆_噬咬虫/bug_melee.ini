
[core]
name: bugMelee
altNames: 噬咬虫
displayText: 噬咬虫
displayDescription: -攻击地面单位 \n -移动速度快 \n -快速撕咬
class: CustomUnitMetadata
price: 300
maxHp: 240
mass: 500

techLevel: 1
buildSpeed: 0.006
#availableInDemo: true

radius: 8
displayRadius: 10
isBio: true
isBug: true
tags: units, 虫族, 小型虫, 开端辅虫, 噬咬虫, 转向攻击

numBitsOnDeath: 5



selfRegenRate:0.06


softCollisionOnAll: 12

builtFrom_1_name: bugNest
builtFrom_1_pos:  2

overrideAndReplace:bugMelee

autoTriggerCooldownTime: 0.01s
autoTriggerCooldownTime_allowDangerousHighCPU: true

[action_Upgrade]
convertTo:bugMeleeLarge
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${ConvertUpdate2}
price:腐蚀=100
text:腐蚀 - 巨化
displayType:upgrade
buildSpeed:12.8s
pos:1
description:-更大,更好,更强
descriptionAddUnitStats: ${section.convertTo}
iconExtraImage:SHARED:icon_upgrade_top.png
iconExtraColor:#AAFFFFFF
tags=腐蚀
setUnitMemory: 属性[24]=0
addResources: unsetFlag=1-3
ai_isHighPriority: true
isLocked: if self.globalTeamTags(includes='AI系统') and self.isAttacking
isLockedMessage: AI:正在战斗

[hiddenAction_腐蚀中]
autoTrigger: if self.queueSize(withActionTag="腐蚀")>0 and not self.tags(includes='腐蚀中')
setUnitMemory: 属性[24]=-${movement.moveSpeed}*0.6
alsoTriggerAction: 属性变化
temporarilyAddTags: 腐蚀中

[hiddenAction_腐蚀停止]
autoTrigger: if self.queueSize(withActionTag="腐蚀")<1 and self.tags(includes='腐蚀中')
setUnitMemory: 属性[24]=0
alsoTriggerAction: 属性变化
temporarilyRemoveTags: 腐蚀中

[hiddenAction_自动腐蚀]
autoTrigger: if (self.hasUnitInTeam(withTag="腐蚀-巨噬虫") and self.hasUnitInTeam(withTag="腐蚀之意")) and self.hasResources(${action_Upgrade.price}) and self.queueSize(empty=true) and not self.isAttacking
alsoQueueAction: Upgrade
addResourcesWithLogic: ${action_Upgrade.price}*-1

[action_被动技能]
autoTrigger: if self.hp<self.maxHp*0.4 and not self.hasFlag(id=1)
isActive: false
id: ${section.text}
text: 硬撑
description: -血量低于40%时五秒内回复25%血量|+0.8移速 \n -五秒后失去25%血量 \n -仅可触发一次 \n 回复: %{self.maxHp*0.25}
pos: 3
displayType: infoOnly
buildSpeed: 0s
iconImage: 风扭icon.png
isGuiBlinking: if self.hasFlag(id=2)
spawnEffects: 治疗粒子*5

addResources: setFlag=1-2
addResourcesWithLogic: hp=self.maxHp*0.25
setUnitMemory: 属性[24]=memory.属性[24]+0.8
alsoTriggerAction: 属性变化
resetCustomTimer: true

[hiddenAction_硬撑结束]
autoTrigger: if self.hasFlag(id=2) and self.customTimer>5
addResources: unsetFlag=2
addResourcesWithLogic: hp=-self.maxHp*0.25
setUnitMemory: 属性[24]=memory.属性[24]-0.8
alsoTriggerAction: 属性变化


[action_振奋]
isVisible: true
isActive: false
id: ${section.text}
text: 振奋
description: -300范围内有振奋类陆地虫受到伤害时移速+0.6 \n -持续2s
pos: 3
displayType: infoOnly
buildSpeed: 0s
iconImage: 振奋icon.png
isGuiBlinking: if self.hasFlag(id=3)

[hiddenAction_陆地振奋虫受伤]
autoTrigger: if self.hasTakenDamage<=2 and not self.hp(full=true) and not self.tags(includes='陆地振奋虫受伤')
temporarilyAddTags: 陆地振奋虫受伤

[hiddenAction_受伤结束]
autoTrigger: if self.tags(includes='陆地振奋虫受伤') and self.hasTakenDamage>2
temporarilyRemoveTags: 陆地振奋虫受伤

[hiddenAction_战斗加速]
autoTrigger: if numberOfUnitsInTeam(withTag='陆地振奋虫受伤', withinRange=300)>0 and not self.hasFlag(id=3)
setUnitMemory: 属性[24]=memory.属性[24]+0.6
alsoTriggerAction: 属性变化
addResources: setFlag=3

[hiddenAction_加速结束]
autoTrigger: if numberOfUnitsInTeam(withTag='陆地振奋虫受伤', withinRange=300)==0 and self.hasFlag(id=3)
setUnitMemory: 属性[24]=memory.属性[24]-0.6
alsoTriggerAction: 属性变化
addResources: unsetFlag=3



[action_皎红化]
isVisible: if self.resource.虚红感染>=1
price: 200
text: 皎红化
descriptionAddFromUnit: ${section.convertTo}
descriptionAddUnitStats: ${section.convertTo}
iconExtraImage: 红散裂.png
displayType: upgrade
buildSpeed: 0.01
pos: 2
convertTo: 皎红噬咬虫
sendMessageTo: ${ConvertUpdate1}
sendMessageWithTags: ${ConvertUpdate2}
spawnEffects: 皎红光

[effect_皎红光]
life: 50
image: SHARED:light_50.png
color: #ff0000
scaleFrom: 1.2
scaleTo: 0.5
alpha: 1.2

[resource_虚红感染]
displayName: 虚红感染
hidden: true


[hiddenAction_无延迟追击B]
@copyFromSection: template_无延迟追击B
[hiddenAction_无延迟追击B2]
@copyFromSection: template_无延迟追击B2


[action_扩散移动点开]
@copyFromSection: template_扩散移动点开

[action_扩散移动点关]
@copyFromSection: template_扩散移动点关

[hiddenAction_设置扩散移动点]
@copyFromSection: template_设置扩散移动点

[hiddenAction_清除当前非巡逻路径]
@copyFromSection: template_清除当前非巡逻路径

[hiddenAction_锁定扩散移动点]
@copyFromSection: template_锁定扩散移动点

[hiddenAction_执行扩散移动点]
@copyFromSection: template_执行扩散移动点


[effect_治疗粒子]
priority: verylow
life: 50
fadeInTime: 10
lifeRandom: 20
image: +.png
scaleFrom: 1
scaleTo: 0.5
alpha: 0.8
hSpeed: 0.5
hSpeedRandom: 0.1
xOffsetRelativeRandom: ${core.radius}
yOffsetRelativeRandom: ${core.radius}
alwayStartDirAtZero: true
attachedToUnit: true
atmospheric: true
delayedStartTimerRandom: 20

[graphics]
total_frames: 5

image:        bug_melee.png
image_wreak:  bug_dead.png
image_turret: NONE
#scaleImagesTo: 20
#scaleTurretImagesTo: 9

#AUTO
image_shadow: AUTO_ANIMATED
shadowOffsetX:0
shadowOffsetY:0


animation_moving_start: 0
animation_moving_end: 2
animation_moving_speed: 3
#animation_moving_pingPong: true

animation_idle_start: 0
animation_idle_end: 0
animation_idle_speed: 120
animation_idle_scale_start:1
animation_idle_scale_end:1.03
animation_idle_pingPong: true

animation_attack_start: 2
animation_attack_end: 4
animation_attack_speed: 4


lock_body_rotation_with_main_turret: true


[attack]

isMelee: true
meleeEngangementDistance: 150

canAttack: true
canAttackFlyingUnits: false
canAttackLandUnits:   true
canAttackUnderwaterUnits: false

#isFixedFiring: true

turretSize: 20
turretTurnSpeed: 6

maxAttackRange: 9
shootDelay: 25

[turret_1]
x: 0
y: 0

recoilOffset: 3
recoilOutTime: 6
recoilReturnTime: 18


[projectile_1]
tags= T-projectile
directDamage: 23
life: 50
instant: true


[movement]
movementType: LAND
moveSpeed: 1
moveAccelerationSpeed: 0.07
moveDecelerationSpeed: 0.12


maxTurnSpeed: 5.5
turnAcceleration: 0.5

targetHeight: 0
targetHeightDrift: 0

moveSlidingMode :true
moveIgnoringBody:true
moveSlidingDir:  181



reverseSpeedPercentage:0

[hiddenAction_AIattack]
addWaypoint_type: attack
addWaypoint_prepend: true
addWaypoint_maxTime: 5s
addWaypoint_target_nearestUnit_tagged: 建造虫, 建造者, 贝露之眼, 前哨站T0
addWaypoint_target_nearestUnit_team: enemy
addWaypoint_target_nearestUnit_maxRange: 800
addWaypoint_target_mapMustBeReachable: true
autoTrigger: if self.globalTeamTags(includes='AI系统') and not numberOfUnitsInEnemyTeam(greaterThan=0, withinRange=250) and not self.hasActiveWaypoint(type='attack') and numberOfUnitsInEnemyTeam(greaterThan=0, withinRange=800) and not self.globalTeamTags(includes='开端{I}')

[hiddenAction_AIattackMoveMiddle]
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.isAttacking and not self.hasActiveWaypoint(type='attack') and not self.globalTeamTags(includes='开端{I}') and self.customTimer(laterThanSeconds=2)
addWaypoint_type: attackMove
addWaypoint_prepend: true
addWaypoint_target_mapMustBeReachable: false
addWaypoint_target_nearestUnit_tagged: 中点定位
addWaypoint_target_nearestUnit_team: any
resetCustomTimer:true

[hiddenAction_AIattackHome]
addWaypoint_type: attack
addWaypoint_prepend: true
addWaypoint_maxTime: 5s
addWaypoint_target_nearestUnit_tagged: 建造者[侵], 炮塔[侵]
addWaypoint_target_nearestUnit_team: enemy
addWaypoint_target_mapMustBeReachable: true
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.hasActiveWaypoint(type='attack') and not self.globalTeamTags(includes='开端{I}') and self.globalTeamTags(includes='家危')

[hiddenAction_AIattack2]
@copyFromSection: hiddenAction_AIattack
addWaypoint_target_nearestUnit_tagged: 未建成对地塔
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.isAttacking and numberOfUnitsInEnemyTeam(greaterThan=0, withinRange=240, withTag='未建成对地塔', incompleteBuildings=true)

[hiddenAction_AI集群进攻]
addWaypoint_type: guard
addWaypoint_prepend: true
addWaypoint_maxTime: 20s
addWaypoint_target_nearestUnit_tagged: 群虫成体
addWaypoint_target_nearestUnit_team: own
autoTrigger: if self.globalTeamTags(includes='AI系统') and not self.hasActiveWaypoint(type='guard') and self.globalTeamTags(includes='开端{I}')

[hiddenAction_AI指定攻击]
addWaypoint_type: attack
addWaypoint_prepend: true
addWaypoint_maxTime: 20s
addWaypoint_target_mapMustBeReachable: true
addWaypoint_target_nearestUnit_tagged: T3机枪, 电机枪塔, 火焰喷射器T2, 毒气兵
addWaypoint_target_nearestUnit_team: enemy
addWaypoint_target_nearestUnit_maxRange: 500
autoTrigger: if self.globalTeamTags(includes='AI系统') and self.globalTeamTags(includes='开端{I}')
