
[core]
name: 兰斯洛特
displayText: 兰斯洛特
displayDescription: -最精锐的骑士 \n -全副武装 \n -优良视野 \n -强劲的斩击 \n -支配度达标时可进行传送 \n “终于，他回来了”
class: CustomUnitMetadata
price: 15000, 基因种子=35
maxHp: 5000
mass: 40000

tags: units, 星际步兵, 坚韧意志

fogOfWarSightRange: 22

techLevel: 2
buildSpeed: 0.00022

armour: 40
armourMinDamageToKeep: 40

radius: 24
displayRadius: 27

isBio: true

selfRegenRate: 0.25

transportSlotsNeeded: 3

#[hiddenAction_legendary]
#convertTo: 无头骑士
#autoTrigger: if numberOfUnitsInTeam(withTag="units", lessThan=2) and self.numberOfUnitsInAllyNotOwnTeam(withTag="units", lessThan=1) and self.hasResources(基因种子=100) and self.hasResources(credits=50000)
#addResources: hp=6200
#spawnEffects: 阴森气氛*20

[effect_阴森气氛]
stripIndex: effects
frameIndex: 0

life: 150
fadeOut: true
attachedToUnit: true
color: #000000
fadeInTime: 30
scaleFrom: 2.5
scaleTo: 4.2
alpha: 0.25
drawUnderUnits:false

shadow: true
atmospheric: true

dirOffsetRandom:180

xOffsetRelativeRandom:30
yOffsetRelativeRandom:30

xSpeedAbsoluteRandom: 0.1
ySpeedAbsoluteRandom: 0.1

[action_传送]
isVisible: if self.resource.传送冷却<=0 and self.resource(type="支配度", greaterThan=69)
id: ${section.text}
text: 传送
description: -可传送至500范围内指定地点 \n -在50范围外每提高100传送距离翻倍冷却时间 \n 基础CD:4s \n (支配度: 70)
buildSpeed: 0s
displayType: action
iconImage: 传送光环.png
fireTurretXAtGround: 传送
fireTurretXAtGround_onlyOverPassableTileOf: OVER_CLIFF
fireTurretXAtGround_showGuideDecals: 指定线
spawnEffects: 传送光环生成
alsoQueueAction: 传送中

addResourcesWithLogic:"""
传送冷却=4
* (1+select(distanceBetween(self, thisActionTarget)>=150, 1, 0))
* select(distanceBetween(self, thisActionTarget)>=250, 2, 1)
* select(distanceBetween(self, thisActionTarget)>=350, 2, 1)
* select(distanceBetween(self, thisActionTarget)>=450, 2, 1)
+ 1
"""
isLocked: if self.resource.传送冷却>0 or self.queueSize(withActionTag='传送中')>0
isLockedMessage: 正在冷却:%{self.resource.传送冷却}s

[action_传送冷却中]
@copyFromSection: action_传送
isVisible: if self.resource.传送冷却>0 or not self.resource(type="支配度", greaterThan=69)
isActive: false
id: ${section.text}冷却中
fireTurretXAtGround: IGNORE
fireTurretXAtGround_onlyOverPassableTileOf: IGNORE
fireTurretXAtGround_showGuideDecals: IGNORE

[hiddenAction_传送中]
id: 传送中
tags=传送中
buildSpeed: 1s
whenBuilding_cannotMove: true

[hiddenAction_传送冷却]
autoTrigger: if self.resource.传送冷却>0
addResources: 传送冷却=-1

[resource_传送冷却]
displayName: 传送冷却

[decal_指定线]
alwaysStartHeightAtZero: true
layer: inactive
image: SHARED:blank.png
@define timer_2s: ((self.timeAlive() % 2) / 2)
alpha: 0.9+cos( ${timer_2s} * 360) * 0.3
color: #9214DC
drawLineTo: self

#-----------------

[turret_传送]
x: 0
y: 0
invisible: true
canShoot: false
limitingRange: 500
projectile: 传送指定

[projectile_传送指定]
tags= T-projectile
invisible: true
directDamage: 0
deflectionPower: -1
life: 20
speed: 999
explodeEffect: 闪亮登场音效
spawnProjectilesOnExplode: 传送(offsetHeight=300)

[projectile_传送]
tags= T-projectile
areaDamage: 0
areaRadius: 0
invisible: true
life: 100
speed: 7.5
trailEffect: 传送环
deflectionPower: -1
teleportSource: true
explodeEffect: 传送落点波, 传送落点粒*18, 传送落点光*3

#-----------------

[global_resource_支配度]
displayName: 支配度

#-----------------

[arm_20]
x: 0
y: 0
spinRate: 3

[decal_传送光环]
onlyWhileAlive: true
layer: beforeBody
isVisible: if self.queueSize(withActionTag='传送中')>0
@define timer_hs: ((self.timeAlive() % 0.5) / 0.5)
alpha: 0.7+cos( ${timer_hs} * 360) * 0.2
image: 传送光环.png
imageScale: ${0.018 * core.radius}
basePositionFromLegEnd: arm_20

[effect_传送光环生成]
priority: veryhigh
attachedToUnit: false
image: SHARED:blank.png
life: 70
trailEffect: 传送光环
trailEffectRate: 6

[effect_传送光环]
priority: low
life: 120
fadeInTime: 10
attachedToUnit: false
image: 传送光环.png
scaleFrom: ${core.radius*0.018}
scaleTo: ${core.radius*0.017}
alpha: 0.5
hSpeed: 0.6
dirSpeed: 4

#-----------------

[effect_闪亮登场音效]
priority: veryhigh
image: SHARED:blank.png
life: 0
alsoPlaySound: 闪亮登场.ogg:0.8

[effect_传送环]
priority: high
life: 60
fadeOut: true
fadeInTime: 3
attachedToUnit: false
image: 传送光环.png
scaleFrom: 0.5
scaleTo: 0.5
alpha: 0.9

[effect_传送落点波]
stripIndex: shockwave
priority: high
life: 35
fadeOut: true
attachedToUnit: false
color: #9214DC
scaleFrom: 0.1
scaleTo: 3.3
alpha: 1.0

[effect_传送落点粒]
priority: low
life: 150
fadeOut: true
attachedToUnit: false
image: SHARED:spark.png
color: #9214DC
scaleFrom: 1.5
scaleTo: 1.5
alpha: 1.0
hSpeed: 1.0
xSpeedRelativeRandom: 2.0
ySpeedRelativeRandom: 2.0

[effect_传送落点光]
priority: high
life: 45
fadeOut: true
attachedToUnit: false
image: SHARED:light_50.png
color: #9214DC
scaleFrom: 1.8
scaleTo: 1.8
alpha: 1.0
drawUnderUnits:false

#-----------------

[animation_attack]
onActions: attack
arm1_0s:{x:0, y:0, dir:0}
arm1_0.5s:{x:0, y:0, dir:20}
arm1_2.0s:{x:0, y:-3, dir:180}
arm1_2.3s:{x:-1, y:0, dir:-100}
arm1_3.0s:{x:0, y:0, dir:0}

arm2_0s:{x:0, y:0, dir:0}
arm2_2.2s:{x:0, y:0, dir:20}
arm2_2.6s:{x:0, y:0, dir:0}

[graphics]
total_frames: 6
image:       灰骑士.png
image_wreak: NONE
image_turret: NONE

teamColorsOnTurret: true

image_shadow: AUTO_ANIMATED
shadowOffsetX:2
shadowOffsetY:2

animation_moving_start: 0
animation_moving_end: 5
animation_moving_speed: 3
animation_moving_pingPong:true

animation_idle_start: 0
animation_idle_end: 5
animation_idle_speed: 3
animation_idle_pingPong:true

lock_body_rotation_with_main_turret: true
lock_leg_rotation_with_main_turret: true

[attack]
canAttack: true
canAttackFlyingUnits: false
canAttackLandUnits:   true
canAttackUnderwaterUnits: false

turretSize: 1
turretTurnSpeed: 6

maxAttackRange: 50
shootDelay: 500

isMelee: true

aimOffsetSpread: 0

[turret_1]
#主体
invisible: true
canShoot: false
x: 0
y: 0
idleDir: 0
turnSpeed: 4.0
turnSpeedAcceleration: 0.5

recoilOffset: 1
recoilOutTime: 7
recoilReturnTime: 21

canAttackCondition: if attacking == activeWaypointTarget or not self.hasActiveWaypoint(type='attack') or distanceBetween(attacking, activeWaypointTarget)>400

[turret_2]
#右臂
invisible: true
attachedTo: 1
x: 0
y: 0
idleDir: 0

turnSpeed: 5.0
turnSpeedAcceleration: 1.0

canAttackCondition: if attacking == activeWaypointTarget or not self.hasActiveWaypoint(type='attack') or distanceBetween(attacking, activeWaypointTarget)>400

shoot_sound:强劲蓄力.ogg
shoot_sound_vol:0.6
shoot_flame:浅紫幕, 紫粒子聚拢*15

projectile: 1

[turret_3]
#肩甲
image: 灰骑士肩甲.png
canShoot: false
x: 0
y: 0
attachedTo: 1
slave: true
idleDir: 0

turnSpeed: 0

[projectile_1]
tags= T-projectile
delayedStartTimer: 126

areaDamage: 5000
areaRadius: 100
areaHitAirAndLandAtSameTime: true

life: 50
instant: true

explodeEffect: 空间斩, 额外斩击*8, 紫幕, 紫粒子*15, 震屏
explodeEffectOnShield: 空间斩, 额外斩击*8, 紫幕, 紫粒子*15, 震屏

[effect_浅紫幕] 
priority: critical
alwayStartDirAtZero: true
image: 紫幕.png
life: 126
fadeOut: false
fadeInTime: 126
scaleFrom: 5.0
scaleTo: 5.0
alpha: 0.3
drawUnderUnits: false
createWhenOffscreen: true
showInFog: true

[effect_紫粒子聚拢]
priority: low
life: 10
attachedToUnit: true
image: SHARED:spark.png
alpha: 0.0
ySpeedRelative: 15
ySpeedRelativeRandom: 3
pivotOffsetRandom: 180
alsoEmitEffectsOnDeath: 紫粒子聚拢2

[effect_紫粒子聚拢2]
priority: low
life: 116
fadeOut: false
fadeInTime: 70
attachedToUnit: true
image: SHARED:spark.png
color: #9214DC
scaleFrom: 2.0
scaleTo: 2.0
alpha: 1.0
ySpeedRelative: 1.3
ySpeedRelativeRandom: 0.2
pivotOffset: 180
drawUnderUnits: false

[effect_空间斩] 
priority: critical
image: 刀光.png
life: 100
fadeOut: false
attachedToUnit: false
color: #9214DC
scaleFrom: 1.5
scaleTo: 1.5
alpha: 1.0
yOffsetRelative: -15
drawUnderUnits: false
alsoPlaySound:空间斩.ogg:1.0

[effect_额外斩击]
priority:high

image: 斩击.png
life: 30
fadeOut: true
attachedToUnit: false
color: #9214DC
scaleFrom: 5.0
scaleTo: 5.0
alpha: 0.4
dirOffsetRandom: 45
xOffsetRelativeRandom: 6
yOffsetRelativeRandom: 9
drawUnderUnits:false

total_frames: 5
animateFrameStart: 0
animateFrameEnd: 4
animateFrameSpeed: 0.15

[effect_紫幕] 
priority: critical
alwayStartDirAtZero: true
image: 紫幕.png
life: 100
fadeOut: true
fadeInTime: 4
scaleFrom: 5.0
scaleTo: 5.0
alpha: 0.7
drawUnderUnits: false
createWhenOffscreen: true
showInFog: true

[effect_紫粒子]
priority: low
life: 150
fadeOut: true
attachedToUnit: false
image: SHARED:spark.png
color: #9214DC
scaleFrom: 2.0
scaleTo: 2.0
alpha: 0.9
xSpeedRelativeRandom: 1.0
ySpeedRelativeRandom: 1.0
pivotOffset: 180
drawUnderUnits: false

[effect_震屏]
priority: critical
drawType: displacement
image: what.png
life: 20
fadeOut: true
attachedToUnit: true
scaleFrom: 100
scaleTo: 100
alpha: 0.05
drawUnderUnits: false
alwayStartDirAtZero: true

total_frames: 2
animateFrameStart: 0
animateFrameEnd:1
animateFrameSpeed: 0.4
animateFrameLooping:true

[movement]
movementType: OVER_CLIFF
moveSpeed: 0.9
moveAccelerationSpeed: 0.13
moveDecelerationSpeed: 0.17

reverseSpeedPercentage: 0

maxTurnSpeed: 4.0
turnAcceleration: 0.3

moveSlidingMode :true
moveIgnoringBody:true

[arm_1]
x: 21
y: 0
image_end: 恐怖关刀.png
image_end_teamColors: true
drawOverBody: false
drawDirOffset: -40
moveSpeed: 30

[arm_2]
x: -21
y: 0
image_end: 动力爪.png
image_end_teamColors: true
drawOverBody: false
drawDirOffset: 25
moveSpeed: 18